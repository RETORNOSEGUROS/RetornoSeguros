<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indique e Ganhe | Retorno Seguros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="js/firebase-config.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0088aa;
            --primary-dark: #006680;
            --secondary: #00b8d4;
            --success: #10b981;
            --warning: #f59e0b;
            --dark: #1a1a2e;
            --light: #f8fafc;
            --gray: #64748b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0088aa 0%, #00b8d4 50%, #0088aa 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 20px;
            color: white;
        }

        .header img {
            height: 60px;
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.95;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }

        .card-title {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title i {
            color: var(--primary);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: rgba(0, 136, 170, 0.1);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 136, 170, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Resultado */
        .resultado {
            display: none;
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-radius: 16px;
            margin-top: 20px;
        }

        .resultado.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .resultado-icon {
            font-size: 3rem;
            color: var(--success);
            margin-bottom: 15px;
        }

        .resultado h3 {
            color: var(--dark);
            margin-bottom: 10px;
        }

        .codigo-box {
            background: white;
            border: 3px dashed var(--success);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .codigo-label {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }

        .codigo-valor {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary);
            letter-spacing: 3px;
        }

        .btn-copiar {
            background: var(--dark);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn-copiar:hover {
            background: #2d2d4a;
        }

        /* Ramos de Seguro */
        .ramos-section {
            display: none;
            margin-top: 30px;
        }

        .ramos-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .ramos-title {
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 15px;
            text-align: center;
        }

        .ramos-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .ramo-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .ramo-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .ramo-card.selected {
            border-color: var(--primary);
            background: rgba(0, 136, 170, 0.05);
        }

        .ramo-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .ramo-nome {
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        /* Compartilhar */
        .compartilhar-section {
            display: none;
            margin-top: 25px;
        }

        .compartilhar-section.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .msg-preview {
            background: #f8fafc;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            font-size: 0.95rem;
            color: var(--dark);
            line-height: 1.6;
            border-left: 4px solid var(--success);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
        }

        .btn-whatsapp:hover {
            background: #1da851;
        }

        .btn-link {
            background: var(--gray);
            color: white;
            margin-top: 10px;
        }

        .btn-link:hover {
            background: #475569;
        }

        /* Alerta */
        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-info {
            background: #e0f2fe;
            color: #0369a1;
            border: 1px solid #7dd3fc;
        }

        .alert-warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .alert-success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #86efac;
        }

        /* Voltar */
        .back-link {
            display: block;
            text-align: center;
            color: white;
            text-decoration: none;
            margin-top: 20px;
            font-size: 0.95rem;
            opacity: 0.9;
        }

        .back-link:hover {
            opacity: 1;
            text-decoration: underline;
        }

        /* Loading */
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e2e8f0;
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.6rem;
            }

            .codigo-valor {
                font-size: 2rem;
            }

            .ramos-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .ramo-card {
                padding: 15px 10px;
            }

            .ramo-icon {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <img src="img/logo-retorno.png" alt="Retorno Seguros" onerror="this.style.display='none'">
            <h1>üí∞ Indique e Ganhe</h1>
            <p>Indique amigos e familiares e fa√ßa parte da nossa rede de benef√≠cios!</p>
        </div>

        <!-- Card Principal -->
        <div class="card">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('novo')">
                    <i class="fas fa-user-plus"></i> Quero Indicar
                </button>
                <button class="tab-btn" onclick="switchTab('existente')">
                    <i class="fas fa-search"></i> J√° sou Indicador
                </button>
            </div>

            <!-- Alertas -->
            <div id="alertBox" class="alert"></div>

            <!-- Tab: Novo Indicador -->
            <div id="tab-novo" class="tab-content active">
                <div class="card-title">
                    <i class="fas fa-gift"></i>
                    Cadastre-se como Indicador
                </div>
                
                <form id="formNovo" onsubmit="return cadastrarIndicador(event)">
                    <div class="form-group">
                        <label class="form-label">Seu Nome</label>
                        <input type="text" class="form-input" id="nome" placeholder="Digite seu nome" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Seu Celular (WhatsApp)</label>
                        <input type="tel" class="form-input" id="telefone" placeholder="(54) 99999-9999" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="btnCadastrar">
                        <i class="fas fa-magic"></i> Gerar Meu C√≥digo
                    </button>
                </form>
            </div>

            <!-- Tab: Indicador Existente -->
            <div id="tab-existente" class="tab-content">
                <div class="card-title">
                    <i class="fas fa-key"></i>
                    Recuperar Meu C√≥digo
                </div>
                
                <form id="formExistente" onsubmit="return buscarCodigo(event)">
                    <div class="form-group">
                        <label class="form-label">Seu Celular (WhatsApp)</label>
                        <input type="tel" class="form-input" id="telefoneBusca" placeholder="(54) 99999-9999" required>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" id="btnBuscar">
                        <i class="fas fa-search"></i> Buscar Meu C√≥digo
                    </button>
                </form>
            </div>

            <!-- Loading -->
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <p>Processando...</p>
            </div>

            <!-- Resultado -->
            <div id="resultado" class="resultado">
                <div class="resultado-icon">üéâ</div>
                <h3 id="resultado-titulo">C√≥digo Gerado com Sucesso!</h3>
                
                <div class="codigo-box">
                    <div class="codigo-label">Seu c√≥digo de indica√ß√£o</div>
                    <div class="codigo-valor" id="codigoGerado">---</div>
                    <button class="btn-copiar" onclick="copiarCodigo()">
                        <i class="fas fa-copy"></i> Copiar C√≥digo
                    </button>
                </div>
            </div>

            <!-- Sele√ß√£o de Ramo -->
            <div id="ramosSection" class="ramos-section">
                <div class="ramos-title">
                    <i class="fas fa-hand-point-down"></i> Qual seguro deseja indicar hoje?
                </div>
                
                <div class="ramos-grid">
                    <div class="ramo-card" onclick="selecionarRamo('auto')">
                        <div class="ramo-icon">üöó</div>
                        <div class="ramo-nome">Auto</div>
                    </div>
                    <div class="ramo-card" onclick="selecionarRamo('residencial')">
                        <div class="ramo-icon">üè†</div>
                        <div class="ramo-nome">Residencial</div>
                    </div>
                    <div class="ramo-card" onclick="selecionarRamo('vida')">
                        <div class="ramo-icon">üíö</div>
                        <div class="ramo-nome">Vida</div>
                    </div>
                    <div class="ramo-card" onclick="selecionarRamo('empresarial')">
                        <div class="ramo-icon">üè¢</div>
                        <div class="ramo-nome">Empresarial</div>
                    </div>
                </div>
            </div>

            <!-- Compartilhar -->
            <div id="compartilharSection" class="compartilhar-section">
                <div class="ramos-title">
                    <i class="fas fa-share-alt"></i> Compartilhe com quem voc√™ quer indicar
                </div>
                
                <div class="msg-preview" id="msgPreview">
                    <!-- Mensagem ser√° inserida aqui -->
                </div>
                
                <button class="btn btn-whatsapp" onclick="compartilharWhatsApp()">
                    <i class="fab fa-whatsapp"></i> Enviar via WhatsApp
                </button>
                
                <button class="btn btn-link" onclick="copiarLink()">
                    <i class="fas fa-link"></i> Copiar Link
                </button>
            </div>
        </div>

        <a href="index.html" class="back-link">
            <i class="fas fa-arrow-left"></i> Voltar para o site
        </a>
    </div>

    <script>
        // ============================================================
        // INICIALIZA√á√ÉO FIREBASE
        // ============================================================
        const db = firebase.firestore();
        
        // Vari√°veis globais
        let codigoAtual = '';
        let nomeAtual = '';
        let ramoSelecionado = '';
        
        // ============================================================
        // ALGORITMO DE GERA√á√ÉO DE C√ìDIGO
        // Formato: 3 letras do nome + 4 √∫ltimos d√≠gitos do telefone
        // Exemplo: Patrick + 54997015000 = PAT5000
        // ============================================================
        function gerarCodigo(nome, telefone) {
            // Pega as 3 primeiras letras do primeiro nome
            const primeiroNome = nome.trim().split(' ')[0].toUpperCase();
            const letras = primeiroNome.substring(0, 3).padEnd(3, 'X');
            
            // Pega os 4 √∫ltimos d√≠gitos do telefone
            const telLimpo = telefone.replace(/\D/g, '');
            const numeros = telLimpo.slice(-4);
            
            return letras + numeros;
        }
        
        // ============================================================
        // FUN√á√ïES DE INTERFACE
        // ============================================================
        function switchTab(tab) {
            // Remove active de todos
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Ativa o selecionado
            if (tab === 'novo') {
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                document.getElementById('tab-novo').classList.add('active');
            } else {
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                document.getElementById('tab-existente').classList.add('active');
            }
            
            // Esconde resultado e se√ß√µes
            document.getElementById('resultado').classList.remove('show');
            document.getElementById('ramosSection').classList.remove('show');
            document.getElementById('compartilharSection').classList.remove('show');
            hideAlert();
        }
        
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }
        
        function showAlert(message, type = 'info') {
            const alertBox = document.getElementById('alertBox');
            alertBox.className = `alert alert-${type} show`;
            alertBox.innerHTML = `<i class="fas fa-${type === 'success' ? 'check-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
        }
        
        function hideAlert() {
            document.getElementById('alertBox').classList.remove('show');
        }
        
        // ============================================================
        // M√ÅSCARAS
        // ============================================================
        function aplicarMascaraTelefone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 10) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
            } else if (value.length > 6) {
                value = value.replace(/(\d{2})(\d{4,5})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            
            input.value = value;
        }
        
        document.getElementById('telefone').addEventListener('input', function() {
            aplicarMascaraTelefone(this);
        });
        
        document.getElementById('telefoneBusca').addEventListener('input', function() {
            aplicarMascaraTelefone(this);
        });
        
        // ============================================================
        // CADASTRAR NOVO INDICADOR
        // ============================================================
        async function cadastrarIndicador(event) {
            event.preventDefault();
            
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const telefoneLimpo = telefone.replace(/\D/g, '');
            
            if (telefoneLimpo.length < 10) {
                showAlert('Digite um telefone v√°lido com DDD.', 'warning');
                return false;
            }
            
            showLoading(true);
            hideAlert();
            
            try {
                // Verifica se j√° existe indicador com esse telefone
                const queryTel = await db.collection('indicadores')
                    .where('telefone', '==', telefoneLimpo)
                    .limit(1)
                    .get();
                
                if (!queryTel.empty) {
                    // J√° existe - recupera o c√≥digo
                    const doc = queryTel.docs[0];
                    const dados = doc.data();
                    
                    codigoAtual = dados.codigoIndicacao;
                    nomeAtual = dados.nome;
                    
                    showLoading(false);
                    showAlert(`Voc√™ j√° possui um c√≥digo de indica√ß√£o! üéâ`, 'success');
                    mostrarResultado(codigoAtual, 'Seu C√≥digo de Indica√ß√£o');
                    return false;
                }
                
                // Verifica se existe lead com esse telefone (pode virar indicador)
                const queryLead = await db.collection('leads_crm')
                    .where('whatsapp', '==', telefoneLimpo)
                    .limit(1)
                    .get();
                
                // Gera novo c√≥digo
                const codigo = gerarCodigo(nome, telefoneLimpo);
                
                // Verifica se c√≥digo j√° existe (caso raro)
                const queryCodigo = await db.collection('indicadores')
                    .where('codigoIndicacao', '==', codigo)
                    .limit(1)
                    .get();
                
                let codigoFinal = codigo;
                if (!queryCodigo.empty) {
                    // Adiciona n√∫mero aleat√≥rio se c√≥digo j√° existe
                    codigoFinal = codigo + Math.floor(Math.random() * 10);
                }
                
                // Salva novo indicador
                await db.collection('indicadores').add({
                    nome: nome,
                    telefone: telefoneLimpo,
                    telefoneFormatado: telefone,
                    codigoIndicacao: codigoFinal,
                    email: '',
                    totalIndicacoes: 0,
                    indicacoesConvertidas: 0,
                    valorGerado: 0,
                    dataCadastro: firebase.firestore.FieldValue.serverTimestamp(),
                    ativo: true,
                    origem: 'site',
                    leadId: queryLead.empty ? null : queryLead.docs[0].id
                });
                
                codigoAtual = codigoFinal;
                nomeAtual = nome;
                
                showLoading(false);
                mostrarResultado(codigoFinal, 'C√≥digo Gerado com Sucesso!');
                
            } catch (error) {
                console.error('Erro ao cadastrar:', error);
                showLoading(false);
                showAlert('Erro ao processar. Tente novamente.', 'warning');
            }
            
            return false;
        }
        
        // ============================================================
        // BUSCAR C√ìDIGO EXISTENTE
        // ============================================================
        async function buscarCodigo(event) {
            event.preventDefault();
            
            const telefone = document.getElementById('telefoneBusca').value.trim();
            const telefoneLimpo = telefone.replace(/\D/g, '');
            
            if (telefoneLimpo.length < 10) {
                showAlert('Digite um telefone v√°lido com DDD.', 'warning');
                return false;
            }
            
            showLoading(true);
            hideAlert();
            
            try {
                // Busca indicador pelo telefone
                const queryTel = await db.collection('indicadores')
                    .where('telefone', '==', telefoneLimpo)
                    .limit(1)
                    .get();
                
                if (!queryTel.empty) {
                    const doc = queryTel.docs[0];
                    const dados = doc.data();
                    
                    codigoAtual = dados.codigoIndicacao;
                    nomeAtual = dados.nome;
                    
                    showLoading(false);
                    mostrarResultado(codigoAtual, `Ol√°, ${nomeAtual.split(' ')[0]}! Seu c√≥digo:`);
                    return false;
                }
                
                // N√£o encontrou - verifica se tem lead com esse telefone
                const queryLead = await db.collection('leads_crm')
                    .where('whatsapp', '==', telefoneLimpo)
                    .limit(1)
                    .get();
                
                showLoading(false);
                
                if (!queryLead.empty) {
                    const leadData = queryLead.docs[0].data();
                    showAlert(`Encontramos seu cadastro, ${leadData.nome?.split(' ')[0] || ''}! Gere seu c√≥digo na aba "Quero Indicar".`, 'info');
                    
                    // Preenche o nome automaticamente
                    document.getElementById('nome').value = leadData.nome || '';
                    document.getElementById('telefone').value = telefone;
                    switchTab('novo');
                } else {
                    showAlert('Telefone n√£o encontrado. Cadastre-se como indicador!', 'info');
                    document.getElementById('telefone').value = telefone;
                    switchTab('novo');
                }
                
            } catch (error) {
                console.error('Erro ao buscar:', error);
                showLoading(false);
                showAlert('Erro ao buscar. Tente novamente.', 'warning');
            }
            
            return false;
        }
        
        // ============================================================
        // MOSTRAR RESULTADO
        // ============================================================
        function mostrarResultado(codigo, titulo) {
            document.getElementById('resultado-titulo').textContent = titulo;
            document.getElementById('codigoGerado').textContent = codigo;
            document.getElementById('resultado').classList.add('show');
            document.getElementById('ramosSection').classList.add('show');
            
            // Esconde formul√°rios
            document.getElementById('formNovo').style.display = 'none';
            document.getElementById('formExistente').style.display = 'none';
        }
        
        // ============================================================
        // COPIAR C√ìDIGO
        // ============================================================
        function copiarCodigo() {
            navigator.clipboard.writeText(codigoAtual).then(() => {
                showAlert('C√≥digo copiado! üìã', 'success');
            });
        }
        
        // ============================================================
        // SELECIONAR RAMO
        // ============================================================
        function selecionarRamo(ramo) {
            ramoSelecionado = ramo;
            
            // Marca visualmente
            document.querySelectorAll('.ramo-card').forEach(card => card.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            // Gera mensagem
            const mensagens = {
                auto: `Oi! üòä T√¥ com uma dica pra voc√™ que t√° sem seguro ou quer renovar.\n\nA Retorno Seguros faz cota√ß√£o gratuita e sem compromisso. Vale a pena dar uma olhada!\n\nüëá Solicite sua cota√ß√£o:`,
                residencial: `Oi! üè† J√° pensou na tranquilidade de ter sua casa protegida?\n\nInc√™ndio, roubo, danos el√©tricos... A cota√ß√£o √© gratuita e voc√™ se surpreende com o pre√ßo!\n\nüëá Solicite sua cota√ß√£o:`,
                vida: `Oi! üíö Voc√™ sabia que o seguro de vida n√£o √© s√≥ pra depois?\n\nTem cobertura pra diagn√≥stico de doen√ßas graves, afastamento do trabalho... √â uma prote√ß√£o em vida!\n\nüëá Saiba mais:`,
                empresarial: `Oi! üè¢ Se voc√™ tem empresa, j√° pensou em proteger seu patrim√¥nio?\n\nSeguro empresarial cobre inc√™ndio, roubo, responsabilidade civil... Cota√ß√£o sem compromisso!\n\nüëá Solicite:`,
            };
            
            const baseUrl = window.location.origin;
            const linkCotacao = getLinkCotacao(ramo);
            
            document.getElementById('msgPreview').textContent = mensagens[ramo];
            document.getElementById('compartilharSection').classList.add('show');
        }
        
        // ============================================================
        // GERAR LINK DE COTA√á√ÉO
        // ============================================================
        function getLinkCotacao(ramo) {
            const baseUrl = window.location.origin || 'https://retornoseguros.vercel.app';
            const paginas = {
                auto: 'cotacao-auto-v2.html',
                residencial: 'cotacao-residencial.html',
                vida: 'cotacao-vida.html',
                empresarial: 'index.html#empresarial'
            };
            
            return `${baseUrl}/${paginas[ramo]}?ref=${codigoAtual}`;
        }
        
        // ============================================================
        // COMPARTILHAR WHATSAPP
        // ============================================================
        function compartilharWhatsApp() {
            const mensagens = {
                auto: `Oi! üòä T√¥ com uma dica pra voc√™ que t√° sem seguro ou quer renovar.\n\nA Retorno Seguros faz cota√ß√£o gratuita e sem compromisso. Vale a pena dar uma olhada!\n\nüëá Solicite sua cota√ß√£o:\n`,
                residencial: `Oi! üè† J√° pensou na tranquilidade de ter sua casa protegida?\n\nInc√™ndio, roubo, danos el√©tricos... A cota√ß√£o √© gratuita e voc√™ se surpreende com o pre√ßo!\n\nüëá Solicite sua cota√ß√£o:\n`,
                vida: `Oi! üíö Voc√™ sabia que o seguro de vida n√£o √© s√≥ pra depois?\n\nTem cobertura pra diagn√≥stico de doen√ßas graves, afastamento do trabalho... √â uma prote√ß√£o em vida!\n\nüëá Saiba mais:\n`,
                empresarial: `Oi! üè¢ Se voc√™ tem empresa, j√° pensou em proteger seu patrim√¥nio?\n\nSeguro empresarial cobre inc√™ndio, roubo, responsabilidade civil... Cota√ß√£o sem compromisso!\n\nüëá Solicite:\n`,
            };
            
            const link = getLinkCotacao(ramoSelecionado);
            const msgCompleta = mensagens[ramoSelecionado] + link;
            
            const urlWhatsApp = `https://wa.me/?text=${encodeURIComponent(msgCompleta)}`;
            window.open(urlWhatsApp, '_blank');
        }
        
        // ============================================================
        // COPIAR LINK
        // ============================================================
        function copiarLink() {
            const link = getLinkCotacao(ramoSelecionado);
            navigator.clipboard.writeText(link).then(() => {
                showAlert('Link copiado! Envie para quem deseja indicar. üìã', 'success');
            });
        }
        
        // ============================================================
        // VERIFICAR PAR√ÇMETRO DA URL (se veio de algum lugar)
        // ============================================================
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const tel = urlParams.get('tel');
            
            if (tel) {
                document.getElementById('telefoneBusca').value = tel;
                switchTab('existente');
                document.getElementById('formExistente').dispatchEvent(new Event('submit'));
            }
        });
    </script>
</body>
</html>
