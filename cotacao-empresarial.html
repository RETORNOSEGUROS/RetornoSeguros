<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cota√ß√£o Seguro Empresarial | Retorno Seguros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --secondary: #06b6d4;
            --accent: #22d3ee;
            --dark-bg: #164e63;
            --light-bg: #ecfeff;
            --white: #ffffff;
            --text-dark: #1a2b3c;
            --text-light: #5a6b7c;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --shadow: 0 4px 20px rgba(8, 145, 178, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #cffafe 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        .header {
            background: var(--white);
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 700px;
            margin: 0 auto;
            display: flex;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .logo-text { font-weight: 800; font-size: 1.3rem; color: var(--text-dark); }
        .logo-sub { font-size: 0.7rem; color: var(--primary); font-weight: 600; text-transform: uppercase; }

        .progress-container { max-width: 700px; margin: 0 auto; padding: 1.5rem; }
        .progress-bar-wrapper { background: rgba(8,145,178,0.15); border-radius: 10px; height: 8px; overflow: hidden; margin-bottom: 0.75rem; }
        .progress-bar-fill { background: linear-gradient(90deg, var(--primary), var(--accent)); height: 100%; border-radius: 10px; transition: width 0.4s ease; }
        .progress-text { text-align: center; font-size: 0.85rem; color: var(--text-light); font-weight: 500; }

        .main-container { max-width: 700px; margin: 0 auto; padding: 0 1.5rem 3rem; }

        .step-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow);
            display: none;
            animation: slideIn 0.4s ease;
        }
        .step-card.active { display: block; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .step-icon { width: 70px; height: 70px; background: linear-gradient(135deg, rgba(8,145,178,0.1), rgba(6,182,212,0.1)); border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 1.5rem; }
        .step-title { text-align: center; font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: 0.5rem; }
        .step-subtitle { text-align: center; font-size: 0.95rem; color: var(--text-light); margin-bottom: 2rem; line-height: 1.5; }

        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; font-weight: 600; font-size: 0.9rem; color: var(--text-dark); margin-bottom: 0.5rem; }
        .form-input, .form-select { width: 100%; padding: 1rem 1.25rem; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; font-family: inherit; transition: all 0.3s ease; background: var(--white); }
        .form-input:focus, .form-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(8,145,178,0.1); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }

        .btn { width: 100%; padding: 1rem; border: none; border-radius: 12px; font-size: 1rem; font-weight: 700; cursor: pointer; transition: all 0.3s ease; font-family: inherit; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(8,145,178,0.3); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: transparent; color: var(--text-light); border: 2px solid #e2e8f0; margin-top: 0.75rem; }
        .btn-secondary:hover { background: var(--light-bg); border-color: var(--primary); color: var(--primary); }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1.5rem; }
        .option-card { background: var(--light-bg); border: 2px solid transparent; border-radius: 14px; padding: 1.25rem; cursor: pointer; transition: all 0.3s ease; text-align: center; }
        .option-card:hover { border-color: var(--primary); transform: translateY(-2px); }
        .option-card.selected { border-color: var(--primary); background: rgba(8,145,178,0.1); }
        .option-card .icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .option-card .title { font-weight: 700; font-size: 0.9rem; color: var(--text-dark); margin-bottom: 0.25rem; }
        .option-card .subtitle { font-size: 0.75rem; color: var(--text-light); line-height: 1.4; }

        .info-box { background: linear-gradient(135deg, rgba(59,130,246,0.1), rgba(59,130,246,0.05)); border: 2px solid var(--info); border-radius: 12px; padding: 1rem; margin-bottom: 1.5rem; }
        .info-box.success { background: linear-gradient(135deg, rgba(16,185,129,0.1), rgba(16,185,129,0.05)); border-color: var(--success); }
        .info-box.warning { background: linear-gradient(135deg, rgba(245,158,11,0.1), rgba(245,158,11,0.05)); border-color: var(--warning); }
        .info-box .info-header { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem; }
        .info-box .info-header span { font-weight: 700; color: var(--info); }
        .info-box.success .info-header span { color: var(--success); }
        .info-box.warning .info-header span { color: var(--warning); }
        .info-box p { font-size: 0.85rem; color: var(--text-dark); line-height: 1.5; }

        .objeto-item { background: var(--light-bg); border: 2px solid transparent; border-radius: 12px; padding: 1rem 1.25rem; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 1rem; }
        .objeto-item:hover { border-color: var(--primary); }
        .objeto-item.selected { border-color: var(--success); background: rgba(16,185,129,0.1); }
        .objeto-checkbox { width: 26px; height: 26px; border: 2px solid #cbd5e1; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s ease; font-size: 0.9rem; color: transparent; }
        .objeto-item.selected .objeto-checkbox { background: var(--success); border-color: var(--success); color: white; }
        .objeto-label { font-weight: 600; font-size: 1rem; color: var(--text-dark); }
        .objeto-valor-group { display: none; margin-bottom: 1rem; margin-top: -0.5rem; padding-left: 0.5rem; }
        .objeto-valor-group.visible { display: block; }

        .cobertura-card { background: var(--white); border: 2px solid #e2e8f0; border-radius: 14px; margin-bottom: 0.75rem; overflow: hidden; transition: all 0.3s ease; }
        .cobertura-card.selected { border-color: var(--success); background: linear-gradient(135deg, rgba(16,185,129,0.03), rgba(16,185,129,0.03)); }
        .cobertura-card.obrigatoria { border-color: var(--primary); background: linear-gradient(135deg, rgba(8,145,178,0.03), rgba(8,145,178,0.03)); }
        .cobertura-header { display: flex; align-items: center; gap: 0.75rem; padding: 1rem 1.25rem; cursor: pointer; }
        .cobertura-checkbox { width: 24px; height: 24px; border: 2px solid #cbd5e1; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.2s ease; font-size: 0.8rem; color: transparent; }
        .cobertura-card.selected .cobertura-checkbox, .cobertura-card.obrigatoria .cobertura-checkbox { background: var(--success); border-color: var(--success); color: white; }
        .cobertura-card.obrigatoria .cobertura-checkbox { background: var(--primary); border-color: var(--primary); }
        .cobertura-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--primary), var(--secondary)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; flex-shrink: 0; }
        .cobertura-info { flex: 1; }
        .cobertura-title { font-weight: 700; font-size: 0.95rem; color: var(--text-dark); display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
        .cobertura-title .badge { font-size: 0.65rem; background: var(--primary); color: white; padding: 0.2rem 0.5rem; border-radius: 4px; }
        .cobertura-desc { font-size: 0.8rem; color: var(--text-light); margin-top: 0.25rem; line-height: 1.4; }
        .cobertura-expand { color: var(--text-light); font-size: 1rem; transition: transform 0.3s ease; }
        .cobertura-card.expanded .cobertura-expand { transform: rotate(180deg); }
        .cobertura-details { display: none; padding: 0 1.25rem 1.25rem; border-top: 1px solid #e2e8f0; }
        .cobertura-card.expanded .cobertura-details { display: block; }
        .cobertura-full-desc { font-size: 0.85rem; color: var(--text-dark); line-height: 1.6; padding: 1rem 0 0.5rem; }
        .cobertura-valor-input { margin-top: 0.75rem; }
        .cobertura-valor-input label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--text-dark); margin-bottom: 0.4rem; }
        .cobertura-valor-input input { width: 100%; padding: 0.75rem 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.95rem; font-family: inherit; }
        .cobertura-valor-input input:focus { outline: none; border-color: var(--primary); }

        .loading-container { text-align: center; padding: 3rem 0; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(8,145,178,0.2); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 1.5rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 1.1rem; color: var(--text-dark); font-weight: 600; }
        .loading-subtext { font-size: 0.9rem; color: var(--text-light); margin-top: 0.5rem; }

        .summary-card { background: linear-gradient(135deg, var(--primary), var(--dark-bg)); border-radius: 20px; padding: 2rem; color: white; margin-bottom: 1.5rem; }
        .summary-title { font-size: 1rem; opacity: 0.9; text-align: center; margin-bottom: 0.5rem; }
        .summary-empresa { font-size: 1.5rem; font-weight: 800; text-align: center; margin-bottom: 1.5rem; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        .summary-item { background: rgba(255,255,255,0.15); border-radius: 10px; padding: 0.75rem; text-align: center; }
        .summary-item.full { grid-column: span 2; }
        .summary-item .label { font-size: 0.75rem; opacity: 0.85; margin-bottom: 0.25rem; }
        .summary-item .value { font-weight: 700; font-size: 0.95rem; }

        .coberturas-resumo { background: var(--white); border-radius: 14px; padding: 1.25rem; margin-bottom: 1.5rem; }
        .coberturas-resumo-title { font-weight: 700; color: var(--text-dark); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .cobertura-resumo-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e2e8f0; }
        .cobertura-resumo-item:last-child { border-bottom: none; }
        .cobertura-resumo-item .nome { font-size: 0.9rem; color: var(--text-dark); }
        .cobertura-resumo-item .valor { font-weight: 700; color: var(--primary); font-size: 0.9rem; }

        .whatsapp-btn { display: flex; align-items: center; justify-content: center; gap: 0.75rem; width: 100%; padding: 1.25rem; background: #25D366; color: white; text-decoration: none; border-radius: 12px; font-weight: 700; font-size: 1.1rem; transition: all 0.3s ease; margin-bottom: 0.75rem; }
        .whatsapp-btn:hover { background: #20bd5a; transform: translateY(-2px); }
        .whatsapp-btn svg { width: 24px; height: 24px; }

        .footer-note { text-align: center; font-size: 0.75rem; color: var(--text-light); margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid #e2e8f0; }

        @media (max-width: 600px) {
            .options-grid, .form-row, .summary-grid { grid-template-columns: 1fr; }
            .summary-item.full { grid-column: span 1; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">üè¢</div>
                <div>
                    <div class="logo-text">Retorno</div>
                    <div class="logo-sub">Seguro Empresarial</div>
                </div>
            </a>
        </div>
    </header>

    <div class="progress-container">
        <div class="progress-bar-wrapper">
            <div class="progress-bar-fill" id="progressBar" style="width: 12.5%"></div>
        </div>
        <p class="progress-text" id="progressText">Etapa 1 de 8</p>
    </div>

    <div class="main-container">
        <!-- Step 1 -->
        <div class="step-card active" id="step1">
            <div class="step-icon">üè¢</div>
            <h2 class="step-title">Proteja seu neg√≥cio!</h2>
            <p class="step-subtitle">Seguro completo para empresas com cobertura contra inc√™ndio, roubo, danos el√©tricos e muito mais.</p>
            
            <div class="info-box success">
                <div class="info-header"><span>üí°</span><span>Por que ter Seguro Empresarial?</span></div>
                <p>Proteja seu patrim√¥nio, equipamentos e mercadorias contra imprevistos. Garanta a continuidade do seu neg√≥cio.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Qual o nome da sua empresa?</label>
                <input type="text" class="form-input" id="nomeEmpresa" placeholder="Ex: Empresa XYZ Ltda">
            </div>

            <div class="form-group">
                <label class="form-label">CNPJ</label>
                <input type="text" class="form-input" id="cnpj" placeholder="00.000.000/0000-00" oninput="formatCNPJ(this)">
            </div>

            <button class="btn btn-primary" onclick="nextStep(1)">Come√ßar Cota√ß√£o ‚Üí</button>
        </div>

        <!-- Step 2 -->
        <div class="step-card" id="step2">
            <div class="step-icon">üè¨</div>
            <h2 class="step-title">Tipo de estabelecimento</h2>
            <p class="step-subtitle">Selecione o tipo que melhor descreve seu neg√≥cio.</p>

            <div class="options-grid">
                <div class="option-card" onclick="selectTipoEstabelecimento('escritorio', this)">
                    <div class="icon">üèõÔ∏è</div>
                    <div class="title">Escrit√≥rio</div>
                    <div class="subtitle">Servi√ßos, advocacia, contabilidade</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('consultorio', this)">
                    <div class="icon">üè•</div>
                    <div class="title">Consult√≥rio</div>
                    <div class="subtitle">M√©dico, odontol√≥gico, veterin√°rio</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('comercial', this)">
                    <div class="icon">üõí</div>
                    <div class="title">Com√©rcio</div>
                    <div class="subtitle">Loja, mercado, restaurante</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('industrial', this)">
                    <div class="icon">üè≠</div>
                    <div class="title">Ind√∫stria</div>
                    <div class="subtitle">F√°brica, galp√£o, produ√ß√£o</div>
                </div>
            </div>

            <button class="btn btn-primary" id="btnStep2" onclick="nextStep(2)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(2)">‚Üê Voltar</button>
        </div>

        <!-- Step 3 -->
        <div class="step-card" id="step3">
            <div class="step-icon">üìç</div>
            <h2 class="step-title">Localiza√ß√£o do risco</h2>
            <p class="step-subtitle">Informe o endere√ßo do estabelecimento a ser segurado.</p>

            <div class="form-group">
                <label class="form-label">CEP</label>
                <input type="text" class="form-input" id="cep" placeholder="00000-000" oninput="formatCEP(this)" onblur="buscarCEP()">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Cidade</label>
                    <input type="text" class="form-input" id="cidade" placeholder="Cidade">
                </div>
                <div class="form-group">
                    <label class="form-label">Estado</label>
                    <input type="text" class="form-input" id="estado" placeholder="UF" maxlength="2">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Bairro</label>
                <input type="text" class="form-input" id="bairro" placeholder="Bairro">
            </div>

            <div class="form-group">
                <label class="form-label">Constru√ß√£o em alvenaria?</label>
                <select class="form-select" id="alvenaria">
                    <option value="">Selecione...</option>
                    <option value="sim">Sim - Constru√ß√£o em alvenaria</option>
                    <option value="nao">N√£o - Outro tipo de constru√ß√£o</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="nextStep(3)">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(3)">‚Üê Voltar</button>
        </div>

        <!-- Step 4 -->
        <div class="step-card" id="step4">
            <div class="step-icon">üí∞</div>
            <h2 class="step-title">Valores do patrim√¥nio</h2>
            <p class="step-subtitle">Informe os valores aproximados para calcular a cobertura ideal.</p>

            <div class="info-box">
                <div class="info-header"><span>‚ÑπÔ∏è</span><span>O que segurar?</span></div>
                <p>Selecione os itens que deseja proteger e informe o valor estimado de cada um.</p>
            </div>

            <div class="objeto-item" id="objetoPredio" onclick="toggleObjeto('predio')">
                <div class="objeto-checkbox">‚úì</div>
                <span class="objeto-label">üèóÔ∏è Pr√©dio / Im√≥vel</span>
            </div>
            <div class="objeto-valor-group" id="valorPredioGroup">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label">Valor do Pr√©dio (R$)</label>
                    <input type="text" class="form-input" id="valorPredio" placeholder="Ex: 500.000" oninput="formatMoney(this)">
                </div>
            </div>

            <div class="objeto-item" id="objetoEquipamentos" onclick="toggleObjeto('equipamentos')">
                <div class="objeto-checkbox">‚úì</div>
                <span class="objeto-label">üñ•Ô∏è M√°quinas, M√≥veis e Equipamentos</span>
            </div>
            <div class="objeto-valor-group" id="valorEquipamentosGroup">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label">Valor dos Equipamentos (R$)</label>
                    <input type="text" class="form-input" id="valorEquipamentos" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                </div>
            </div>

            <div class="objeto-item" id="objetoMercadorias" onclick="toggleObjeto('mercadorias')">
                <div class="objeto-checkbox">‚úì</div>
                <span class="objeto-label">üì¶ Mercadorias e Mat√©rias Primas</span>
            </div>
            <div class="objeto-valor-group" id="valorMercadoriasGroup">
                <div class="form-group" style="margin-bottom: 0;">
                    <label class="form-label">Valor das Mercadorias (R$)</label>
                    <input type="text" class="form-input" id="valorMercadorias" placeholder="Ex: 200.000" oninput="formatMoney(this)">
                </div>
            </div>

            <button class="btn btn-primary" onclick="nextStep(4)" style="margin-top: 1.5rem;">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(4)">‚Üê Voltar</button>
        </div>

        <!-- Step 5 -->
        <div class="step-card" id="step5">
            <div class="step-icon">üìã</div>
            <h2 class="step-title">Situa√ß√£o atual</h2>
            <p class="step-subtitle">Seu estabelecimento j√° possui seguro?</p>

            <div class="options-grid">
                <div class="option-card" onclick="selectTemApolice('sim', this)">
                    <div class="icon">‚úÖ</div>
                    <div class="title">Sim, tenho seguro</div>
                    <div class="subtitle">Quero renovar ou trocar</div>
                </div>
                <div class="option-card" onclick="selectTemApolice('nao', this)">
                    <div class="icon">üÜï</div>
                    <div class="title">N√£o tenho</div>
                    <div class="subtitle">Primeira contrata√ß√£o</div>
                </div>
            </div>

            <div id="dadosApoliceAtual" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Quando vence a ap√≥lice atual?</label>
                    <input type="date" class="form-input" id="vencimentoApolice">
                </div>
                <div class="form-group">
                    <label class="form-label">Teve sinistro na √∫ltima vig√™ncia?</label>
                    <select class="form-select" id="teveSinistro">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o tive sinistro</option>
                        <option value="sim">Sim, tive sinistro</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" id="btnStep5" onclick="nextStep(5)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(5)">‚Üê Voltar</button>
        </div>

        <!-- Step 6: Coberturas -->
        <div class="step-card" id="step6">
            <div class="step-icon">üõ°Ô∏è</div>
            <h2 class="step-title">Escolha as coberturas</h2>
            <p class="step-subtitle">Personalize a prote√ß√£o. Clique para ver detalhes e definir valores.</p>

            <div id="coberturasContainer">
                <!-- B√°sica -->
                <div class="cobertura-card obrigatoria expanded" data-cobertura="basica">
                    <div class="cobertura-header" onclick="toggleCoberturaExpand(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üî•</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">B√°sica (Inc√™ndio, Raio, Explos√£o) <span class="badge">OBRIGAT√ìRIA</span></div>
                            <div class="cobertura-desc">Prote√ß√£o fundamental contra inc√™ndio e explos√£o</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Danos por inc√™ndio, queda de raio e explos√£o. √â a base de qualquer seguro empresarial.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (igual ao patrim√¥nio)</label>
                            <input type="text" id="valorBasica" placeholder="Preenchido automaticamente" disabled style="background: #f1f5f9;">
                        </div>
                    </div>
                </div>

                <!-- Vendaval -->
                <div class="cobertura-card" data-cobertura="vendaval">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üå™Ô∏è</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Vendaval e Granizo</div>
                            <div class="cobertura-desc">Ventos fortes, granizo, furac√£o e tornado</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Danos por vendaval (ventos acima de 54km/h), granizo, ciclone. Inclui telhados, vidros e fachadas.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorVendaval" placeholder="Ex: 200.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Danos El√©tricos -->
                <div class="cobertura-card" data-cobertura="danosEletricos">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">‚ö°</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Danos El√©tricos</div>
                            <div class="cobertura-desc">Queima de equipamentos por oscila√ß√£o</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Danos a equipamentos el√©tricos por varia√ß√µes de tens√£o, curto-circuito. Computadores, ar-condicionado, m√°quinas.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorDanosEletricos" placeholder="Ex: 50.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Roubo -->
                <div class="cobertura-card" data-cobertura="roubo">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üîì</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Roubo e Furto Qualificado</div>
                            <div class="cobertura-desc">Subtra√ß√£o com arrombamento ou viol√™ncia</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Roubo e furto qualificado de equipamentos, mercadorias e m√≥veis. Tamb√©m danos ao im√≥vel durante a a√ß√£o.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorRoubo" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Vidros -->
                <div class="cobertura-card" data-cobertura="vidros">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">ü™ü</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Quebra de Vidros e Vitrines</div>
                            <div class="cobertura-desc">Danos acidentais a vidros e espelhos</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Quebra acidental de vidros, espelhos, vitrines e letreiros luminosos.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorVidros" placeholder="Ex: 20.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Alagamento -->
                <div class="cobertura-card" data-cobertura="alagamento">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üåä</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Alagamento e Inunda√ß√£o</div>
                            <div class="cobertura-desc">Danos por enchentes e transbordamentos</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Danos por alagamento, enchente, inunda√ß√£o ou transbordamento.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorAlagamento" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- RC Empregador -->
                <div class="cobertura-card" data-cobertura="rcEmpregador">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üë∑</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">RC Empregador</div>
                            <div class="cobertura-desc">Acidentes de trabalho com funcion√°rios</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Indeniza√ß√µes por acidentes de trabalho al√©m do INSS. Despesas m√©dicas, pens√µes, danos morais.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorRcEmpregador" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- RC Estabelecimento -->
                <div class="cobertura-card" data-cobertura="rcEstabelecimento">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üè™</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">RC Estabelecimento Comercial</div>
                            <div class="cobertura-desc">Danos a clientes e visitantes</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Responsabilidade por danos a clientes e visitantes. Ex: escorreg√£o no piso molhado.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorRcEstabelecimento" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Perda Aluguel -->
                <div class="cobertura-card" data-cobertura="perdaAluguel">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üè†</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Perda de Aluguel</div>
                            <div class="cobertura-desc">Reembolso durante reconstru√ß√£o</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Reembolso do aluguel enquanto o im√≥vel estiver sendo reparado.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorPerdaAluguel" placeholder="Ex: 30.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Lucros Cessantes -->
                <div class="cobertura-card" data-cobertura="lucrosCessantes">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üìâ</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Lucros Cessantes / Paralisa√ß√£o</div>
                            <div class="cobertura-desc">Compensa√ß√£o por perda de faturamento</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Lucro que a empresa deixar de ter durante paralisa√ß√£o ap√≥s sinistro.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorLucrosCessantes" placeholder="Ex: 100.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Equipamentos Port√°teis -->
                <div class="cobertura-card" data-cobertura="equipamentosPortateis">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üì±</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Equipamentos Port√°teis</div>
                            <div class="cobertura-desc">Notebooks e celulares fora do estabelecimento</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Danos a equipamentos port√°teis mesmo fora do estabelecimento. Ideal para equipes externas.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorEquipamentosPortateis" placeholder="Ex: 30.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>

                <!-- Fidelidade -->
                <div class="cobertura-card" data-cobertura="fidelidade">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">ü§ù</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Fidelidade de Empregados</div>
                            <div class="cobertura-desc">Fraudes e atos dolosos de funcion√°rios</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc"><strong>O que cobre:</strong> Perdas por atos fraudulentos de empregados: roubo, desvio de dinheiro, falsifica√ß√£o.</p>
                        <div class="cobertura-valor-input">
                            <label>Valor da Cobertura (R$)</label>
                            <input type="text" id="valorFidelidade" placeholder="Ex: 50.000" oninput="formatMoney(this)">
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box warning" style="margin-top: 1.5rem;">
                <div class="info-header"><span>üí°</span><span>Dica de especialista</span></div>
                <p>As mais contratadas: B√°sica + Danos El√©tricos + Roubo + RC Estabelecimento. Adapte conforme seu neg√≥cio!</p>
            </div>

            <button class="btn btn-primary" onclick="nextStep(6)">Ver resumo da cota√ß√£o ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(6)">‚Üê Voltar</button>
        </div>

        <!-- Step 7: Loading -->
        <div class="step-card" id="step7">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Preparando sua cota√ß√£o...</p>
                <p class="loading-subtext">Analisando o melhor plano para sua empresa</p>
            </div>
        </div>

        <!-- Step 8: Resumo -->
        <div class="step-card" id="step8">
            <div class="step-icon">‚úÖ</div>
            <h2 class="step-title">Cota√ß√£o Pronta!</h2>
            <p class="step-subtitle">Confira o resumo do seu Seguro Empresarial</p>

            <div class="summary-card">
                <div class="summary-title">Seguro Empresarial</div>
                <div class="summary-empresa" id="summaryEmpresa">Empresa XYZ</div>
                <div class="summary-grid">
                    <div class="summary-item"><div class="label">Tipo</div><div class="value" id="summaryTipo">-</div></div>
                    <div class="summary-item"><div class="label">Cidade</div><div class="value" id="summaryCidade">-</div></div>
                    <div class="summary-item full"><div class="label">Valor Total em Risco</div><div class="value" id="summaryValor">-</div></div>
                </div>
            </div>

            <div class="coberturas-resumo">
                <div class="coberturas-resumo-title"><span>üõ°Ô∏è</span> Coberturas Selecionadas</div>
                <div id="coberturasResumoList"></div>
            </div>

            <div class="info-box success">
                <div class="info-header"><span>üéâ</span><span>Pr√≥ximo passo</span></div>
                <p>Para receber a proposta completa com valores, preencha seus dados e fale com nosso especialista.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Seu nome</label>
                <input type="text" class="form-input" id="nome" placeholder="Digite seu nome completo">
            </div>

            <div class="form-group">
                <label class="form-label">WhatsApp para contato</label>
                <input type="tel" class="form-input" id="whatsapp" placeholder="(00) 00000-0000" oninput="formatPhone(this)">
            </div>

            <button class="btn btn-primary" id="btnEnviar" onclick="enviarCotacao()">Solicitar Proposta Completa</button>

            <a href="#" class="whatsapp-btn" id="whatsappLink" style="display: none;">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                Falar com Especialista
            </a>

            <button class="btn btn-secondary" onclick="prevStep(8)">‚Üê Voltar e ajustar</button>
            <p class="footer-note">üîí Suas informa√ß√µes est√£o seguras. Trabalhamos com as maiores seguradoras do Brasil.</p>
        </div>
    </div>

    <script>
        // Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD3YZVqRbKExEi5CN9CPwlnY-GSzd4lUMM",
            authDomain: "retorno-seguros.firebaseapp.com",
            projectId: "retorno-seguros",
            storageBucket: "retorno-seguros.firebasestorage.app",
            messagingSenderId: "631323599837",
            appId: "1:631323599837:web:77f20f7c65a12113621856"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const urlParams = new URLSearchParams(window.location.search);
        const indicadorCodigo = urlParams.get('ref') || urlParams.get('indicador');
        const empresaParceiraCodigo = urlParams.get('empresa') || urlParams.get('parceiro');

        let formData = {
            nomeEmpresa: '', cnpj: '', tipoEstabelecimento: '',
            cep: '', cidade: '', estado: '', bairro: '', alvenaria: '',
            objetos: { predio: false, equipamentos: false, mercadorias: false },
            valores: { predio: 0, equipamentos: 0, mercadorias: 0 },
            temApolice: '', vencimentoApolice: '', teveSinistro: '',
            coberturas: [{nome: 'basica', valor: 0}],
            nome: '', whatsapp: ''
        };

        let currentStep = 1;
        const totalSteps = 8;

        function updateProgress() {
            document.getElementById('progressBar').style.width = (currentStep / totalSteps * 100) + '%';
            document.getElementById('progressText').textContent = `Etapa ${currentStep} de ${totalSteps}`;
        }

        function showStep(step) {
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            currentStep = step;
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep(current) {
            if (current === 1) {
                const nome = document.getElementById('nomeEmpresa').value.trim();
                if (!nome) { alert('Informe o nome da empresa.'); return; }
                formData.nomeEmpresa = nome;
                formData.cnpj = document.getElementById('cnpj').value.trim();
                showStep(2);
            } else if (current === 2) {
                if (!formData.tipoEstabelecimento) { alert('Selecione o tipo de estabelecimento.'); return; }
                showStep(3);
            } else if (current === 3) {
                formData.cep = document.getElementById('cep').value.trim();
                formData.cidade = document.getElementById('cidade').value.trim();
                formData.estado = document.getElementById('estado').value.trim();
                formData.bairro = document.getElementById('bairro').value.trim();
                formData.alvenaria = document.getElementById('alvenaria').value;
                if (!formData.cidade) { alert('Informe pelo menos a cidade.'); return; }
                showStep(4);
            } else if (current === 4) {
                if (!formData.objetos.predio && !formData.objetos.equipamentos && !formData.objetos.mercadorias) {
                    alert('Selecione pelo menos um item para segurar.'); return;
                }
                if (formData.objetos.predio) formData.valores.predio = parseMoney(document.getElementById('valorPredio').value);
                if (formData.objetos.equipamentos) formData.valores.equipamentos = parseMoney(document.getElementById('valorEquipamentos').value);
                if (formData.objetos.mercadorias) formData.valores.mercadorias = parseMoney(document.getElementById('valorMercadorias').value);
                const total = formData.valores.predio + formData.valores.equipamentos + formData.valores.mercadorias;
                document.getElementById('valorBasica').value = total.toLocaleString('pt-BR');
                formData.coberturas[0].valor = total;
                showStep(5);
            } else if (current === 5) {
                if (!formData.temApolice) { alert('Informe se j√° possui seguro.'); return; }
                formData.vencimentoApolice = document.getElementById('vencimentoApolice').value;
                formData.teveSinistro = document.getElementById('teveSinistro').value;
                showStep(6);
            } else if (current === 6) {
                coletarValoresCoberturas();
                showStep(7);
                setTimeout(() => { generateSummary(); showStep(8); }, 2500);
            }
        }

        function prevStep(current) { if (current > 1) showStep(current - 1); }

        function selectTipoEstabelecimento(tipo, el) {
            formData.tipoEstabelecimento = tipo;
            document.querySelectorAll('#step2 .option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('btnStep2').disabled = false;
        }

        function toggleObjeto(tipo) {
            formData.objetos[tipo] = !formData.objetos[tipo];
            const cap = tipo.charAt(0).toUpperCase() + tipo.slice(1);
            const item = document.getElementById('objeto' + cap);
            const group = document.getElementById('valor' + cap + 'Group');
            item.classList.toggle('selected', formData.objetos[tipo]);
            group.classList.toggle('visible', formData.objetos[tipo]);
        }

        function selectTemApolice(opcao, el) {
            formData.temApolice = opcao;
            document.querySelectorAll('#step5 .option-card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            document.getElementById('dadosApoliceAtual').style.display = opcao === 'sim' ? 'block' : 'none';
            document.getElementById('btnStep5').disabled = false;
        }

        function toggleCobertura(header) {
            const card = header.closest('.cobertura-card');
            const cob = card.dataset.cobertura;
            const wasSelected = card.classList.contains('selected');
            card.classList.toggle('selected');
            card.classList.toggle('expanded');
            if (!wasSelected) {
                if (!formData.coberturas.find(c => c.nome === cob)) formData.coberturas.push({nome: cob, valor: 0});
            } else {
                formData.coberturas = formData.coberturas.filter(c => c.nome !== cob);
            }
        }

        function toggleCoberturaExpand(header) {
            header.closest('.cobertura-card').classList.toggle('expanded');
        }

        function coletarValoresCoberturas() {
            const map = {
                vendaval: 'valorVendaval', danosEletricos: 'valorDanosEletricos', roubo: 'valorRoubo',
                vidros: 'valorVidros', alagamento: 'valorAlagamento', rcEmpregador: 'valorRcEmpregador',
                rcEstabelecimento: 'valorRcEstabelecimento', perdaAluguel: 'valorPerdaAluguel',
                lucrosCessantes: 'valorLucrosCessantes', equipamentosPortateis: 'valorEquipamentosPortateis',
                fidelidade: 'valorFidelidade'
            };
            formData.coberturas.forEach(cob => {
                if (cob.nome === 'basica') return;
                const input = document.getElementById(map[cob.nome]);
                if (input) cob.valor = parseMoney(input.value);
            });
        }

        function generateSummary() {
            document.getElementById('summaryEmpresa').textContent = formData.nomeEmpresa;
            const tipos = { escritorio: 'üèõÔ∏è Escrit√≥rio', consultorio: 'üè• Consult√≥rio', comercial: 'üõí Com√©rcio', industrial: 'üè≠ Ind√∫stria' };
            document.getElementById('summaryTipo').textContent = tipos[formData.tipoEstabelecimento] || '-';
            document.getElementById('summaryCidade').textContent = formData.cidade || '-';
            const total = formData.valores.predio + formData.valores.equipamentos + formData.valores.mercadorias;
            document.getElementById('summaryValor').textContent = 'R$ ' + total.toLocaleString('pt-BR');
            const nomes = {
                basica: 'üî• B√°sica', vendaval: 'üå™Ô∏è Vendaval', danosEletricos: '‚ö° Danos El√©tricos',
                roubo: 'üîì Roubo', vidros: 'ü™ü Vidros', alagamento: 'üåä Alagamento',
                rcEmpregador: 'üë∑ RC Empregador', rcEstabelecimento: 'üè™ RC Estabelecimento',
                perdaAluguel: 'üè† Perda Aluguel', lucrosCessantes: 'üìâ Lucros Cessantes',
                equipamentosPortateis: 'üì± Equip. Port√°teis', fidelidade: 'ü§ù Fidelidade'
            };
            document.getElementById('coberturasResumoList').innerHTML = formData.coberturas.map(c => 
                '<div class="cobertura-resumo-item"><span class="nome">' + (nomes[c.nome] || c.nome) + '</span><span class="valor">' + (c.valor > 0 ? 'R$ ' + c.valor.toLocaleString('pt-BR') : 'A definir') + '</span></div>'
            ).join('');
        }

        function formatCNPJ(input) {
            let v = input.value.replace(/\D/g, '').slice(0, 14);
            if (v.length > 12) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            else if (v.length > 8) v = v.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
            else if (v.length > 5) v = v.replace(/(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
            else if (v.length > 2) v = v.replace(/(\d{2})(\d{0,3})/, '$1.$2');
            input.value = v;
        }

        function formatCEP(input) {
            let v = input.value.replace(/\D/g, '').slice(0, 8);
            if (v.length > 5) v = v.replace(/(\d{5})(\d{0,3})/, '$1-$2');
            input.value = v;
        }

        function formatPhone(input) {
            let v = input.value.replace(/\D/g, '').slice(0, 11);
            if (v.length > 6) v = v.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            else if (v.length > 2) v = v.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            input.value = v;
        }

        function formatMoney(input) {
            input.value = (parseInt(input.value.replace(/\D/g, '')) || 0).toLocaleString('pt-BR');
        }

        function parseMoney(v) { return parseInt(v.replace(/\D/g, '')) || 0; }

        async function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length !== 8) return;
            try {
                const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await res.json();
                if (!data.erro) {
                    document.getElementById('cidade').value = data.localidade || '';
                    document.getElementById('estado').value = data.uf || '';
                    document.getElementById('bairro').value = data.bairro || '';
                }
            } catch (e) {}
        }

        async function enviarCotacao() {
            const nome = document.getElementById('nome').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            if (!nome) { alert('Informe seu nome.'); return; }
            if (!whatsapp || whatsapp.length < 14) { alert('Informe um WhatsApp v√°lido.'); return; }
            formData.nome = nome;
            formData.whatsapp = whatsapp;

            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.textContent = 'Enviando...';

            try {
                const total = formData.valores.predio + formData.valores.equipamentos + formData.valores.mercadorias;
                await db.collection('leads_crm').add({
                    nome: formData.nome, whatsapp: formData.whatsapp.replace(/\D/g, ''),
                    nomeEmpresa: formData.nomeEmpresa, cnpj: formData.cnpj,
                    tipoEstabelecimento: formData.tipoEstabelecimento,
                    cep: formData.cep, cidade: formData.cidade, estado: formData.estado,
                    bairro: formData.bairro, alvenaria: formData.alvenaria,
                    objetos: formData.objetos, valores: formData.valores, valorTotal: total,
                    temApolice: formData.temApolice, vencimentoApolice: formData.vencimentoApolice,
                    teveSinistro: formData.teveSinistro, coberturas: formData.coberturas,
                    ramo: 'empresarial', tipo: 'empresarial', status: 'pre_cadastro', origem: 'site',
                    indicadoPorCodigo: indicadorCodigo || null, empresaParceiraCodigo: empresaParceiraCodigo || null,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp()
                });

                btn.style.display = 'none';
                const link = document.getElementById('whatsappLink');
                link.style.display = 'flex';

                const tipos = { escritorio: 'Escrit√≥rio', consultorio: 'Consult√≥rio', comercial: 'Com√©rcio', industrial: 'Ind√∫stria' };
                const nomes = { basica: 'B√°sica', vendaval: 'Vendaval', danosEletricos: 'Danos El√©tricos', roubo: 'Roubo', vidros: 'Vidros', alagamento: 'Alagamento', rcEmpregador: 'RC Empregador', rcEstabelecimento: 'RC Estabelecimento', perdaAluguel: 'Perda Aluguel', lucrosCessantes: 'Lucros Cessantes', equipamentosPortateis: 'Equip. Port√°teis', fidelidade: 'Fidelidade' };
                const cobsMsg = formData.coberturas.map(c => (nomes[c.nome] || c.nome) + (c.valor > 0 ? ' (R$ ' + c.valor.toLocaleString('pt-BR') + ')' : '')).join(', ');
                const msg = `Ol√°! Sou *${formData.nome}* da empresa *${formData.nomeEmpresa}* e fiz cota√ß√£o de Seguro Empresarial.%0A%0Aüìä *Dados:*%0A‚Ä¢ Tipo: ${tipos[formData.tipoEstabelecimento]}%0A‚Ä¢ Cidade: ${formData.cidade}/${formData.estado}%0A‚Ä¢ Valor: R$ ${total.toLocaleString('pt-BR')}%0A%0Aüõ°Ô∏è *Coberturas:* ${cobsMsg}%0A%0AGostaria da proposta completa!`;
                link.href = `https://wa.me/5554997015000?text=${msg}`;
                alert('‚úÖ Cota√ß√£o enviada! Clique no WhatsApp para falar com especialista.');
            } catch (e) {
                console.error(e);
                btn.disabled = false;
                btn.textContent = 'Solicitar Proposta Completa';
                alert('Erro ao enviar. Tente novamente.');
            }
        }

        updateProgress();
    </script>
</body>
</html>
