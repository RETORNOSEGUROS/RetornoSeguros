<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cota√ß√£o Seguro Empresarial | Retorno Seguros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0891b2;
            --primary-dark: #0e7490;
            --secondary: #06b6d4;
            --accent: #22d3ee;
            --dark-bg: #164e63;
            --light-bg: #ecfeff;
            --white: #ffffff;
            --text-dark: #1a2b3c;
            --text-light: #5a6b7c;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
            --shadow: 0 4px 20px rgba(8, 145, 178, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #cffafe 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        .header {
            background: var(--white);
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 700px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .logo-text-container {
            display: flex;
            flex-direction: column;
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--text-dark);
        }

        .logo-sub {
            font-size: 0.7rem;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
        }

        .progress-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .progress-bar-wrapper {
            background: rgba(8, 145, 178, 0.15);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            height: 100%;
            border-radius: 10px;
            transition: width 0.4s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .main-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
        }

        .step-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow);
            display: none;
            animation: slideIn 0.4s ease;
        }

        .step-card.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.1), rgba(6, 182, 212, 0.1));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .step-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .step-subtitle {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-light);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(8, 145, 178, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-light);
            border: 2px solid #e2e8f0;
            margin-top: 0.75rem;
        }

        .btn-secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .options-grid.cols-3 {
            grid-template-columns: repeat(3, 1fr);
        }

        .options-grid.cols-4 {
            grid-template-columns: repeat(4, 1fr);
        }

        .option-card {
            background: var(--light-bg);
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .option-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(8, 145, 178, 0.1);
        }

        .option-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .option-card .title {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .option-card .subtitle {
            font-size: 0.75rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
            border: 2px solid var(--info);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-box.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border-color: var(--success);
        }

        .info-box.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            border-color: var(--warning);
        }

        .info-box .info-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .info-box .info-header span {
            font-weight: 700;
            color: var(--info);
        }

        .info-box.success .info-header span { color: var(--success); }
        .info-box.warning .info-header span { color: var(--warning); }

        .info-box p {
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Checkbox Items */
        .checkbox-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--light-bg);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--primary);
        }

        .checkbox-item.selected {
            border-color: var(--primary);
            background: rgba(8, 145, 178, 0.1);
        }

        .checkbox-item input {
            display: none;
        }

        .checkbox-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
            color: transparent;
        }

        .checkbox-item.selected .checkbox-custom {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .checkbox-label {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        /* Coberturas */
        .cobertura-card {
            background: var(--white);
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .cobertura-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.03), rgba(16, 185, 129, 0.03));
        }

        .cobertura-card.obrigatoria {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.03), rgba(8, 145, 178, 0.03));
        }

        .cobertura-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            cursor: pointer;
        }

        .cobertura-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .cobertura-card.selected .cobertura-checkbox,
        .cobertura-card.obrigatoria .cobertura-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .cobertura-card.obrigatoria .cobertura-checkbox {
            background: var(--primary);
            border-color: var(--primary);
        }

        .cobertura-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .cobertura-info {
            flex: 1;
        }

        .cobertura-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cobertura-title .badge {
            font-size: 0.65rem;
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .cobertura-desc {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
            line-height: 1.4;
        }

        .cobertura-expand {
            color: var(--text-light);
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .cobertura-card.expanded .cobertura-expand {
            transform: rotate(180deg);
        }

        .cobertura-details {
            display: none;
            padding: 0 1.25rem 1.25rem;
            border-top: 1px solid #e2e8f0;
        }

        .cobertura-card.expanded .cobertura-details {
            display: block;
        }

        .cobertura-full-desc {
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.6;
            padding: 1rem 0;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 3rem 0;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(8, 145, 178, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .loading-subtext {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        /* Summary */
        .summary-card {
            background: linear-gradient(135deg, var(--primary), var(--dark-bg));
            border-radius: 20px;
            padding: 2rem;
            color: white;
            margin-bottom: 1.5rem;
        }

        .summary-title {
            font-size: 1rem;
            opacity: 0.9;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .summary-empresa {
            font-size: 1.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .summary-item {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
        }

        .summary-item.full {
            grid-column: span 2;
        }

        .summary-item .label {
            font-size: 0.75rem;
            opacity: 0.85;
            margin-bottom: 0.25rem;
        }

        .summary-item .value {
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* Coberturas Resumo */
        .coberturas-resumo {
            background: var(--white);
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .coberturas-resumo-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cobertura-tag {
            display: inline-block;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 0.4rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin: 0.25rem;
        }

        /* WhatsApp Button */
        .whatsapp-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 1.25rem;
            background: #25D366;
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
        }

        .whatsapp-btn:hover {
            background: #20bd5a;
            transform: translateY(-2px);
        }

        .whatsapp-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Footer */
        .footer-note {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .options-grid, .checkbox-grid {
                grid-template-columns: 1fr;
            }
            .options-grid.cols-3, .options-grid.cols-4 {
                grid-template-columns: 1fr 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .summary-item.full {
                grid-column: span 1;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">üè¢</div>
                <div class="logo-text-container">
                    <span class="logo-text">Retorno</span>
                    <span class="logo-sub">Seguro Empresarial</span>
                </div>
            </a>
        </div>
    </header>

    <div class="progress-container">
        <div class="progress-bar-wrapper">
            <div class="progress-bar-fill" id="progressBar" style="width: 12.5%"></div>
        </div>
        <p class="progress-text" id="progressText">Etapa 1 de 8</p>
    </div>

    <div class="main-container">
        <!-- Step 1: Nome da Empresa -->
        <div class="step-card active" id="step1">
            <div class="step-icon">üè¢</div>
            <h2 class="step-title">Proteja seu neg√≥cio!</h2>
            <p class="step-subtitle">Seguro completo para empresas com cobertura contra inc√™ndio, roubo, danos el√©tricos e muito mais.</p>
            
            <div class="info-box success">
                <div class="info-header">
                    <span>üí°</span>
                    <span>Por que ter Seguro Empresarial?</span>
                </div>
                <p>Proteja seu patrim√¥nio, equipamentos e mercadorias contra imprevistos. Com coberturas flex√≠veis, voc√™ garante a continuidade do seu neg√≥cio mesmo diante de sinistros.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Qual o nome da sua empresa?</label>
                <input type="text" class="form-input" id="nomeEmpresa" placeholder="Ex: Empresa XYZ Ltda">
            </div>

            <div class="form-group">
                <label class="form-label">CNPJ</label>
                <input type="text" class="form-input" id="cnpj" placeholder="00.000.000/0000-00" oninput="formatCNPJ(this)">
            </div>

            <button class="btn btn-primary" onclick="nextStep(1)">
                Come√ßar Cota√ß√£o ‚Üí
            </button>
        </div>

        <!-- Step 2: Tipo de Estabelecimento -->
        <div class="step-card" id="step2">
            <div class="step-icon">üè¨</div>
            <h2 class="step-title">Tipo de estabelecimento</h2>
            <p class="step-subtitle">Selecione o tipo que melhor descreve seu neg√≥cio.</p>

            <div class="options-grid">
                <div class="option-card" onclick="selectTipoEstabelecimento('escritorio')">
                    <div class="icon">üèõÔ∏è</div>
                    <div class="title">Escrit√≥rio</div>
                    <div class="subtitle">Servi√ßos, advocacia, contabilidade, etc.</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('consultorio')">
                    <div class="icon">üè•</div>
                    <div class="title">Consult√≥rio</div>
                    <div class="subtitle">M√©dico, odontol√≥gico, veterin√°rio</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('comercial')">
                    <div class="icon">üõí</div>
                    <div class="title">Com√©rcio</div>
                    <div class="subtitle">Loja, mercado, restaurante</div>
                </div>
                <div class="option-card" onclick="selectTipoEstabelecimento('industrial')">
                    <div class="icon">üè≠</div>
                    <div class="title">Ind√∫stria</div>
                    <div class="subtitle">F√°brica, galp√£o, produ√ß√£o</div>
                </div>
            </div>

            <button class="btn btn-primary" id="btnStep2" onclick="nextStep(2)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(2)">‚Üê Voltar</button>
        </div>

        <!-- Step 3: Endere√ßo -->
        <div class="step-card" id="step3">
            <div class="step-icon">üìç</div>
            <h2 class="step-title">Localiza√ß√£o do risco</h2>
            <p class="step-subtitle">Informe o endere√ßo do estabelecimento a ser segurado.</p>

            <div class="form-group">
                <label class="form-label">CEP</label>
                <input type="text" class="form-input" id="cep" placeholder="00000-000" oninput="formatCEP(this)" onblur="buscarCEP()">
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">Cidade</label>
                    <input type="text" class="form-input" id="cidade" placeholder="Cidade">
                </div>
                <div class="form-group">
                    <label class="form-label">Estado</label>
                    <input type="text" class="form-input" id="estado" placeholder="UF" maxlength="2">
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Bairro</label>
                <input type="text" class="form-input" id="bairro" placeholder="Bairro">
            </div>

            <div class="form-group">
                <label class="form-label">Constru√ß√£o em alvenaria?</label>
                <select class="form-select" id="alvenaria">
                    <option value="">Selecione...</option>
                    <option value="sim">Sim - Constru√ß√£o em alvenaria</option>
                    <option value="nao">N√£o - Outro tipo de constru√ß√£o</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="nextStep(3)">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(3)">‚Üê Voltar</button>
        </div>

        <!-- Step 4: Valores -->
        <div class="step-card" id="step4">
            <div class="step-icon">üí∞</div>
            <h2 class="step-title">Valores do patrim√¥nio</h2>
            <p class="step-subtitle">Informe os valores aproximados para calcular a cobertura ideal.</p>

            <div class="info-box">
                <div class="info-header">
                    <span>‚ÑπÔ∏è</span>
                    <span>O que segurar?</span>
                </div>
                <p>Selecione os itens que deseja proteger e informe o valor estimado de cada um.</p>
            </div>

            <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                <label class="checkbox-item" onclick="toggleObjeto('predio')">
                    <input type="checkbox" id="checkPredio">
                    <div class="checkbox-custom">‚úì</div>
                    <span class="checkbox-label">üèóÔ∏è Pr√©dio / Im√≥vel</span>
                </label>
            </div>
            <div class="form-group" id="valorPredioGroup" style="display: none;">
                <label class="form-label">Valor do Pr√©dio (R$)</label>
                <input type="text" class="form-input" id="valorPredio" placeholder="Ex: 500.000" oninput="formatMoney(this)">
            </div>

            <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                <label class="checkbox-item" onclick="toggleObjeto('equipamentos')">
                    <input type="checkbox" id="checkEquipamentos">
                    <div class="checkbox-custom">‚úì</div>
                    <span class="checkbox-label">üñ•Ô∏è M√°quinas, M√≥veis e Equipamentos</span>
                </label>
            </div>
            <div class="form-group" id="valorEquipamentosGroup" style="display: none;">
                <label class="form-label">Valor dos Equipamentos (R$)</label>
                <input type="text" class="form-input" id="valorEquipamentos" placeholder="Ex: 100.000" oninput="formatMoney(this)">
            </div>

            <div class="checkbox-grid" style="grid-template-columns: 1fr;">
                <label class="checkbox-item" onclick="toggleObjeto('mercadorias')">
                    <input type="checkbox" id="checkMercadorias">
                    <div class="checkbox-custom">‚úì</div>
                    <span class="checkbox-label">üì¶ Mercadorias e Mat√©rias Primas</span>
                </label>
            </div>
            <div class="form-group" id="valorMercadoriasGroup" style="display: none;">
                <label class="form-label">Valor das Mercadorias (R$)</label>
                <input type="text" class="form-input" id="valorMercadorias" placeholder="Ex: 200.000" oninput="formatMoney(this)">
            </div>

            <button class="btn btn-primary" onclick="nextStep(4)" style="margin-top: 1rem;">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(4)">‚Üê Voltar</button>
        </div>

        <!-- Step 5: Ap√≥lice Atual -->
        <div class="step-card" id="step5">
            <div class="step-icon">üìã</div>
            <h2 class="step-title">Situa√ß√£o atual</h2>
            <p class="step-subtitle">Seu estabelecimento j√° possui seguro?</p>

            <div class="options-grid">
                <div class="option-card" onclick="selectTemApolice('sim')">
                    <div class="icon">‚úÖ</div>
                    <div class="title">Sim, tenho seguro</div>
                    <div class="subtitle">Quero renovar ou trocar</div>
                </div>
                <div class="option-card" onclick="selectTemApolice('nao')">
                    <div class="icon">üÜï</div>
                    <div class="title">N√£o tenho</div>
                    <div class="subtitle">Primeira contrata√ß√£o</div>
                </div>
            </div>

            <div id="dadosApoliceAtual" style="display: none;">
                <div class="form-group">
                    <label class="form-label">Quando vence a ap√≥lice atual?</label>
                    <input type="date" class="form-input" id="vencimentoApolice">
                </div>

                <div class="form-group">
                    <label class="form-label">Teve sinistro na √∫ltima vig√™ncia?</label>
                    <select class="form-select" id="teveSinistro">
                        <option value="">Selecione...</option>
                        <option value="nao">N√£o tive sinistro</option>
                        <option value="sim">Sim, tive sinistro</option>
                    </select>
                </div>
            </div>

            <button class="btn btn-primary" id="btnStep5" onclick="nextStep(5)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(5)">‚Üê Voltar</button>
        </div>

        <!-- Step 6: Coberturas -->
        <div class="step-card" id="step6">
            <div class="step-icon">üõ°Ô∏è</div>
            <h2 class="step-title">Escolha as coberturas</h2>
            <p class="step-subtitle">Personalize a prote√ß√£o do seu neg√≥cio. Clique para ver detalhes.</p>

            <div id="coberturasContainer">
                <!-- B√°sica (Obrigat√≥ria) -->
                <div class="cobertura-card obrigatoria expanded" data-cobertura="basica">
                    <div class="cobertura-header" onclick="toggleCoberturaExpand(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">üî•</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">B√°sica (Inc√™ndio, Raio e Explos√£o) <span class="badge">OBRIGAT√ìRIA</span></div>
                            <div class="cobertura-desc">Prote√ß√£o fundamental contra inc√™ndio, queda de raio e explos√£o</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Danos materiais causados por inc√™ndio, queda de raio dentro do terreno segurado e explos√£o de qualquer natureza. √â a cobertura base de qualquer seguro empresarial, protegendo o patrim√¥nio contra os riscos mais comuns e devastadores.
                        </p>
                    </div>
                </div>

                <!-- Vendaval/Granizo -->
                <div class="cobertura-card" data-cobertura="vendaval">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üå™Ô∏è</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Vendaval e Granizo</div>
                            <div class="cobertura-desc">Danos causados por ventos fortes, granizo, furac√£o e tornado</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Danos causados por vendaval (ventos acima de 54km/h), granizo, ciclone, tornado e furac√£o. Inclui danos a telhados, vidros, fachadas, equipamentos expostos e mercadorias atingidas pela a√ß√£o da natureza.
                        </p>
                    </div>
                </div>

                <!-- Danos El√©tricos -->
                <div class="cobertura-card" data-cobertura="danosEletricos">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">‚ö°</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Danos El√©tricos</div>
                            <div class="cobertura-desc">Queima de equipamentos por oscila√ß√£o de energia</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Danos a equipamentos el√©tricos e eletr√¥nicos causados por varia√ß√µes de tens√£o, curto-circuito, descargas el√©tricas e quedas de energia. Protege computadores, ar-condicionado, m√°quinas, sistemas de seguran√ßa e toda instala√ß√£o el√©trica.
                        </p>
                    </div>
                </div>

                <!-- Roubo -->
                <div class="cobertura-card" data-cobertura="roubo">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üîì</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Roubo e Furto Qualificado</div>
                            <div class="cobertura-desc">Subtra√ß√£o de bens mediante arrombamento ou viol√™ncia</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Roubo (com viol√™ncia ou grave amea√ßa) e furto qualificado (com arrombamento, escalada ou uso de chave falsa) de equipamentos, mercadorias, m√≥veis e utens√≠lios. Tamb√©m cobre danos ao im√≥vel causados durante a a√ß√£o criminosa.
                        </p>
                    </div>
                </div>

                <!-- Quebra de Vidros -->
                <div class="cobertura-card" data-cobertura="vidros">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">ü™ü</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Quebra de Vidros e Vitrines</div>
                            <div class="cobertura-desc">Danos acidentais a vidros, espelhos e vitrines</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Quebra acidental de vidros, espelhos, vitrines, letreiros luminosos e pain√©is de qualquer esp√©cie. Ideal para estabelecimentos comerciais com fachadas envidra√ßadas e exposi√ß√£o de produtos.
                        </p>
                    </div>
                </div>

                <!-- Alagamento -->
                <div class="cobertura-card" data-cobertura="alagamento">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üåä</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Alagamento e Inunda√ß√£o</div>
                            <div class="cobertura-desc">Danos causados por √°gua de enchentes e transbordamentos</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Danos causados por alagamento, enchente, inunda√ß√£o ou transbordamento de rios, c√≥rregos, galerias e bueiros. Protege o im√≥vel, equipamentos e mercadorias contra perdas por eventos de √°gua.
                        </p>
                    </div>
                </div>

                <!-- RC Empregador -->
                <div class="cobertura-card" data-cobertura="rcEmpregador">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üë∑</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">RC Empregador</div>
                            <div class="cobertura-desc">Responsabilidade civil por acidentes de trabalho</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Indeniza√ß√µes que a empresa for obrigada a pagar por acidentes de trabalho com funcion√°rios, al√©m do que j√° cobre o INSS. Inclui despesas m√©dicas, pens√µes e danos morais decorrentes de acidentes no exerc√≠cio do trabalho.
                        </p>
                    </div>
                </div>

                <!-- RC Estabelecimento -->
                <div class="cobertura-card" data-cobertura="rcEstabelecimento">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üè™</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">RC Estabelecimento Comercial</div>
                            <div class="cobertura-desc">Danos a terceiros (clientes e visitantes)</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Responsabilidade civil por danos causados a clientes, visitantes e prestadores de servi√ßo dentro do estabelecimento. Ex: cliente que escorrega no piso molhado, queda de produtos sobre visitantes, etc.
                        </p>
                    </div>
                </div>

                <!-- Perda de Aluguel -->
                <div class="cobertura-card" data-cobertura="perdaAluguel">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üè†</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Perda de Aluguel</div>
                            <div class="cobertura-desc">Reembolso de aluguel durante reconstru√ß√£o</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Reembolso do valor do aluguel que voc√™ deixar de receber (se for propriet√°rio locador) ou precisar pagar em outro local (se for locat√°rio) enquanto o im√≥vel estiver sendo reparado ap√≥s um sinistro coberto.
                        </p>
                    </div>
                </div>

                <!-- Lucros Cessantes -->
                <div class="cobertura-card" data-cobertura="lucrosCessantes">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üìâ</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Lucros Cessantes / Paralisa√ß√£o</div>
                            <div class="cobertura-desc">Compensa√ß√£o por perda de faturamento</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Indeniza√ß√£o pelo lucro l√≠quido que a empresa deixar de ter durante o per√≠odo de paralisa√ß√£o das atividades ap√≥s um sinistro coberto. Inclui despesas fixas como sal√°rios, impostos e contas que continuam mesmo sem faturamento.
                        </p>
                    </div>
                </div>

                <!-- Equipamentos -->
                <div class="cobertura-card" data-cobertura="equipamentos">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üñ•Ô∏è</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Equipamentos Eletr√¥nicos</div>
                            <div class="cobertura-desc">Prote√ß√£o completa para equipamentos de TI e eletr√¥nicos</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Danos a computadores, servidores, impressoras, sistemas de telefonia, equipamentos de seguran√ßa eletr√¥nica e outros dispositivos. Cobre queda, impacto, derramamento de l√≠quidos, al√©m dos riscos el√©tricos.
                        </p>
                    </div>
                </div>

                <!-- Fidelidade de Empregados -->
                <div class="cobertura-card" data-cobertura="fidelidade">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">ü§ù</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Fidelidade de Empregados</div>
                            <div class="cobertura-desc">Preju√≠zos causados por atos dolosos de funcion√°rios</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Perdas financeiras decorrentes de atos fraudulentos, desonestos ou criminosos cometidos por empregados, como roubo de mercadorias, desvio de dinheiro, falsifica√ß√£o de documentos, entre outros.
                        </p>
                    </div>
                </div>
            </div>

            <div class="info-box warning" style="margin-top: 1.5rem;">
                <div class="info-header">
                    <span>üí°</span>
                    <span>Dica de especialista</span>
                </div>
                <p>As coberturas mais contratadas para empresas s√£o: B√°sica + Danos El√©tricos + Roubo + RC Estabelecimento. Adapte conforme seu tipo de neg√≥cio!</p>
            </div>

            <button class="btn btn-primary" onclick="nextStep(6)">Ver resumo da cota√ß√£o ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(6)">‚Üê Voltar</button>
        </div>

        <!-- Step 7: Loading -->
        <div class="step-card" id="step7">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Preparando sua cota√ß√£o...</p>
                <p class="loading-subtext">Analisando o melhor plano para sua empresa</p>
            </div>
        </div>

        <!-- Step 8: Resumo -->
        <div class="step-card" id="step8">
            <div class="step-icon">‚úÖ</div>
            <h2 class="step-title">Cota√ß√£o Pronta!</h2>
            <p class="step-subtitle">Confira o resumo do seu Seguro Empresarial</p>

            <div class="summary-card">
                <div class="summary-title">Seguro Empresarial</div>
                <div class="summary-empresa" id="summaryEmpresa">Empresa XYZ</div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="label">Tipo</div>
                        <div class="value" id="summaryTipo">-</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Cidade</div>
                        <div class="value" id="summaryCidade">-</div>
                    </div>
                    <div class="summary-item full">
                        <div class="label">Valor Total em Risco</div>
                        <div class="value" id="summaryValor">-</div>
                    </div>
                </div>
            </div>

            <div class="coberturas-resumo">
                <div class="coberturas-resumo-title">
                    <span>üõ°Ô∏è</span> Coberturas Selecionadas
                </div>
                <div id="coberturasResumoList"></div>
            </div>

            <div class="info-box success">
                <div class="info-header">
                    <span>üéâ</span>
                    <span>Pr√≥ximo passo</span>
                </div>
                <p>Para receber a proposta completa com valores, preencha seus dados de contato e fale diretamente com nosso especialista.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Seu nome</label>
                <input type="text" class="form-input" id="nome" placeholder="Digite seu nome completo">
            </div>

            <div class="form-group">
                <label class="form-label">WhatsApp para contato</label>
                <input type="tel" class="form-input" id="whatsapp" placeholder="(00) 00000-0000" oninput="formatPhone(this)">
            </div>

            <button class="btn btn-primary" id="btnEnviar" onclick="enviarCotacao()">
                Solicitar Proposta Completa
            </button>

            <a href="#" class="whatsapp-btn" id="whatsappLink" style="display: none;">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                Falar com Especialista
            </a>

            <button class="btn btn-secondary" onclick="prevStep(8)">‚Üê Voltar e ajustar</button>

            <p class="footer-note">
                üîí Suas informa√ß√µes est√£o seguras. Trabalhamos com as maiores seguradoras do Brasil.
            </p>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD3YZVqRbKExEi5CN9CPwlnY-GSzd4lUMM",
            authDomain: "retorno-seguros.firebaseapp.com",
            projectId: "retorno-seguros",
            storageBucket: "retorno-seguros.firebasestorage.app",
            messagingSenderId: "631323599837",
            appId: "1:631323599837:web:77f20f7c65a12113621856"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // URL Params
        const urlParams = new URLSearchParams(window.location.search);
        const indicadorCodigo = urlParams.get('ref') || urlParams.get('indicador');
        let indicadorNome = null;
        const empresaParceiraCodigo = urlParams.get('empresa') || urlParams.get('parceiro');

        // Form Data
        let formData = {
            nomeEmpresa: '',
            cnpj: '',
            tipoEstabelecimento: '',
            cep: '',
            cidade: '',
            estado: '',
            bairro: '',
            alvenaria: '',
            objetos: {
                predio: false,
                equipamentos: false,
                mercadorias: false
            },
            valores: {
                predio: 0,
                equipamentos: 0,
                mercadorias: 0
            },
            temApolice: '',
            vencimentoApolice: '',
            teveSinistro: '',
            coberturas: ['basica'],
            nome: '',
            whatsapp: ''
        };

        let currentStep = 1;
        const totalSteps = 8;

        // Update Progress
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Etapa ${currentStep} de ${totalSteps}`;
        }

        // Show Step
        function showStep(step) {
            document.querySelectorAll('.step-card').forEach(card => card.classList.remove('active'));
            document.getElementById('step' + step).classList.add('active');
            currentStep = step;
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Next Step
        function nextStep(current) {
            if (current === 1) {
                const nomeEmpresa = document.getElementById('nomeEmpresa').value.trim();
                const cnpj = document.getElementById('cnpj').value.trim();
                if (!nomeEmpresa) {
                    alert('Por favor, informe o nome da empresa.');
                    return;
                }
                formData.nomeEmpresa = nomeEmpresa;
                formData.cnpj = cnpj;
                showStep(2);
            }
            else if (current === 2) {
                if (!formData.tipoEstabelecimento) {
                    alert('Por favor, selecione o tipo de estabelecimento.');
                    return;
                }
                showStep(3);
            }
            else if (current === 3) {
                formData.cep = document.getElementById('cep').value.trim();
                formData.cidade = document.getElementById('cidade').value.trim();
                formData.estado = document.getElementById('estado').value.trim();
                formData.bairro = document.getElementById('bairro').value.trim();
                formData.alvenaria = document.getElementById('alvenaria').value;
                
                if (!formData.cidade) {
                    alert('Por favor, informe pelo menos a cidade.');
                    return;
                }
                showStep(4);
            }
            else if (current === 4) {
                // Validar se pelo menos um objeto foi selecionado
                if (!formData.objetos.predio && !formData.objetos.equipamentos && !formData.objetos.mercadorias) {
                    alert('Por favor, selecione pelo menos um item para segurar.');
                    return;
                }
                
                // Coletar valores
                if (formData.objetos.predio) {
                    formData.valores.predio = parseMoney(document.getElementById('valorPredio').value);
                }
                if (formData.objetos.equipamentos) {
                    formData.valores.equipamentos = parseMoney(document.getElementById('valorEquipamentos').value);
                }
                if (formData.objetos.mercadorias) {
                    formData.valores.mercadorias = parseMoney(document.getElementById('valorMercadorias').value);
                }
                
                showStep(5);
            }
            else if (current === 5) {
                if (!formData.temApolice) {
                    alert('Por favor, informe se j√° possui seguro.');
                    return;
                }
                formData.vencimentoApolice = document.getElementById('vencimentoApolice').value;
                formData.teveSinistro = document.getElementById('teveSinistro').value;
                showStep(6);
            }
            else if (current === 6) {
                showStep(7);
                // Simular loading
                setTimeout(() => {
                    generateSummary();
                    showStep(8);
                }, 3000);
            }
        }

        // Previous Step
        function prevStep(current) {
            if (current > 1) {
                showStep(current - 1);
            }
        }

        // Select Tipo Estabelecimento
        function selectTipoEstabelecimento(tipo) {
            formData.tipoEstabelecimento = tipo;
            document.querySelectorAll('#step2 .option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            document.getElementById('btnStep2').disabled = false;
        }

        // Toggle Objeto
        function toggleObjeto(tipo) {
            formData.objetos[tipo] = !formData.objetos[tipo];
            const item = event.target.closest('.checkbox-item');
            item.classList.toggle('selected');
            
            // Mostrar/esconder campo de valor
            const valueGroup = document.getElementById('valor' + tipo.charAt(0).toUpperCase() + tipo.slice(1) + 'Group');
            if (formData.objetos[tipo]) {
                valueGroup.style.display = 'block';
            } else {
                valueGroup.style.display = 'none';
            }
        }

        // Select Tem Ap√≥lice
        function selectTemApolice(opcao) {
            formData.temApolice = opcao;
            document.querySelectorAll('#step5 .option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            
            // Mostrar/esconder campos adicionais
            if (opcao === 'sim') {
                document.getElementById('dadosApoliceAtual').style.display = 'block';
            } else {
                document.getElementById('dadosApoliceAtual').style.display = 'none';
            }
            
            document.getElementById('btnStep5').disabled = false;
        }

        // Toggle Cobertura
        function toggleCobertura(header) {
            const card = header.closest('.cobertura-card');
            const cobertura = card.dataset.cobertura;
            
            // Toggle selected
            card.classList.toggle('selected');
            card.classList.toggle('expanded');
            
            // Atualizar formData
            if (card.classList.contains('selected')) {
                if (!formData.coberturas.includes(cobertura)) {
                    formData.coberturas.push(cobertura);
                }
            } else {
                formData.coberturas = formData.coberturas.filter(c => c !== cobertura);
            }
        }

        // Toggle Cobertura Expand (s√≥ expande, n√£o seleciona - para obrigat√≥ria)
        function toggleCoberturaExpand(header) {
            const card = header.closest('.cobertura-card');
            card.classList.toggle('expanded');
        }

        // Generate Summary
        function generateSummary() {
            document.getElementById('summaryEmpresa').textContent = formData.nomeEmpresa;
            
            const tiposTexto = {
                'escritorio': 'üèõÔ∏è Escrit√≥rio',
                'consultorio': 'üè• Consult√≥rio',
                'comercial': 'üõí Com√©rcio',
                'industrial': 'üè≠ Ind√∫stria'
            };
            document.getElementById('summaryTipo').textContent = tiposTexto[formData.tipoEstabelecimento] || '-';
            document.getElementById('summaryCidade').textContent = formData.cidade || '-';
            
            const valorTotal = formData.valores.predio + formData.valores.equipamentos + formData.valores.mercadorias;
            document.getElementById('summaryValor').textContent = 'R$ ' + valorTotal.toLocaleString('pt-BR');
            
            // Coberturas
            const coberturasList = document.getElementById('coberturasResumoList');
            const nomesCoberturas = {
                basica: 'üî• B√°sica (Inc√™ndio)',
                vendaval: 'üå™Ô∏è Vendaval/Granizo',
                danosEletricos: '‚ö° Danos El√©tricos',
                roubo: 'üîì Roubo/Furto',
                vidros: 'ü™ü Quebra de Vidros',
                alagamento: 'üåä Alagamento',
                rcEmpregador: 'üë∑ RC Empregador',
                rcEstabelecimento: 'üè™ RC Estabelecimento',
                perdaAluguel: 'üè† Perda de Aluguel',
                lucrosCessantes: 'üìâ Lucros Cessantes',
                equipamentos: 'üñ•Ô∏è Equipamentos',
                fidelidade: 'ü§ù Fidelidade Empregados'
            };
            
            coberturasList.innerHTML = formData.coberturas.map(c => 
                '<span class="cobertura-tag">' + (nomesCoberturas[c] || c) + '</span>'
            ).join('');
        }

        // Format Functions
        function formatCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 14) value = value.slice(0, 14);
            
            if (value.length > 12) {
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            } else if (value.length > 8) {
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
            } else if (value.length > 5) {
                value = value.replace(/(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,3})/, '$1.$2');
            }
            
            input.value = value;
        }

        function formatCEP(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 8) value = value.slice(0, 8);
            if (value.length > 5) {
                value = value.replace(/(\d{5})(\d{0,3})/, '$1-$2');
            }
            input.value = value;
        }

        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 6) {
                value = value.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            
            input.value = value;
        }

        function formatMoney(input) {
            let value = input.value.replace(/\D/g, '');
            value = (parseInt(value) || 0).toLocaleString('pt-BR');
            input.value = value;
        }

        function parseMoney(value) {
            return parseInt(value.replace(/\D/g, '')) || 0;
        }

        // Buscar CEP
        async function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length !== 8) return;
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();
                
                if (!data.erro) {
                    document.getElementById('cidade').value = data.localidade || '';
                    document.getElementById('estado').value = data.uf || '';
                    document.getElementById('bairro').value = data.bairro || '';
                }
            } catch (error) {
                console.log('Erro ao buscar CEP');
            }
        }

        // Enviar Cota√ß√£o
        async function enviarCotacao() {
            const nome = document.getElementById('nome').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            
            if (!nome) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!whatsapp || whatsapp.length < 14) {
                alert('Por favor, informe um WhatsApp v√°lido.');
                return;
            }
            
            formData.nome = nome;
            formData.whatsapp = whatsapp;
            
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.textContent = 'Enviando...';
            
            try {
                const valorTotal = formData.valores.predio + formData.valores.equipamentos + formData.valores.mercadorias;
                
                // Save to Firebase
                await db.collection('leads_crm').add({
                    nome: formData.nome,
                    whatsapp: formData.whatsapp.replace(/\D/g, ''),
                    nomeEmpresa: formData.nomeEmpresa,
                    cnpj: formData.cnpj,
                    
                    tipoEstabelecimento: formData.tipoEstabelecimento,
                    cep: formData.cep,
                    cidade: formData.cidade,
                    estado: formData.estado,
                    bairro: formData.bairro,
                    alvenaria: formData.alvenaria,
                    
                    objetos: formData.objetos,
                    valores: formData.valores,
                    valorTotal: valorTotal,
                    
                    temApolice: formData.temApolice,
                    vencimentoApolice: formData.vencimentoApolice,
                    teveSinistro: formData.teveSinistro,
                    
                    coberturas: formData.coberturas,
                    
                    ramo: 'empresarial',
                    tipo: 'empresarial',
                    status: 'pre_cadastro',
                    origem: 'site',
                    
                    indicadoPorCodigo: indicadorCodigo || null,
                    indicadoPorNome: indicadorNome || null,
                    empresaParceiraCodigo: empresaParceiraCodigo || null,
                    
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp(),
                    dataCadastro: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Show WhatsApp button
                btn.style.display = 'none';
                const whatsappLink = document.getElementById('whatsappLink');
                whatsappLink.style.display = 'flex';
                
                // Create WhatsApp message
                const whatsNum = '5554997015000';
                
                const tiposTexto = {
                    'escritorio': 'Escrit√≥rio',
                    'consultorio': 'Consult√≥rio',
                    'comercial': 'Com√©rcio',
                    'industrial': 'Ind√∫stria'
                };
                
                const nomesCoberturas = {
                    basica: 'B√°sica',
                    vendaval: 'Vendaval',
                    danosEletricos: 'Danos El√©tricos',
                    roubo: 'Roubo',
                    vidros: 'Vidros',
                    alagamento: 'Alagamento',
                    rcEmpregador: 'RC Empregador',
                    rcEstabelecimento: 'RC Estabelecimento',
                    perdaAluguel: 'Perda Aluguel',
                    lucrosCessantes: 'Lucros Cessantes',
                    equipamentos: 'Equipamentos',
                    fidelidade: 'Fidelidade'
                };
                
                const coberturasMsg = formData.coberturas.map(c => nomesCoberturas[c] || c).join(', ');
                
                const msg = `Ol√°! Sou *${formData.nome}* da empresa *${formData.nomeEmpresa}* e acabei de fazer uma cota√ß√£o de Seguro Empresarial no site.%0A%0A` +
                    `üìä *Dados da cota√ß√£o:*%0A` +
                    `‚Ä¢ Empresa: ${formData.nomeEmpresa}%0A` +
                    `‚Ä¢ CNPJ: ${formData.cnpj || 'N√£o informado'}%0A` +
                    `‚Ä¢ Tipo: ${tiposTexto[formData.tipoEstabelecimento]}%0A` +
                    `‚Ä¢ Cidade: ${formData.cidade}/${formData.estado}%0A` +
                    `‚Ä¢ Valor em risco: R$ ${valorTotal.toLocaleString('pt-BR')}%0A%0A` +
                    `üõ°Ô∏è *Coberturas:* ${coberturasMsg}%0A%0A` +
                    `Gostaria de receber a proposta completa!`;
                
                whatsappLink.href = `https://wa.me/${whatsNum}?text=${msg}`;
                
                alert('‚úÖ Cota√ß√£o enviada com sucesso! Clique no bot√£o do WhatsApp para falar com um especialista.');
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                btn.disabled = false;
                btn.textContent = 'Solicitar Proposta Completa';
                alert('Erro ao enviar cota√ß√£o. Tente novamente.');
            }
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>
