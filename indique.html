
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Indique e Ganhe</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script>
    var firebaseConfig = {
      // CONFIG FIREBASE AQUI
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>
</head>
<body style="font-family: sans-serif; background: #f4f6fa; padding: 40px;">
  <div style="max-width: 600px; background: white; margin: auto; padding: 30px; border-radius: 12px;">
    <h2 style="color:#1b2c5c;">Indique e Ganhe</h2>
    <p>Compartilhe seu link exclusivo. Quando alguém se cadastrar com ele, você ganha créditos.</p>
    <input id="link" style="width: 100%; padding: 10px;" readonly />
    <button onclick="copiarLink()" style="margin-top: 10px; padding: 10px 20px; background: #1b2c5c; color: white; border: none; border-radius: 4px;">Copiar link</button>
    <div style="margin-top: 30px; background: #e8f0ff; padding: 20px; border-left: 4px solid #1b2c5c;">
      <p><strong>Indicações realizadas:</strong> <span id="indicacoes">0</span></p>
      <p><strong>Créditos ganhos:</strong> <span id="creditos">0</span></p>
    </div>
    <div id="lista-indicados" style="margin-top: 20px;"></div>
  </div>

  <script>
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        const uid = user.uid;
        const link = window.location.origin + "/cadastro.html?indicador=" + uid;
        document.getElementById("link").value = link;

        db.collection("usuarios").doc(uid).get().then(doc => {
          if (doc.exists) {
            document.getElementById("creditos").textContent = doc.data().creditos || 0;
          }
        });

        db.collection("usuarios").where("usuarioIndicadorId", "==", uid).get()
          .then(snapshot => {
            const qtd = snapshot.size;
            document.getElementById("indicacoes").textContent = qtd;

            const container = document.getElementById("lista-indicados");
            container.innerHTML = "<strong>Indicados:</strong><br>";

            snapshot.forEach(doc => {
              const dados = doc.data();
              const nome = dados.nome || "Nome não informado";
              const data = dados.dataCadastro && dados.dataCadastro.seconds 
                           ? new Date(dados.dataCadastro.seconds * 1000).toLocaleDateString() 
                           : "Data não disponível";
              container.innerHTML += `• ${nome} - ${data}<br>`;
            });
          });
      }
    });

    function copiarLink() {
      const copyText = document.getElementById("link");
      copyText.select();
      document.execCommand("copy");
      alert("Link copiado!");
    }
  </script>
</body>
</html>
