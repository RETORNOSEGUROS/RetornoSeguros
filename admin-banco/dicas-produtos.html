<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Gest√£o de Dicas de Produtos - Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="../js/firebase-config.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--primary:#7c3aed;--primary-hover:#6d28d9;--success:#10b981;--warning:#f59e0b;--danger:#ef4444;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-900:#111827;--shadow:0 1px 3px rgba(0,0,0,.1);--shadow-md:0 4px 6px -1px rgba(0,0,0,.1);--shadow-lg:0 10px 15px -3px rgba(0,0,0,.1)}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:linear-gradient(135deg,#7c3aed 0%,#5b21b6 100%);min-height:100vh;padding:20px;color:var(--gray-900)}
    .container{max-width:1200px;margin:0 auto}
    .header{background:#fff;border-radius:16px;padding:20px 28px;margin-bottom:20px;box-shadow:var(--shadow-md);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px}
    .header-left{display:flex;align-items:center;gap:16px}
    .btn-back{background:var(--gray-100);border:none;border-radius:10px;padding:10px 16px;cursor:pointer;display:flex;align-items:center;gap:8px;font-weight:600;color:var(--gray-700);transition:all .2s;font-size:14px}
    .btn-back:hover{background:var(--gray-200);transform:translateX(-2px)}
    .header-title h1{font-size:24px;font-weight:700;color:var(--gray-900)}
    .header-title p{font-size:13px;color:var(--gray-600)}
    .card{background:#fff;border-radius:16px;padding:24px;margin-bottom:20px;box-shadow:var(--shadow-md)}
    .card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--gray-100)}
    .card-header h2{font-size:18px;font-weight:600;color:var(--gray-900)}
    .btn{padding:10px 20px;border:none;border-radius:8px;font-weight:600;font-size:14px;cursor:pointer;transition:all .2s;display:inline-flex;align-items:center;gap:6px}
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-hover)}
    .btn-success{background:var(--success);color:#fff}
    .btn-success:hover{background:#059669}
    .btn-secondary{background:var(--gray-100);color:var(--gray-700)}
    .btn-secondary:hover{background:var(--gray-200)}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-danger:hover{background:#dc2626}
    .btn-sm{padding:8px 14px;font-size:13px}
    .form-group{margin-bottom:16px}
    .form-group label{display:block;font-size:13px;font-weight:600;color:var(--gray-700);margin-bottom:6px}
    .form-control{width:100%;padding:12px 14px;border:2px solid var(--gray-200);border-radius:8px;font-size:14px;transition:all .2s}
    .form-control:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(124,58,237,.1)}
    textarea.form-control{min-height:120px;resize:vertical;font-family:inherit}
    .form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .produtos-grid{display:grid;gap:16px}
    .produto-card{background:var(--gray-50);border:2px solid var(--gray-200);border-radius:12px;padding:20px;transition:all .2s}
    .produto-card:hover{border-color:var(--primary);box-shadow:var(--shadow)}
    .produto-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:12px}
    .produto-icon{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:24px}
    .produto-icon.empresarial{background:#dbeafe;color:#1e40af}
    .produto-icon.auto{background:#fef3c7;color:#92400e}
    .produto-icon.vida{background:#d1fae5;color:#065f46}
    .produto-icon.saude{background:#fce7f3;color:#9d174d}
    .produto-icon.patrimonial{background:#e0e7ff;color:#3730a3}
    .produto-icon.outros{background:#f3f4f6;color:#374151}
    .produto-info h3{font-size:16px;font-weight:600;color:var(--gray-900);margin-bottom:4px}
    .produto-info p{font-size:13px;color:var(--gray-600)}
    .produto-actions{display:flex;gap:8px}
    .badge{display:inline-flex;align-items:center;padding:4px 10px;border-radius:999px;font-size:11px;font-weight:600}
    .badge-success{background:#d1fae5;color:#065f46}
    .badge-warning{background:#fef3c7;color:#92400e}
    .drawer-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);opacity:0;visibility:hidden;transition:all .3s;z-index:999}
    .drawer-overlay.active{opacity:1;visibility:visible}
    .drawer{position:fixed;top:0;right:-700px;width:700px;height:100%;background:#fff;box-shadow:-4px 0 24px rgba(0,0,0,.15);transition:right .3s;z-index:1000;overflow-y:auto}
    .drawer.open{right:0}
    .drawer-header{padding:20px 24px;border-bottom:2px solid var(--gray-100);background:var(--gray-50);position:sticky;top:0;z-index:10}
    .drawer-header h3{font-size:18px;font-weight:700;color:var(--gray-900)}
    .drawer-body{padding:24px}
    .section-title{font-size:14px;font-weight:700;color:var(--primary);margin:24px 0 12px;padding-bottom:8px;border-bottom:2px solid var(--gray-100);text-transform:uppercase;letter-spacing:.5px}
    .section-title:first-child{margin-top:0}
    .toast{position:fixed;bottom:20px;right:20px;background:#fff;padding:14px 20px;border-radius:10px;box-shadow:var(--shadow-lg);transform:translateY(100px);opacity:0;transition:all .3s;z-index:2000;font-weight:600;font-size:14px}
    .toast.show{transform:translateY(0);opacity:1}
    .toast-success{border-left:4px solid var(--success)}
    .toast-error{border-left:4px solid var(--danger)}
    .empty-state{text-align:center;padding:60px 20px;color:var(--gray-500)}
    .empty-state svg{margin-bottom:16px;opacity:.5}
    .categoria-select{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
    .categoria-btn{padding:8px 16px;border:2px solid var(--gray-200);background:#fff;border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
    .categoria-btn:hover,.categoria-btn.active{border-color:var(--primary);background:var(--primary);color:#fff}
    .hint{font-size:12px;color:var(--gray-500);margin-top:4px}
    .preview-box{background:var(--gray-900);color:#fff;border-radius:8px;padding:16px;margin-top:12px;font-size:13px;white-space:pre-wrap;font-family:monospace;max-height:200px;overflow-y:auto}
    @media(max-width:768px){body{padding:12px}.header{padding:16px;flex-direction:column;align-items:stretch}.drawer{width:100%;right:-100%}.form-row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-left">
        <button class="btn-back" onclick="window.location.href='../painel.html'">
          <svg width="18" height="18" viewBox="0 0 20 20" fill="none"><path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
          Voltar
        </button>
        <div class="header-title">
          <h1>üìö Gest√£o de Dicas de Produtos</h1>
          <p>Configure informa√ß√µes para os gerentes usarem em campo</p>
        </div>
      </div>
      <button class="btn btn-primary" onclick="abrirDrawer()">‚ûï Novo Produto</button>
    </div>

    <div class="card">
      <div class="card-header">
        <h2>Produtos Cadastrados</h2>
        <div class="categoria-select" id="filtroCategoria">
          <button class="categoria-btn active" data-cat="">Todos</button>
          <button class="categoria-btn" data-cat="empresarial">Empresarial</button>
          <button class="categoria-btn" data-cat="auto">Auto/Frota</button>
          <button class="categoria-btn" data-cat="vida">Vida</button>
          <button class="categoria-btn" data-cat="saude">Sa√∫de/Dental</button>
          <button class="categoria-btn" data-cat="patrimonial">Patrimonial</button>
          <button class="categoria-btn" data-cat="outros">Outros</button>
        </div>
      </div>
      <div class="produtos-grid" id="listaProdutos">
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none"><path d="M12 6V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <p>Carregando produtos...</p>
        </div>
      </div>
    </div>
  </div>

  <div class="drawer-overlay" id="drawerOverlay" onclick="fecharDrawer()"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <h3 id="drawerTitle">Novo Produto</h3>
    </div>
    <div class="drawer-body">
      <input type="hidden" id="produtoId">
      
      <div class="form-row">
        <div class="form-group">
          <label>Nome do Produto *</label>
          <input type="text" class="form-control" id="nomeProduto" placeholder="Ex: Seguro de Frota">
        </div>
        <div class="form-group">
          <label>Categoria *</label>
          <select class="form-control" id="categoriaProduto">
            <option value="empresarial">üè¢ Empresarial</option>
            <option value="auto">üöó Auto/Frota</option>
            <option value="vida">‚ù§Ô∏è Vida</option>
            <option value="saude">üè• Sa√∫de/Dental</option>
            <option value="patrimonial">üè† Patrimonial</option>
            <option value="outros">üì¶ Outros</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>Descri√ß√£o Curta</label>
        <input type="text" class="form-control" id="descricaoCurta" placeholder="Resumo em uma linha">
      </div>

      <div class="section-title">üìã O que √© o Produto</div>
      <div class="form-group">
        <label>Explica√ß√£o para o Cliente</label>
        <textarea class="form-control" id="oQueE" placeholder="Descreva o produto de forma clara e profissional..."></textarea>
        <div class="hint">Texto que o gerente pode usar para explicar ao cliente</div>
      </div>

      <div class="section-title">‚úÖ Benef√≠cios e Diferenciais</div>
      <div class="form-group">
        <label>Lista de Benef√≠cios</label>
        <textarea class="form-control" id="beneficios" placeholder="‚Ä¢ Benef√≠cio 1&#10;‚Ä¢ Benef√≠cio 2&#10;‚Ä¢ Benef√≠cio 3"></textarea>
        <div class="hint">Use bullet points (‚Ä¢) para listar</div>
      </div>

      <div class="section-title">üìù Documentos para Cota√ß√£o</div>
      <div class="form-group">
        <label>O que pedir ao cliente</label>
        <textarea class="form-control" id="documentos" placeholder="‚Ä¢ CNPJ&#10;‚Ä¢ Ap√≥lice anterior&#10;‚Ä¢ Planilha de..."></textarea>
        <div class="hint">Lista de documentos/informa√ß√µes necess√°rias</div>
      </div>

      <div class="section-title">üí¨ Mensagem para WhatsApp</div>
      <div class="form-group">
        <label>Texto pronto para copiar</label>
        <textarea class="form-control" id="mensagemWhats" style="min-height:150px" placeholder="Ol√°! Para cotarmos o [PRODUTO], precisamos de:&#10;&#10;üìã Documentos:&#10;‚Ä¢ Item 1&#10;‚Ä¢ Item 2&#10;&#10;Assim que tiver, me envie que retorno com as melhores op√ß√µes!"></textarea>
        <div class="hint">Mensagem profissional pronta para o gerente enviar</div>
      </div>

      <div class="section-title">üß† Gatilhos Mentais (Uso Interno)</div>
      <div class="form-group">
        <label>Para clientes que J√Å T√äM seguro</label>
        <textarea class="form-control" id="gatilhosComSeguro" placeholder="Argumentos para convencer quem j√° tem ap√≥lice em outra corretora..."></textarea>
      </div>
      <div class="form-group">
        <label>Para clientes que N√ÉO T√äM seguro</label>
        <textarea class="form-control" id="gatilhosSemSeguro" placeholder="Argumentos para convencer quem nunca contratou..."></textarea>
      </div>

      <div class="section-title">üìä Dicas Comerciais</div>
      <div class="form-group">
        <label>Estrat√©gias de Venda</label>
        <textarea class="form-control" id="dicasComerciais" placeholder="Dicas para o gerente usar na negocia√ß√£o..."></textarea>
      </div>

      <div style="display:flex;gap:12px;margin-top:24px;padding-top:20px;border-top:2px solid var(--gray-100)">
        <button class="btn btn-success" onclick="salvarProduto()" style="flex:1">üíæ Salvar Produto</button>
        <button class="btn btn-secondary" onclick="fecharDrawer()">Cancelar</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
if(!firebase.apps.length&&typeof firebaseConfig!=="undefined")firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();
const COL=db.collection("dicas_produtos");

const $=id=>document.getElementById(id);
let produtos=[],filtroAtual="";

function showToast(msg,type='success'){const t=$('toast');t.textContent=msg;t.className=`toast toast-${type} show`;setTimeout(()=>t.classList.remove('show'),3000)}

auth.onAuthStateChanged(async user=>{
  if(!user){location.href="../login.html";return}
  // Verificar se √© admin
  const isAdmin=user.email==="patrick@retornoseguros.com.br";
  if(!isAdmin){alert("Acesso restrito a administradores");location.href="../painel.html";return}
  await carregarProdutos();
  setupFiltros();
});

async function carregarProdutos(){
  const snap=await COL.orderBy("nome").get();
  produtos=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderProdutos();
}

function setupFiltros(){
  document.querySelectorAll(".categoria-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".categoria-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      filtroAtual=btn.dataset.cat;
      renderProdutos();
    });
  });
}

function renderProdutos(){
  const container=$("listaProdutos");
  let lista=produtos;
  if(filtroAtual)lista=produtos.filter(p=>p.categoria===filtroAtual);
  
  if(!lista.length){
    container.innerHTML=`<div class="empty-state"><svg width="64" height="64" viewBox="0 0 24 24" fill="none"><path d="M12 6V12M12 16H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg><p style="font-size:16px;font-weight:600">Nenhum produto cadastrado</p><p style="margin-top:8px">Clique em "Novo Produto" para come√ßar</p></div>`;
    return;
  }

  container.innerHTML=lista.map(p=>{
    const iconClass=p.categoria||'outros';
    const icons={empresarial:'üè¢',auto:'üöó',vida:'‚ù§Ô∏è',saude:'üè•',patrimonial:'üè†',outros:'üì¶'};
    return`
    <div class="produto-card">
      <div class="produto-header">
        <div style="display:flex;gap:14px;align-items:start">
          <div class="produto-icon ${iconClass}">${icons[iconClass]||'üì¶'}</div>
          <div class="produto-info">
            <h3>${p.nome||'Sem nome'}</h3>
            <p>${p.descricaoCurta||'Sem descri√ß√£o'}</p>
          </div>
        </div>
        <div class="produto-actions">
          <button class="btn btn-secondary btn-sm" onclick="editarProduto('${p.id}')">‚úèÔ∏è Editar</button>
          <button class="btn btn-danger btn-sm" onclick="excluirProduto('${p.id}')">üóëÔ∏è</button>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-top:12px">
        ${p.mensagemWhats?'<span class="badge badge-success">‚úì WhatsApp</span>':'<span class="badge badge-warning">‚ö† Sem WhatsApp</span>'}
        ${p.gatilhosComSeguro||p.gatilhosSemSeguro?'<span class="badge badge-success">‚úì Gatilhos</span>':''}
        ${p.documentos?'<span class="badge badge-success">‚úì Docs</span>':''}
      </div>
    </div>`;
  }).join('');
}

function abrirDrawer(id=null){
  $("drawerTitle").textContent=id?"Editar Produto":"Novo Produto";
  $("produtoId").value=id||"";
  
  if(id){
    const p=produtos.find(x=>x.id===id);
    if(p){
      $("nomeProduto").value=p.nome||"";
      $("categoriaProduto").value=p.categoria||"empresarial";
      $("descricaoCurta").value=p.descricaoCurta||"";
      $("oQueE").value=p.oQueE||"";
      $("beneficios").value=p.beneficios||"";
      $("documentos").value=p.documentos||"";
      $("mensagemWhats").value=p.mensagemWhats||"";
      $("gatilhosComSeguro").value=p.gatilhosComSeguro||"";
      $("gatilhosSemSeguro").value=p.gatilhosSemSeguro||"";
      $("dicasComerciais").value=p.dicasComerciais||"";
    }
  }else{
    ["nomeProduto","descricaoCurta","oQueE","beneficios","documentos","mensagemWhats","gatilhosComSeguro","gatilhosSemSeguro","dicasComerciais"].forEach(id=>$(id).value="");
    $("categoriaProduto").value="empresarial";
  }
  
  $("drawer").classList.add("open");
  $("drawerOverlay").classList.add("active");
}

function fecharDrawer(){
  $("drawer").classList.remove("open");
  $("drawerOverlay").classList.remove("active");
}

function editarProduto(id){abrirDrawer(id)}

async function excluirProduto(id){
  if(!confirm("Tem certeza que deseja excluir este produto?"))return;
  try{
    await COL.doc(id).delete();
    showToast("Produto exclu√≠do!");
    await carregarProdutos();
  }catch(e){
    console.error(e);
    showToast("Erro ao excluir","error");
  }
}

async function salvarProduto(){
  const id=$("produtoId").value;
  const nome=$("nomeProduto").value.trim();
  if(!nome){showToast("Informe o nome do produto","error");return}
  
  const dados={
    nome,
    categoria:$("categoriaProduto").value,
    descricaoCurta:$("descricaoCurta").value.trim(),
    oQueE:$("oQueE").value.trim(),
    beneficios:$("beneficios").value.trim(),
    documentos:$("documentos").value.trim(),
    mensagemWhats:$("mensagemWhats").value.trim(),
    gatilhosComSeguro:$("gatilhosComSeguro").value.trim(),
    gatilhosSemSeguro:$("gatilhosSemSeguro").value.trim(),
    dicasComerciais:$("dicasComerciais").value.trim(),
    updatedAt:firebase.firestore.FieldValue.serverTimestamp()
  };
  
  try{
    if(id){
      await COL.doc(id).update(dados);
    }else{
      dados.createdAt=firebase.firestore.FieldValue.serverTimestamp();
      await COL.add(dados);
    }
    showToast("Produto salvo com sucesso!");
    fecharDrawer();
    await carregarProdutos();
  }catch(e){
    console.error(e);
    showToast("Erro ao salvar","error");
  }
}

window.abrirDrawer=abrirDrawer;window.editarProduto=editarProduto;window.excluirProduto=excluirProduto;
</script>
</body>
</html>
