<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Chat da Cotação</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="js/firebase-config.js" defer></script>

  <style>
    :root{ --azul:#004080; --azul-esc:#002e5a; --bg:#f4f7fa; --borda:#e6e9ef }
    *{ box-sizing:border-box }
    body{ font-family:"Segoe UI",system-ui,-apple-system,Arial,sans-serif; background:var(--bg); margin:0; padding:20px }
    h2{ color:var(--azul); margin:0 0 20px }
    .card{ background:#fff; border-radius:12px; box-shadow:0 6px 16px rgba(0,0,0,.06); padding:20px; margin:0 auto 18px; max-width:1000px }
    .grid{ display:grid; gap:14px }
    .grid-2{ grid-template-columns:1fr 1fr }
    .muted{ color:#667085; font-size:13px }
    label{ font-weight:600; display:block; margin-bottom:6px }
    input,select,textarea{ width:100%; padding:10px 12px; border:1px solid var(--borda); border-radius:8px; font-size:15px; background:#fff }
    textarea{ min-height:110px; resize:vertical }
    .btn{ background:var(--azul); color:#fff; border:none; padding:10px 16px; border-radius:10px; cursor:pointer; font-weight:600 }
    .btn:hover{ background:var(--azul-esc) }
    .linha{ display:flex; gap:24px; flex-wrap:wrap }
    .kv{ margin:4px 0 }
    .kv b{ display:inline-block; width:140px }
  </style>
</head>
<body>
  <h2>Detalhes da Cotação</h2>

  <!-- CABEÇALHO -->
  <div class="card">
    <div class="linha">
      <div style="flex:1">
        <div class="kv"><b>Empresa:</b> <span id="empresaNome">-</span></div>
        <div class="kv"><b>CNPJ:</b> <span id="empresaCNPJ">-</span></div>
        <div class="kv"><b>Ramo:</b> <span id="ramo">-</span></div>
      </div>
      <div style="flex:1">
        <div class="kv"><b>Valor desejado:</b> <span id="valorDesejadoTexto">-</span></div>
        <div class="kv"><b>Status:</b> <span id="status">-</span></div>
        <div class="kv"><span id="vigenciaAtual" class="muted"></span></div>
      </div>
    </div>
  </div>

  <!-- INTERAÇÕES -->
  <div class="card">
    <h3 style="margin-top:0">Interações</h3>
    <div id="historico" class="muted">Carregando...</div>
  </div>

  <!-- ALTERAR STATUS -->
  <div class="card">
    <h3 style="margin-top:0">Alterar Status</h3>
    <div class="grid">
      <div>
        <label for="novoStatus">Novo status</label>
        <select id="novoStatus">
          <option>Carregando opções...</option>
        </select>
      </div>

      <!-- Motivo (Recusado Cliente/Seguradora) -->
      <div id="motivoContainer" style="display:none">
        <label for="motivoRecusa">Motivo</label>
        <select id="motivoRecusa">
          <option value="">Selecione o motivo</option>
        </select>
      </div>

      <!-- Vigência (Negócio Emitido) -->
      <div id="vigenciaContainer" class="grid grid-2" style="display:none">
        <div>
          <label for="inicioVigencia">Início da vigência</label>
          <input type="date" id="inicioVigencia" />
        </div>
        <div>
          <label for="fimVigencia">Fim da vigência</label>
          <input type="date" id="fimVigencia" />
        </div>
      </div>

      <!-- Informação adicional (Pendentes, Emitido Declinado, Em Emissão, Negócio Fechado) -->
      <div id="extraInfoContainer" style="display:none">
        <label for="extraInfo">Informação adicional</label>
        <textarea id="extraInfo" placeholder="Descreva a pendência / detalhe do status..."></textarea>
      </div>

      <div>
        <button class="btn" onclick="atualizarStatus()">Atualizar Status</button>
      </div>
    </div>
  </div>

  <!-- NOVA OBSERVAÇÃO -->
  <div class="card">
    <h3 style="margin-top:0">Nova Observação</h3>
    <textarea id="novaMensagem" placeholder="Digite uma observação..."></textarea>
    <div style="margin-top:10px">
      <button class="btn" onclick="enviarMensagem()">Enviar</button>
    </div>
  </div>

  <!-- JS da página -->
  <script src="js/chat-cotacao.js?v=20250811a" defer></script>
</body>
</html>
