<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Agenda de Visitas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="../js/firebase-config.js"></script>

  <style>
    :root{ --bg:#0b3e79; --bg-2:#f6f8fb; --txt:#0f172a; --muted:#6b7280; --card:#fff; --line:#e5e7eb; --pill:#eef2ff; --pill-t:#3730a3; --accent:#2563eb; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg-2);font-family:Inter,system-ui,Arial,sans-serif;color:var(--txt)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    .header{position:sticky;top:0;background:linear-gradient(180deg,var(--bg),#0b3e79e6 65%,transparent);padding:16px 16px 56px;color:#fff;z-index:3}
    .title{max-width:1100px;margin:0 auto;font-weight:700;display:flex;align-items:center;gap:8px;justify-content:space-between}
    .back{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.25);color:#fff;padding:8px 12px;border-radius:12px;text-decoration:none;font-size:13px}
    .grid{margin-top:-44px;display:grid;gap:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:14px}
    h2{margin:0 0 12px}
    label{font-size:12px;font-weight:600;color:var(--muted);display:block;margin-bottom:6px}
    input,select,textarea{width:100%;padding:12px;border:1px solid var(--line);border-radius:12px;font-size:14px;background:#fff}
    textarea{resize:vertical}
    .row{display:grid;gap:12px}
    .row-4{grid-template-columns:1.2fr 1fr 1fr 1fr}
    .row-4b{grid-template-columns:1fr 1fr 1fr 1fr}
    .row-5{grid-template-columns:1fr 1fr 1fr 1fr 1fr}
    .actions{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    .btn{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .hint{color:var(--muted);font-size:12px;margin-top:6px}

    table{width:100%;border-collapse:collapse}
    th,td{padding:12px;border-bottom:1px solid var(--line);text-align:left;font-size:14px}
    th{font-size:12px;color:var(--muted);text-transform:uppercase;letter-spacing:.02em;background:#fafbff;user-select:none}
    .sortable{cursor:pointer;display:inline-flex;align-items:center;gap:6px}
    .sort-arrows{font-size:11px;opacity:.85}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:var(--pill);color:var(--pill-t);font-size:12px;font-weight:600}
    .rm-chip{display:inline-block;padding:4px 8px;border-radius:10px;background:#f1f5f9;font-size:12px}
    .actions-col{white-space:nowrap}
    .table-footer{display:flex;align-items:center;justify-content:space-between;padding-top:10px;gap:10px}
    .muted{color:var(--muted);font-size:13px}

    @media (max-width: 820px){
      .row-4,.row-4b,.row-5{grid-template-columns:1fr}
      table thead{display:none}
      table, tbody, tr, td{display:block;width:100%}
      tr{border:1px solid var(--line);border-radius:12px;margin-bottom:10px;background:#fff}
      td{border:none;border-bottom:1px solid var(--line)}
      td:last-child{border-bottom:none}
      td::before{content:attr(data-label);display:block;font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.02em;margin-bottom:4px}
      .actions-col{display:flex;justify-content:flex-end;padding-top:6px}
      .table-footer{flex-direction:column;align-items:flex-start}
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="title">
      <div>
        <h1 style="font-size:22px;margin:0">Agenda de Visitas</h1>
        <div style="opacity:.85;font-size:13px">Planeje as próximas visitas e visualize o que vem pela frente.</div>
      </div>
      <a href="painel.html" class="back" id="btnVoltar">&larr; Voltar ao painel</a>
    </div>
  </div>

  <div class="wrap grid">
    <!-- Novo agendamento -->
    <div class="card">
      <h2>Novo agendamento</h2>
      <div class="row row-4">
        <div>
          <label>Empresa</label>
          <!-- Autocomplete: digitar e escolher uma das opções -->
          <input id="empresaInput" type="text" list="empresasDatalist" placeholder="Digite parte do nome e escolha..." autocomplete="off">
          <datalist id="empresasDatalist"></datalist>
          <input id="empresaHiddenId" type="hidden">
          <div id="rmInfo" class="hint" style="margin-top:6px">(RM: não cadastrado)</div>
        </div>
        <div>
          <label>Tipo</label>
          <select id="tipoVisita">
            <option value="Presencial">Presencial</option>
            <option value="Online">Online</option>
          </select>
        </div>
        <div>
          <label>Data e Hora</label>
          <input type="datetime-local" id="dataHora">
        </div>
        <div>
          <label>Observações</label>
          <textarea id="observacoes" rows="3" placeholder="Ex.: Renovação Saúde + levantamento de funcionários"></textarea>
        </div>
      </div>

      <div class="actions" style="margin-top:10px">
        <button class="btn" id="recarregar">Atualizar lista</button>
        <button class="btn primary" id="salvarVisita">Salvar</button>
      </div>
      <div class="hint">RM vê e inclui só suas agendas. Assistente, Gerente Chefe e Admin veem e incluem todas.</div>
    </div>

    <!-- Filtros -->
    <div class="card">
      <h2>Filtros</h2>
      <div class="row row-5">
        <div>
          <label>Agência (Admin/Chefe)</label>
          <select id="filtroAgencia"><option value="">Todas</option></select>
        </div>
        <div>
          <label>RM</label>
          <select id="filtroRm"><option value="">Todos</option></select>
        </div>
        <div>
          <label>Tipo</label>
          <select id="filtroTipo">
            <option value="">Todos</option>
            <option value="Presencial">Presencial</option>
            <option value="Online">Online</option>
          </select>
        </div>
        <div>
          <label>Empresa (contém)</label>
          <input type="text" id="filtroEmpresa" placeholder="Digite parte do nome...">
        </div>
        <div>
          <label>Período</label>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <input type="date" id="filtroDe">
            <input type="date" id="filtroAte">
          </div>
        </div>
      </div>
      <div class="actions" style="margin-top:10px">
        <button class="btn" id="btnLimpar">Limpar</button>
        <button class="btn primary" id="btnFiltrar">Aplicar</button>
      </div>
    </div>

    <!-- Lista -->
    <div class="card">
      <h2 style="display:flex;align-items:center;justify-content:space-between">
        <span>Próximas visitas</span>
        <span class="muted" id="contadorVisitas">—</span>
      </h2>
      <table>
        <thead>
          <tr>
            <th><span class="sortable" data-sort="data">Data <span class="sort-arrows">▲▼</span></span></th>
            <th>Hora</th>
            <th>Empresa</th>
            <th>Cidade</th>
            <th>RM</th>
            <th>Tipo</th>
            <th>Observações</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="listaVisitas"></tbody>
      </table>
      <div id="vazio" class="hint" style="display:none;padding:8px">Sem visitas no período.</div>

      <div class="table-footer">
        <div class="muted">Mostrando <span id="paginacaoInfo">0</span></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="btnMostrarMais">Mostrar +15</button>
          <button class="btn" id="btnAbrirTodos">Abrir todos</button>
        </div>
      </div>
    </div>
  </div>

  <script> if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); </script>
  <script src="/admin-banco/js/agenda-visitas.js?v=12" defer></script>
</body>
</html>
