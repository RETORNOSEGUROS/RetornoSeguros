<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Agenda de Visitas ‚Äî Retorno Seguros</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="js/firebase-config.js"></script>

  <!-- Export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <style>
    :root {
      --brand: #4f46e5;
      --brand-dark: #4338ca;
      --bg: #f1f5f9;
      --card: #ffffff;
      --border: #e2e8f0;
      --text: #1e293b;
      --muted: #64748b;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      color: white;
      padding: 16px 24px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    }
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }
    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .back-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      padding: 8px 16px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      transition: all 0.2s;
    }
    .back-btn:hover { background: rgba(255,255,255,0.2); }
    .header h1 {
      font-size: 20px;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* Main Layout */
    .main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 24px;
    }
    @media (max-width: 1024px) {
      .main { grid-template-columns: 1fr; }
      .sidebar { order: -1; }
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 18px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      text-decoration: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
    }
    .btn-secondary {
      background: white;
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover { background: #f8fafc; }
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669);
      color: white;
    }
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #dc2626);
      color: white;
    }
    .btn-ghost {
      background: transparent;
      color: white;
      border: 1px solid rgba(255,255,255,0.3);
    }
    .btn-ghost:hover { background: rgba(255,255,255,0.1); }
    .btn-sm { padding: 6px 12px; font-size: 12px; }
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      justify-content: center;
      border-radius: 10px;
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    @media (max-width: 768px) {
      .stats-bar { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 480px) {
      .stats-bar { grid-template-columns: repeat(2, 1fr); }
    }
    .stat-card {
      background: white;
      border-radius: 14px;
      padding: 16px;
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }
    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.08);
    }
    .stat-card.active {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    .stat-card.today { border-left: 4px solid var(--danger); }
    .stat-card.week { border-left: 4px solid var(--warning); }
    .stat-card.month { border-left: 4px solid var(--info); }
    .stat-card.done { border-left: 4px solid var(--success); }
    .stat-card.rate { border-left: 4px solid #8b5cf6; }
    .stat-icon {
      font-size: 24px;
      margin-bottom: 8px;
    }
    .stat-value {
      font-size: 28px;
      font-weight: 800;
      color: var(--text);
    }
    .stat-label {
      font-size: 11px;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }

    /* Card */
    .card {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #fafbfc;
    }
    .card-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .card-body { padding: 20px; }

    /* Quick Filters */
    .quick-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .quick-filter {
      padding: 8px 16px;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 600;
      border: 1px solid var(--border);
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }
    .quick-filter:hover { border-color: var(--brand); color: var(--brand); }
    .quick-filter.active {
      background: var(--brand);
      color: white;
      border-color: var(--brand);
    }

    /* View Toggle */
    .view-toggle {
      display: flex;
      background: #f1f5f9;
      border-radius: 10px;
      padding: 4px;
    }
    .view-btn {
      padding: 8px 16px;
      border: none;
      background: transparent;
      color: var(--muted);
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.2s;
    }
    .view-btn.active {
      background: white;
      color: var(--brand);
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    /* Day Group */
    .day-group {
      margin-bottom: 24px;
    }
    .day-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
      padding: 8px 0;
    }
    .day-badge {
      padding: 6px 14px;
      border-radius: 100px;
      font-size: 13px;
      font-weight: 700;
    }
    .day-badge.today {
      background: linear-gradient(135deg, var(--danger), #f97316);
      color: white;
    }
    .day-badge.tomorrow {
      background: linear-gradient(135deg, var(--warning), #fbbf24);
      color: #78350f;
    }
    .day-badge.future {
      background: #f1f5f9;
      color: var(--text);
    }
    .day-badge.past {
      background: #fee2e2;
      color: var(--danger);
    }
    .day-count {
      font-size: 13px;
      color: var(--muted);
    }

    /* Visit Card */
    .visit-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 16px 20px;
      margin-bottom: 12px;
      transition: all 0.2s;
      position: relative;
    }
    .visit-card:hover {
      border-color: var(--brand);
      box-shadow: 0 8px 25px rgba(0,0,0,0.06);
    }
    .visit-card.realizada {
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      border-color: #86efac;
    }
    .visit-card.cancelada {
      background: #fef2f2;
      border-color: #fecaca;
      opacity: 0.7;
    }
    .visit-card.atrasada {
      border-left: 4px solid var(--danger);
    }
    .visit-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 12px;
    }
    .visit-empresa {
      font-size: 16px;
      font-weight: 700;
      color: var(--text);
    }
    .visit-hora {
      font-size: 18px;
      font-weight: 800;
      color: var(--brand);
      white-space: nowrap;
    }
    .visit-info {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    .visit-info-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--muted);
    }
    .visit-info-item strong {
      color: var(--text);
    }
    .visit-obs {
      font-size: 13px;
      color: var(--muted);
      background: #f8fafc;
      padding: 10px 14px;
      border-radius: 10px;
      margin-bottom: 12px;
    }
    .visit-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .visit-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .visit-actions {
      display: flex;
      gap: 6px;
    }

    /* Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 5px 12px;
      border-radius: 100px;
      font-size: 12px;
      font-weight: 700;
    }
    .badge-presencial { background: #dcfce7; color: #166534; }
    .badge-online { background: #dbeafe; color: #1e40af; }
    .badge-agendada { background: #e0e7ff; color: #4338ca; }
    .badge-realizada { background: #dcfce7; color: #166534; }
    .badge-cancelada { background: #fee2e2; color: #dc2626; }
    .badge-reagendada { background: #fef3c7; color: #92400e; }

    /* Sidebar */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* Mini Calendar */
    .calendar {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
    }
    .calendar-header {
      padding: 16px;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .calendar-title {
      font-weight: 700;
      font-size: 15px;
    }
    .calendar-nav {
      display: flex;
      gap: 8px;
    }
    .calendar-nav button {
      width: 28px;
      height: 28px;
      border-radius: 8px;
      border: none;
      background: rgba(255,255,255,0.2);
      color: white;
      cursor: pointer;
      font-size: 14px;
    }
    .calendar-nav button:hover { background: rgba(255,255,255,0.3); }
    .calendar-grid {
      padding: 12px;
    }
    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      margin-bottom: 8px;
    }
    .calendar-weekday {
      text-align: center;
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      padding: 4px;
    }
    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 600;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }
    .calendar-day:hover { background: #f1f5f9; }
    .calendar-day.other-month { color: #cbd5e1; }
    .calendar-day.today {
      background: var(--brand);
      color: white;
    }
    .calendar-day.selected {
      background: var(--brand);
      color: white;
    }
    .calendar-day.has-visits::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--danger);
    }
    .calendar-day.today.has-visits::after,
    .calendar-day.selected.has-visits::after {
      background: white;
    }

    /* Filters Card */
    .filters-section {
      background: white;
      border-radius: 16px;
      border: 1px solid var(--border);
    }
    .filters-header {
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      user-select: none;
    }
    .filters-header:hover { background: #f8fafc; }
    .filters-toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      color: var(--text);
      font-size: 14px;
    }
    .filters-content {
      padding: 0 16px 16px;
      display: none;
    }
    .filters-content.open { display: block; }
    .filter-group {
      margin-bottom: 12px;
    }
    .filter-group label {
      display: block;
      font-size: 11px;
      font-weight: 700;
      color: var(--muted);
      margin-bottom: 6px;
      text-transform: uppercase;
    }
    .filter-input, .filter-select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 13px;
      font-family: inherit;
    }
    .filter-input:focus, .filter-select:focus {
      outline: none;
      border-color: var(--brand);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(4px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 200;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: white;
      border-radius: 20px;
      width: 100%;
      max-width: 560px;
      max-height: 90vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
    }
    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      border: none;
      background: #f1f5f9;
      cursor: pointer;
      font-size: 18px;
    }
    .modal-close:hover { background: #e2e8f0; }
    .modal-body {
      padding: 24px;
      overflow-y: auto;
    }
    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    /* Form */
    .form-group {
      margin-bottom: 16px;
    }
    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 6px;
    }
    .form-input, .form-select, .form-textarea {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      font-family: inherit;
      transition: all 0.2s;
    }
    .form-input:focus, .form-select:focus, .form-textarea:focus {
      outline: none;
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
    }
    .form-textarea { min-height: 80px; resize: vertical; }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    .form-hint {
      font-size: 12px;
      color: var(--muted);
      margin-top: 6px;
    }
    .empresa-info {
      background: #f8fafc;
      padding: 10px 14px;
      border-radius: 10px;
      font-size: 13px;
      color: var(--muted);
      margin-top: 8px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    .empty-state-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--text);
      margin-bottom: 8px;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      color: var(--muted);
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--brand);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* FAB (Mobile) */
    .fab {
      display: none;
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
      z-index: 50;
    }
    @media (max-width: 768px) {
      .fab { display: flex; align-items: center; justify-content: center; }
      .header-actions .btn-nova { display: none; }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .main { padding: 16px; }
      .stats-bar { grid-template-columns: repeat(2, 1fr); }
      .visit-header { flex-direction: column; gap: 8px; }
      .visit-hora { align-self: flex-start; }
      .form-row { grid-template-columns: 1fr; }
    }

    /* Print */
    @media print {
      .header, .sidebar, .quick-filters, .fab, .visit-actions { display: none !important; }
      .main { grid-template-columns: 1fr; padding: 0; }
      .visit-card { break-inside: avoid; }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <a href="painel.html" class="back-btn">‚Üê Voltar</a>
        <h1>üìÖ Agenda de Visitas</h1>
      </div>
      <div class="header-actions">
        <div class="view-toggle">
          <button class="view-btn active" data-view="list" onclick="setView('list')">üìã Lista</button>
          <button class="view-btn" data-view="calendar" onclick="setView('calendar')">üìÖ Calend√°rio</button>
        </div>
        <button class="btn btn-ghost" onclick="exportarPDF()">üì• PDF</button>
        <button class="btn btn-primary btn-nova" onclick="abrirModalNova()">+ Nova Visita</button>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- Conte√∫do Principal -->
    <div class="main-content">
      <!-- Stats Bar -->
      <div class="stats-bar">
        <div class="stat-card today" onclick="filtrarPor('hoje')">
          <div class="stat-icon">üî¥</div>
          <div class="stat-value" id="statHoje">-</div>
          <div class="stat-label">Hoje</div>
        </div>
        <div class="stat-card week" onclick="filtrarPor('semana')">
          <div class="stat-icon">üü°</div>
          <div class="stat-value" id="statSemana">-</div>
          <div class="stat-label">Esta Semana</div>
        </div>
        <div class="stat-card month" onclick="filtrarPor('mes')">
          <div class="stat-icon">üìÖ</div>
          <div class="stat-value" id="statMes">-</div>
          <div class="stat-label">Este M√™s</div>
        </div>
        <div class="stat-card done" onclick="filtrarPor('realizadas')">
          <div class="stat-icon">‚úÖ</div>
          <div class="stat-value" id="statRealizadas">-</div>
          <div class="stat-label">Realizadas</div>
        </div>
        <div class="stat-card rate">
          <div class="stat-icon">üìä</div>
          <div class="stat-value" id="statTaxa">-</div>
          <div class="stat-label">Taxa Realiza√ß√£o</div>
        </div>
      </div>

      <!-- Quick Filters -->
      <div class="quick-filters">
        <button class="quick-filter active" data-filter="todas" onclick="quickFilter('todas')">Todas</button>
        <button class="quick-filter" data-filter="hoje" onclick="quickFilter('hoje')">üî¥ Hoje</button>
        <button class="quick-filter" data-filter="semana" onclick="quickFilter('semana')">üìÖ Esta Semana</button>
        <button class="quick-filter" data-filter="pendentes" onclick="quickFilter('pendentes')">‚è≥ Pendentes</button>
        <button class="quick-filter" data-filter="atrasadas" onclick="quickFilter('atrasadas')">‚ö†Ô∏è Atrasadas</button>
      </div>

      <!-- Lista de Visitas -->
      <div id="listaVisitas">
        <div class="loading">
          <div class="spinner"></div>
          <span>Carregando visitas...</span>
        </div>
      </div>

      <!-- Pagina√ß√£o -->
      <div style="text-align: center; margin-top: 20px;">
        <button class="btn btn-secondary" id="btnCarregarMais" onclick="carregarMais()" style="display: none;">
          Carregar mais visitas
        </button>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="sidebar">
      <!-- Mini Calend√°rio -->
      <div class="calendar">
        <div class="calendar-header">
          <span class="calendar-title" id="calendarTitle">Novembro 2024</span>
          <div class="calendar-nav">
            <button onclick="navegarCalendario(-1)">‚Äπ</button>
            <button onclick="navegarCalendario(1)">‚Ä∫</button>
          </div>
        </div>
        <div class="calendar-grid">
          <div class="calendar-weekdays">
            <div class="calendar-weekday">D</div>
            <div class="calendar-weekday">S</div>
            <div class="calendar-weekday">T</div>
            <div class="calendar-weekday">Q</div>
            <div class="calendar-weekday">Q</div>
            <div class="calendar-weekday">S</div>
            <div class="calendar-weekday">S</div>
          </div>
          <div class="calendar-days" id="calendarDays">
            <!-- Gerado via JS -->
          </div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="filters-section">
        <div class="filters-header" onclick="toggleFiltros()">
          <div class="filters-toggle">
            <span>üîç Filtros</span>
          </div>
          <span id="filtrosArrow">‚ñº</span>
        </div>
        <div class="filters-content" id="filtrosContent">
          <div class="filter-group">
            <label>Ag√™ncia</label>
            <select class="filter-select" id="filtroAgencia">
              <option value="">Todas</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Gerente (RM)</label>
            <select class="filter-select" id="filtroRM">
              <option value="">Todos</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Tipo</label>
            <select class="filter-select" id="filtroTipo">
              <option value="">Todos</option>
              <option value="Presencial">Presencial</option>
              <option value="Online">Online</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Status</label>
            <select class="filter-select" id="filtroStatus">
              <option value="">Todos</option>
              <option value="Agendada">Agendada</option>
              <option value="Realizada">Realizada</option>
              <option value="Cancelada">Cancelada</option>
              <option value="Reagendada">Reagendada</option>
            </select>
          </div>
          <div class="filter-group">
            <label>Empresa</label>
            <input type="text" class="filter-input" id="filtroEmpresa" placeholder="Buscar...">
          </div>
          <div class="filter-group">
            <label>Per√≠odo</label>
            <div style="display: flex; gap: 8px;">
              <input type="date" class="filter-input" id="filtroDe" style="flex: 1;">
              <input type="date" class="filter-input" id="filtroAte" style="flex: 1;">
            </div>
          </div>
          <div style="display: flex; gap: 8px; margin-top: 12px;">
            <button class="btn btn-secondary" onclick="limparFiltros()" style="flex: 1;">Limpar</button>
            <button class="btn btn-primary" onclick="aplicarFiltros()" style="flex: 1;">Aplicar</button>
          </div>
        </div>
      </div>

      <!-- Resumo R√°pido -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">üìä Resumo</span>
        </div>
        <div class="card-body">
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
              <span style="color: var(--muted); font-size: 13px;">Presenciais</span>
              <span style="font-weight: 700;" id="resumoPresenciais">-</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
              <span style="color: var(--muted); font-size: 13px;">Online</span>
              <span style="font-weight: 700;" id="resumoOnline">-</span>
            </div>
            <div style="display: flex; justify-content: space-between; padding: 8px 0;">
              <span style="color: var(--muted); font-size: 13px;">Total do Per√≠odo</span>
              <span style="font-weight: 700;" id="resumoTotal">-</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- FAB Mobile -->
  <button class="fab" onclick="abrirModalNova()">+</button>

  <!-- Modal Nova/Editar Visita -->
  <div class="modal-overlay" id="modalVisita">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitulo">üìÖ Nova Visita</h3>
        <button class="modal-close" onclick="fecharModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="visitaId">
        
        <div class="form-group">
          <label>Empresa *</label>
          <input type="text" class="form-input" id="empresaInput" list="empresasDatalist" placeholder="Digite para buscar..." autocomplete="off">
          <datalist id="empresasDatalist"></datalist>
          <input type="hidden" id="empresaHiddenId">
          <div class="empresa-info" id="empresaInfo" style="display: none;">
            <span id="empresaInfoText"></span>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Data *</label>
            <input type="date" class="form-input" id="dataVisita">
          </div>
          <div class="form-group">
            <label>Hora *</label>
            <input type="time" class="form-input" id="horaVisita">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Tipo</label>
            <select class="form-select" id="tipoVisita">
              <option value="Presencial">üü¢ Presencial</option>
              <option value="Online">üîµ Online</option>
            </select>
          </div>
          <div class="form-group">
            <label>Status</label>
            <select class="form-select" id="statusVisita">
              <option value="Agendada">‚è≥ Agendada</option>
              <option value="Realizada">‚úÖ Realizada</option>
              <option value="Cancelada">‚ùå Cancelada</option>
              <option value="Reagendada">üîÑ Reagendada</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Observa√ß√µes</label>
          <textarea class="form-textarea" id="observacoes" placeholder="Objetivo da visita, assuntos a tratar..."></textarea>
        </div>

        <div class="form-group" id="notasPosVisitaGroup" style="display: none;">
          <label>Notas P√≥s-Visita</label>
          <textarea class="form-textarea" id="notasPosVisita" placeholder="O que foi tratado, pr√≥ximos passos..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
        <button class="btn btn-primary" onclick="salvarVisita()">üíæ Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal Confirmar Exclus√£o -->
  <div class="modal-overlay" id="modalConfirm">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h3 class="modal-title">‚ö†Ô∏è Confirmar Exclus√£o</h3>
        <button class="modal-close" onclick="fecharModalConfirm()">‚úï</button>
      </div>
      <div class="modal-body">
        <p>Tem certeza que deseja excluir esta visita?</p>
        <p style="font-weight: 700; margin-top: 8px;" id="confirmEmpresa"></p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="fecharModalConfirm()">Cancelar</button>
        <button class="btn btn-danger" onclick="confirmarExclusao()">üóëÔ∏è Excluir</button>
      </div>
    </div>
  </div>

  <script src="js/agenda-visitas.js"></script>
</body>
</html>
