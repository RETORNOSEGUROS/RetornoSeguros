<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Empresas ‚Äî Retorno</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- TailwindCSS (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: '#1b2c5c' },
          boxShadow: { soft: '0 8px 24px rgba(2, 6, 23, .06)' },
          borderRadius: { '2xl': '1rem' }
        }
      }
    }
  </script>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="js/firebase-config.js"></script>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial}
    .chip{display:inline-flex;align-items:center;gap:.5rem;padding:.25rem .5rem;border:1px solid #e5e7eb;border-radius:999px;background:#f8fafc}
    .status-dot{font-size:18px;line-height:1}
    .table-wrap{overflow:auto}
    .btn{display:inline-flex;align-items:center;gap:.5rem;border-radius:.75rem;padding:.5rem .75rem}
    .btn-outline{border:1px solid #e5e7eb;background:white}
    .btn-danger{background:#ef4444;color:white}
    .muted{color:#64748b}
    .badge{display:inline-flex;align-items:center;gap:.375rem;font-size:.75rem;border-radius:999px;padding:.125rem .5rem;border:1px solid #e5e7eb;background:#f1f5f9}
    .skeleton{height:12px;background:#eef2f7;border-radius:8px}
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-800">

  <!-- HEADER -->
  <header class="sticky top-0 z-40 bg-brand text-white shadow-soft">
    <div class="max-w-7xl mx-auto flex items-center justify-between px-4 py-3">
      <div class="flex items-center gap-2">
        <span class="inline-block w-2.5 h-2.5 rounded-full bg-white/80"></span>
        <div class="text-lg font-bold">Empresas</div>
      </div>
      <div class="flex items-center gap-2">
        <div id="perfilUsuario" class="text-slate-200 text-sm">Carregando‚Ä¶</div>
        <button id="menuToggle" class="lg:hidden rounded-lg bg-white text-brand px-2.5 py-1.5 text-base shadow-soft" title="Abrir menu">‚ò∞</button>
      </div>
    </div>
  </header>

  <!-- OVERLAY para o drawer no mobile -->
  <div id="sidebarOverlay" class="fixed inset-0 bg-black/40 z-30 hidden"></div>

  <!-- WRAPPER -->
  <div class="max-w-7xl mx-auto grid grid-cols-12 gap-4 px-4 py-6">

    <!-- SIDEBAR (drawer mobile rol√°vel + fixa no desktop) -->
    <aside class="col-span-12 lg:col-span-3">
      <nav id="menuNav"
           class="hidden lg:block z-40
                  lg:static lg:max-h-none
                  fixed top-16 left-0 right-0
                  max-h-[70vh] overflow-y-auto
                  w-full lg:w-auto
                  rounded-2xl bg-white border border-slate-200 shadow p-3 space-y-3">
        <!-- itens via JS -->
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="col-span-12 lg:col-span-9 space-y-6">

      <!-- FILTROS -->
      <section class="rounded-2xl bg-white border border-slate-200 shadow-soft p-4">
        <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-3">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3 w-full">
            <div>
              <label class="text-sm text-slate-600">Filtrar por RM</label>
              <select id="filtroRM" class="w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring focus:ring-slate-200">
                <option value="">Todos</option>
              </select>
            </div>
            <div>
              <label class="text-sm text-slate-600">Buscar por nome da empresa</label>
              <input id="buscaEmpresa" type="text" placeholder="Digite para filtrar‚Ä¶"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring focus:ring-slate-200">
            </div>
            <div>
              <label class="text-sm text-slate-600">CNPJ (m√°scara ao digitar)</label>
              <input id="cnpjDummy" type="text" placeholder="00.000.000/0000-00"
                     class="w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring focus:ring-slate-200 cnpj-mask">
              <div class="text-xs text-slate-500 mt-1">Use este campo quando precisar digitar/validar CNPJ (a m√°scara j√° est√° aplicada).</div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="badge"><span class="status-dot">üü¢</span> Neg√≥cio Emitido</span>
            <span class="badge"><span class="status-dot">üü°</span> Pendente</span>
            <span class="badge"><span class="status-dot">üî¥</span> Recusado/Declinado</span>
            <span class="badge"><span class="status-dot">üîµ</span> Fechado/Em Emiss√£o</span>
            <span class="badge"><span class="status-dot">‚ö™Ô∏è</span> Sem cota√ß√£o</span>
          </div>
        </div>
      </section>

      <!-- TABELA -->
      <section class="rounded-2xl bg-white border border-slate-200 shadow-soft p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-brand font-semibold">Mapa de Produtos por Empresa</h3>
          <div class="chip"><span class="muted">Total:</span> <strong id="totalEmpresas">‚Äî</strong></div>
        </div>

        <div id="wrapTabela" class="table-wrap border border-slate-200 rounded-2xl">
          <div id="tabelaEmpresas">
            <div class="p-4 grid grid-cols-12 gap-3">
              <div class="col-span-6"><div class="skeleton" style="width:70%"></div></div>
              <div class="col-span-2"><div class="skeleton"></div></div>
              <div class="col-span-2"><div class="skeleton"></div></div>
              <div class="col-span-2"><div class="skeleton"></div></div>
            </div>
          </div>
        </div>
        <div class="text-xs text-slate-500 mt-2">Arraste lateralmente no celular para ver todas as colunas.</div>
      </section>

    </main>
  </div>

  <!-- MODAL: confirmar exclus√£o -->
  <div id="modalExcluir" class="hidden fixed inset-0 bg-black/50 z-50">
    <div class="max-w-md mx-auto mt-24 bg-white rounded-2xl p-5 shadow-soft">
      <h3 class="text-lg font-semibold mb-2">Excluir empresa</h3>
      <p class="text-sm text-slate-600">
        Confirme a exclus√£o digitando o nome da empresa abaixo. Esta a√ß√£o n√£o pode ser desfeita.
      </p>
      <div class="mt-3">
        <label class="text-sm text-slate-600">Nome da empresa</label>
        <input id="confirmNomeEmpresa" class="w-full rounded-xl border border-slate-200 px-3 py-2 outline-none focus:ring focus:ring-slate-200" />
      </div>
      <div id="excluirErro" class="text-red-700 text-sm mt-2"></div>
      <div class="flex items-center justify-end gap-2 pt-4">
        <button id="cancelarExcluir" class="btn btn-outline">Cancelar</button>
        <button id="confirmarExcluir" class="btn btn-danger">Excluir</button>
      </div>
    </div>
  </div>

  <!-- JS principal desta p√°gina -->
  <script src="js/empresas.js" defer></script>

  <!-- Drawer mobile utilit√°rio (igual do painel) -->
  <script>
    document.addEventListener('DOMContentLoaded', ()=>{
      const nav   = document.getElementById('menuNav');
      const btn   = document.getElementById('menuToggle');
      const body  = document.body;
      const ovl   = document.getElementById('sidebarOverlay');

      function openNav(){
        nav.classList.remove('hidden');
        ovl.classList.remove('hidden');
        body.classList.add('overflow-hidden');
      }
      function closeNav(){
        if (window.innerWidth < 1024) nav.classList.add('hidden');
        ovl.classList.add('hidden');
        body.classList.remove('overflow-hidden');
      }

      btn?.addEventListener('click', (e)=>{ e.stopPropagation(); openNav(); });
      ovl?.addEventListener('click', closeNav);
      document.addEventListener('click', (e)=>{
        if(window.innerWidth >= 1024) return;
        if(!nav.contains(e.target) && !btn.contains(e.target)) closeNav();
      });
      window.addEventListener('resize', ()=>{
        if(window.innerWidth >= 1024){ ovl.classList.add('hidden'); body.classList.remove('overflow-hidden'); nav.classList.remove('hidden'); }
        else { nav.classList.add('hidden'); }
      });
    });
  </script>
</body>
</html>
