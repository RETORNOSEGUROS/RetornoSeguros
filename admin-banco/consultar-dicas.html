<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Guia de Produtos - Seguros Corporativos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="js/firebase-config.js"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{--primary:#1e40af;--primary-light:#3b82f6;--success:#10b981;--warning:#f59e0b;--whatsapp:#25d366;--gray-50:#f9fafb;--gray-100:#f3f4f6;--gray-200:#e5e7eb;--gray-300:#d1d5db;--gray-500:#6b7280;--gray-600:#4b5563;--gray-700:#374151;--gray-900:#111827;--shadow:0 1px 3px rgba(0,0,0,.1);--shadow-md:0 4px 6px -1px rgba(0,0,0,.1);--shadow-lg:0 10px 15px -3px rgba(0,0,0,.1)}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;background:linear-gradient(135deg,#1e40af 0%,#1e3a8a 100%);min-height:100vh;padding:16px;color:var(--gray-900)}
    .container{max-width:1000px;margin:0 auto}
    .header{background:#fff;border-radius:16px;padding:20px;margin-bottom:16px;box-shadow:var(--shadow-md)}
    .header-top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .header-left{display:flex;align-items:center;gap:12px}
    .btn-back{background:var(--gray-100);border:none;border-radius:10px;padding:10px 14px;cursor:pointer;display:flex;align-items:center;gap:6px;font-weight:600;color:var(--gray-700);transition:all .2s;font-size:13px}
    .btn-back:hover{background:var(--gray-200)}
    .header-title h1{font-size:20px;font-weight:700;color:var(--gray-900)}
    .header-title p{font-size:12px;color:var(--gray-600)}
    .search-box{margin-top:16px}
    .search-input{width:100%;padding:14px 18px;padding-left:48px;border:2px solid var(--gray-200);border-radius:12px;font-size:15px;transition:all .2s;background:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%239ca3af'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'/%3E%3C/svg%3E") no-repeat 16px center;background-size:20px}
    .search-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(30,64,175,.1)}
    .categorias{display:flex;gap:8px;overflow-x:auto;padding:4px 0;margin-top:14px;-webkit-overflow-scrolling:touch}
    .categoria-btn{padding:10px 18px;border:2px solid var(--gray-200);background:#fff;border-radius:10px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;display:flex;align-items:center;gap:6px}
    .categoria-btn:hover{border-color:var(--primary-light);background:var(--gray-50)}
    .categoria-btn.active{border-color:var(--primary);background:var(--primary);color:#fff}
    .produtos-lista{display:flex;flex-direction:column;gap:12px}
    .produto-card{background:#fff;border-radius:16px;box-shadow:var(--shadow-md);overflow:hidden;transition:all .2s}
    .produto-card:hover{box-shadow:var(--shadow-lg);transform:translateY(-2px)}
    .produto-header{padding:18px 20px;cursor:pointer;display:flex;align-items:center;gap:14px;border-bottom:1px solid transparent;transition:all .2s}
    .produto-header.expanded{border-bottom-color:var(--gray-200);background:var(--gray-50)}
    .produto-icon{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0}
    .produto-icon.empresarial{background:#dbeafe}
    .produto-icon.auto{background:#fef3c7}
    .produto-icon.vida{background:#fce7f3}
    .produto-icon.saude{background:#d1fae5}
    .produto-icon.patrimonial{background:#e0e7ff}
    .produto-icon.outros{background:#f3f4f6}
    .produto-info{flex:1;min-width:0}
    .produto-info h3{font-size:17px;font-weight:700;color:var(--gray-900);margin-bottom:4px}
    .produto-info p{font-size:13px;color:var(--gray-600);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .produto-arrow{width:32px;height:32px;border-radius:8px;background:var(--gray-100);display:flex;align-items:center;justify-content:center;transition:all .3s;flex-shrink:0}
    .produto-arrow svg{transition:transform .3s}
    .produto-header.expanded .produto-arrow{background:var(--primary)}
    .produto-header.expanded .produto-arrow svg{transform:rotate(180deg)}
    .produto-header.expanded .produto-arrow svg path{stroke:#fff}
    .produto-body{display:none;padding:0 20px 20px}
    .produto-body.show{display:block}
    .tabs{display:flex;gap:6px;margin-bottom:16px;overflow-x:auto;padding-bottom:8px}
    .tab-btn{padding:10px 16px;border:none;background:var(--gray-100);border-radius:8px;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap}
    .tab-btn:hover{background:var(--gray-200)}
    .tab-btn.active{background:var(--primary);color:#fff}
    .tab-content{display:none}
    .tab-content.show{display:block}
    .content-section{margin-bottom:20px}
    .content-section h4{font-size:14px;font-weight:700;color:var(--primary);margin-bottom:10px;display:flex;align-items:center;gap:8px}
    .content-box{background:var(--gray-50);border-radius:10px;padding:16px;font-size:14px;line-height:1.7;color:var(--gray-700);white-space:pre-wrap}
    .whatsapp-box{background:linear-gradient(135deg,#dcfce7 0%,#d1fae5 100%);border:2px solid var(--whatsapp);border-radius:12px;padding:16px}
    .whatsapp-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .whatsapp-header h4{color:#166534;margin:0}
    .btn-copy{padding:10px 18px;border:none;background:var(--whatsapp);color:#fff;border-radius:8px;font-size:13px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:6px;transition:all .2s}
    .btn-copy:hover{background:#1da851;transform:scale(1.02)}
    .btn-copy.copied{background:var(--success)}
    .whatsapp-text{background:#fff;border-radius:8px;padding:14px;font-size:14px;line-height:1.6;color:var(--gray-800);white-space:pre-wrap;border:1px solid #a7f3d0}
    .gatilhos-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .gatilho-box{border-radius:10px;padding:14px}
    .gatilho-box.com{background:#fef3c7;border:1px solid #fcd34d}
    .gatilho-box.sem{background:#dbeafe;border:1px solid #93c5fd}
    .gatilho-box h5{font-size:12px;font-weight:700;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px}
    .gatilho-box.com h5{color:#92400e}
    .gatilho-box.sem h5{color:#1e40af}
    .gatilho-box p{font-size:13px;line-height:1.6;white-space:pre-wrap}
    .empty-state{background:#fff;border-radius:16px;padding:60px 20px;text-align:center;color:var(--gray-500)}
    .toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--gray-900);color:#fff;padding:14px 24px;border-radius:12px;font-weight:600;font-size:14px;opacity:0;transition:all .3s;z-index:2000;display:flex;align-items:center;gap:8px}
    .toast.show{transform:translateX(-50%) translateY(0);opacity:1}
    .badge-docs{display:inline-flex;align-items:center;gap:4px;padding:6px 12px;background:var(--warning);color:#fff;border-radius:6px;font-size:12px;font-weight:600;margin-left:auto}
    @media(max-width:768px){body{padding:10px}.produto-info h3{font-size:15px}.gatilhos-grid{grid-template-columns:1fr}.tabs{gap:4px}.tab-btn{padding:8px 12px;font-size:12px}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-top">
        <div class="header-left">
          <button class="btn-back" onclick="window.location.href='painel.html'">
            <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Voltar
          </button>
          <div class="header-title">
            <h1>üìã Guia de Produtos</h1>
            <p>Informa√ß√µes para cota√ß√£o e argumentos de venda</p>
          </div>
        </div>
      </div>
      <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="Buscar produto... (ex: frota, dental, vida)">
      </div>
      <div class="categorias" id="categorias">
        <button class="categoria-btn active" data-cat="">üìö Todos</button>
        <button class="categoria-btn" data-cat="empresarial">üè¢ Empresarial</button>
        <button class="categoria-btn" data-cat="auto">üöó Auto/Frota</button>
        <button class="categoria-btn" data-cat="vida">‚ù§Ô∏è Vida</button>
        <button class="categoria-btn" data-cat="saude">üè• Sa√∫de/Dental</button>
        <button class="categoria-btn" data-cat="patrimonial">üè† Patrimonial</button>
        <button class="categoria-btn" data-cat="outros">üì¶ Outros</button>
      </div>
    </div>

    <div class="produtos-lista" id="listaProdutos">
      <div class="empty-state">Carregando produtos...</div>
    </div>
  </div>

  <div class="toast" id="toast">‚úÖ Copiado para √°rea de transfer√™ncia!</div>

<script>
if(!firebase.apps.length&&typeof firebaseConfig!=="undefined")firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();
const COL=db.collection("dicas_produtos");

const $=id=>document.getElementById(id);
let produtos=[],filtroCategoria="",filtroBusca="";

const icons={empresarial:'üè¢',auto:'üöó',vida:'‚ù§Ô∏è',saude:'üè•',patrimonial:'üè†',outros:'üì¶'};

function showToast(msg){const t=$('toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),2500)}

auth.onAuthStateChanged(async user=>{
  if(!user){location.href="login.html";return}
  await carregarProdutos();
  setupEventos();
});

async function carregarProdutos(){
  const snap=await COL.orderBy("nome").get();
  produtos=snap.docs.map(d=>({id:d.id,...d.data()}));
  renderProdutos();
}

function setupEventos(){
  // Filtro categoria
  document.querySelectorAll(".categoria-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      document.querySelectorAll(".categoria-btn").forEach(b=>b.classList.remove("active"));
      btn.classList.add("active");
      filtroCategoria=btn.dataset.cat;
      renderProdutos();
    });
  });
  // Busca
  $("searchInput").addEventListener("input",e=>{
    filtroBusca=e.target.value.toLowerCase().trim();
    renderProdutos();
  });
}

function renderProdutos(){
  const container=$("listaProdutos");
  let lista=produtos;
  
  if(filtroCategoria)lista=lista.filter(p=>p.categoria===filtroCategoria);
  if(filtroBusca)lista=lista.filter(p=>(p.nome||'').toLowerCase().includes(filtroBusca)||(p.descricaoCurta||'').toLowerCase().includes(filtroBusca));
  
  if(!lista.length){
    container.innerHTML=`<div class="empty-state"><p style="font-size:18px;margin-bottom:8px">üòï Nenhum produto encontrado</p><p>Tente outra busca ou categoria</p></div>`;
    return;
  }

  container.innerHTML=lista.map((p,idx)=>`
    <div class="produto-card" data-id="${p.id}">
      <div class="produto-header" onclick="toggleProduto('${p.id}')">
        <div class="produto-icon ${p.categoria||'outros'}">${icons[p.categoria]||'üì¶'}</div>
        <div class="produto-info">
          <h3>${p.nome||'Sem nome'}</h3>
          <p>${p.descricaoCurta||'Clique para ver detalhes'}</p>
        </div>
        ${p.documentos?'<span class="badge-docs">üìù Docs</span>':''}
        <div class="produto-arrow">
          <svg width="16" height="16" viewBox="0 0 20 20" fill="none"><path d="M5 7.5L10 12.5L15 7.5" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </div>
      </div>
      <div class="produto-body" id="body-${p.id}">
        <div class="tabs">
          <button class="tab-btn active" onclick="showTab('${p.id}','whats')">üì± WhatsApp</button>
          <button class="tab-btn" onclick="showTab('${p.id}','info')">‚ÑπÔ∏è Sobre</button>
          <button class="tab-btn" onclick="showTab('${p.id}','docs')">üìã Documentos</button>
          <button class="tab-btn" onclick="showTab('${p.id}','gatilhos')">üß† Argumentos</button>
          <button class="tab-btn" onclick="showTab('${p.id}','dicas')">üí° Dicas</button>
        </div>
        
        <div class="tab-content show" id="tab-${p.id}-whats">
          ${p.mensagemWhats?`
          <div class="whatsapp-box">
            <div class="whatsapp-header">
              <h4>üí¨ Mensagem Pronta</h4>
              <button class="btn-copy" onclick="copiarWhats('${p.id}')">üìã Copiar</button>
            </div>
            <div class="whatsapp-text" id="whats-${p.id}">${p.mensagemWhats}</div>
          </div>
          `:`<div class="content-box" style="text-align:center;color:var(--gray-500)">Mensagem de WhatsApp n√£o configurada</div>`}
        </div>
        
        <div class="tab-content" id="tab-${p.id}-info">
          ${p.oQueE?`<div class="content-section"><h4>üìå O que √©</h4><div class="content-box">${p.oQueE}</div></div>`:''}
          ${p.beneficios?`<div class="content-section"><h4>‚úÖ Benef√≠cios</h4><div class="content-box">${p.beneficios}</div></div>`:''}
          ${!p.oQueE&&!p.beneficios?`<div class="content-box" style="text-align:center;color:var(--gray-500)">Informa√ß√µes n√£o configuradas</div>`:''}
        </div>
        
        <div class="tab-content" id="tab-${p.id}-docs">
          ${p.documentos?`
          <div class="content-section">
            <h4>üìù Documentos Necess√°rios para Cota√ß√£o</h4>
            <div class="content-box">${p.documentos}</div>
          </div>
          `:`<div class="content-box" style="text-align:center;color:var(--gray-500)">Lista de documentos n√£o configurada</div>`}
        </div>
        
        <div class="tab-content" id="tab-${p.id}-gatilhos">
          <div class="gatilhos-grid">
            <div class="gatilho-box com">
              <h5>üîÑ Cliente J√Å tem seguro</h5>
              <p>${p.gatilhosComSeguro||'Argumentos n√£o configurados'}</p>
            </div>
            <div class="gatilho-box sem">
              <h5>üÜï Cliente N√ÉO tem seguro</h5>
              <p>${p.gatilhosSemSeguro||'Argumentos n√£o configurados'}</p>
            </div>
          </div>
        </div>
        
        <div class="tab-content" id="tab-${p.id}-dicas">
          ${p.dicasComerciais?`<div class="content-box">${p.dicasComerciais}</div>`:`<div class="content-box" style="text-align:center;color:var(--gray-500)">Dicas comerciais n√£o configuradas</div>`}
        </div>
      </div>
    </div>
  `).join('');
}

function toggleProduto(id){
  const header=document.querySelector(`[data-id="${id}"] .produto-header`);
  const body=$(`body-${id}`);
  const wasExpanded=header.classList.contains('expanded');
  
  // Fecha todos
  document.querySelectorAll('.produto-header').forEach(h=>h.classList.remove('expanded'));
  document.querySelectorAll('.produto-body').forEach(b=>b.classList.remove('show'));
  
  // Abre este se n√£o estava aberto
  if(!wasExpanded){
    header.classList.add('expanded');
    body.classList.add('show');
  }
}

function showTab(produtoId,tabName){
  // Remove active de todos os bot√µes deste produto
  const card=document.querySelector(`[data-id="${produtoId}"]`);
  card.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  card.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('show'));
  
  // Ativa o clicado
  event.target.classList.add('active');
  $(`tab-${produtoId}-${tabName}`).classList.add('show');
}

function copiarWhats(id){
  const texto=$(`whats-${id}`).innerText;
  navigator.clipboard.writeText(texto).then(()=>{
    showToast('‚úÖ Copiado! Cole no WhatsApp');
    const btn=document.querySelector(`[data-id="${id}"] .btn-copy`);
    btn.textContent='‚úÖ Copiado!';
    btn.classList.add('copied');
    setTimeout(()=>{btn.textContent='üìã Copiar';btn.classList.remove('copied')},2000);
  }).catch(()=>{
    // Fallback para mobile
    const ta=document.createElement('textarea');
    ta.value=texto;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    showToast('‚úÖ Copiado! Cole no WhatsApp');
  });
}

window.toggleProduto=toggleProduto;window.showTab=showTab;window.copiarWhats=copiarWhats;
</script>
</body>
</html>
