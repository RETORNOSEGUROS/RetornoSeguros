<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Retorno Seguros CRM</title>
    <link rel="stylesheet" href="css/admin-style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../img/logo-retorno.png" alt="Retorno Seguros" onerror="this.style.display='none'">
            <h2>CRM Seguros</h2>
        </div>

        <nav class="sidebar-nav">
            <div class="nav-section">
                <span class="nav-section-title">Principal</span>
                <a href="dashboard.html" class="nav-item">
                    <i class="fas fa-chart-line"></i>
                    <span>Dashboard</span>
                </a>
                <a href="leads.html" class="nav-item">
                    <i class="fas fa-funnel-dollar"></i>
                    <span>Leads / Pipeline</span>
                    <span class="nav-badge" id="leadsNovos">0</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-section-title">Gestão</span>
                <a href="clientes.html" class="nav-item">
                    <i class="fas fa-users"></i>
                    <span>Clientes</span>
                </a>
                <a href="apolices.html" class="nav-item">
                    <i class="fas fa-file-contract"></i>
                    <span>Apólices</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-section-title">Equipe</span>
                <a href="funcionarios.html" class="nav-item">
                    <i class="fas fa-user-tie"></i>
                    <span>Funcionários</span>
                </a>
                <a href="relatorios.html" class="nav-item active">
                    <i class="fas fa-chart-bar"></i>
                    <span>Relatórios</span>
                </a>
            </div>

            <div class="nav-section">
                <span class="nav-section-title">Sistema</span>
                <a href="configuracoes.html" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Configurações</span>
                </a>
            </div>
        </nav>

        <div class="sidebar-footer">
            <div class="user-info">
                <i class="fas fa-user-circle"></i>
                <span id="userEmail">admin@retorno.com</span>
            </div>
            <button class="btn-logout" onclick="fazerLogout()">
                <i class="fas fa-sign-out-alt"></i> Sair
            </button>
        </div>
    </aside>

    <!-- Mobile Toggle -->
    <button class="mobile-toggle" id="mobileToggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Main Content -->
    <main class="main-content">
        <header class="page-header">
            <div class="header-left">
                <h1><i class="fas fa-chart-bar"></i> Relatórios</h1>
                <p>Análise de desempenho e resultados</p>
            </div>
            <div class="header-right">
                <select id="filtroPeriodo" onchange="carregarRelatorios()">
                    <option value="mes">Este Mês</option>
                    <option value="trimestre">Este Trimestre</option>
                    <option value="semestre">Este Semestre</option>
                    <option value="ano">Este Ano</option>
                    <option value="todos">Todo Período</option>
                </select>
            </div>
        </header>

        <!-- Cards Resumo Geral -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--primary);">
                    <i class="fas fa-funnel-dollar"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="statLeadsTotal">0</span>
                    <span class="stat-label">Leads Recebidos</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--success);">
                    <i class="fas fa-handshake"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="statFechados">0</span>
                    <span class="stat-label">Negócios Fechados</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--info);">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="statConversao">0%</span>
                    <span class="stat-label">Taxa de Conversão</span>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon" style="background: var(--warning);">
                    <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="stat-info">
                    <span class="stat-value" id="statReceita">R$ 0</span>
                    <span class="stat-label">Receita em Prêmios</span>
                </div>
            </div>
        </div>

        <!-- Produção por Funcionário -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-users"></i> Produção por Funcionário</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Funcionário</th>
                                <th>Leads</th>
                                <th>Cotações</th>
                                <th>Fechados</th>
                                <th>Perdidos</th>
                                <th>Conversão</th>
                                <th>Receita</th>
                                <th>Comissão</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaProducao">
                            <tr>
                                <td colspan="8" class="text-center">Carregando...</td>
                            </tr>
                        </tbody>
                        <tfoot id="tabelaProducaoTotal">
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>

        <!-- Grid de 2 colunas -->
        <div class="grid-2">
            <!-- Por Ramo -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-chart-pie"></i> Resultados por Ramo</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Ramo</th>
                                    <th>Leads</th>
                                    <th>Fechados</th>
                                    <th>Receita</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaRamos">
                                <tr>
                                    <td colspan="4" class="text-center">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Por Seguradora -->
            <div class="card">
                <div class="card-header">
                    <h3><i class="fas fa-building"></i> Resultados por Seguradora</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Seguradora</th>
                                    <th>Apólices</th>
                                    <th>Receita</th>
                                    <th>%</th>
                                </tr>
                            </thead>
                            <tbody id="tabelaSeguradoras">
                                <tr>
                                    <td colspan="4" class="text-center">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Funil de Vendas -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-filter"></i> Funil de Vendas</h3>
            </div>
            <div class="card-body">
                <div class="funnel-container" id="funnelContainer">
                    <!-- Preenchido via JS -->
                </div>
            </div>
        </div>

        <!-- Evolução Mensal -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-chart-line"></i> Evolução Mensal (Últimos 6 meses)</h3>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Mês</th>
                                <th>Leads</th>
                                <th>Fechados</th>
                                <th>Perdidos</th>
                                <th>Conversão</th>
                                <th>Receita</th>
                            </tr>
                        </thead>
                        <tbody id="tabelaEvolucao">
                            <tr>
                                <td colspan="6" class="text-center">Carregando...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tempo Médio -->
        <div class="card">
            <div class="card-header">
                <h3><i class="fas fa-clock"></i> Tempo Médio por Etapa</h3>
            </div>
            <div class="card-body">
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Preenchido via JS -->
                </div>
            </div>
        </div>
    </main>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyDlbEZfA_uAR1aoPZIr8T9B6KNcrwfMxm0",
            authDomain: "retorno-seguros.firebaseapp.com",
            projectId: "retorno-seguros",
            storageBucket: "retorno-seguros.firebasestorage.app",
            messagingSenderId: "495712392972",
            appId: "1:495712392972:web:a59dc2c9edff29a66f5b2f"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Variáveis globais
        let leads = [];
        let leadsFiltrados = [];
        let funcionarios = [];
        let apolices = [];

        // Status do funil
        const statusOrdem = [
            { key: 'pre_cadastro', label: 'Pré-Cadastro', color: '#6b7280' },
            { key: 'contato_realizado', label: 'Contato Realizado', color: '#3b82f6' },
            { key: 'pendente_documentos', label: 'Pendente Docs', color: '#f59e0b' },
            { key: 'cotacao_enviada', label: 'Cotação Enviada', color: '#8b5cf6' },
            { key: 'negocio_fechado', label: 'Fechado', color: '#10b981' },
            { key: 'negocio_perdido', label: 'Perdido', color: '#ef4444' }
        ];

        // Verificar autenticação
        auth.onAuthStateChanged(async user => {
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            document.getElementById('userEmail').textContent = user.email;
            await carregarDados();
        });

        // Carregar dados
        async function carregarDados() {
            try {
                // Carregar leads
                const snapLeads = await db.collection('leads_crm').get();
                leads = [];
                snapLeads.forEach(doc => {
                    leads.push({ id: doc.id, ...doc.data() });
                });

                // Carregar funcionários
                const snapFunc = await db.collection('admins_crm').get();
                funcionarios = [];
                snapFunc.forEach(doc => {
                    funcionarios.push({ id: doc.id, ...doc.data() });
                });

                // Carregar apólices
                const snapApolices = await db.collection('apolices_cliente').get();
                apolices = [];
                snapApolices.forEach(doc => {
                    apolices.push({ id: doc.id, ...doc.data() });
                });

                // Badge leads novos
                const leadsNovos = leads.filter(l => l.status === 'pre_cadastro').length;
                const badge = document.getElementById('badgeLeadsNovos');
                if (leadsNovos > 0) {
                    badge.textContent = leadsNovos;
                    badge.style.display = 'inline';
                } else {
                    badge.style.display = 'none';
                }

                carregarRelatorios();

            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                mostrarToast('Erro ao carregar dados', 'error');
            }
        }

        // Carregar relatórios
        function carregarRelatorios() {
            const periodo = document.getElementById('filtroPeriodo').value;
            const hoje = new Date();
            let dataInicio = null;

            switch (periodo) {
                case 'mes':
                    dataInicio = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                    break;
                case 'trimestre':
                    dataInicio = new Date(hoje.getFullYear(), hoje.getMonth() - 2, 1);
                    break;
                case 'semestre':
                    dataInicio = new Date(hoje.getFullYear(), hoje.getMonth() - 5, 1);
                    break;
                case 'ano':
                    dataInicio = new Date(hoje.getFullYear(), 0, 1);
                    break;
                default:
                    dataInicio = null;
            }

            leadsFiltrados = leads.filter(l => {
                if (!dataInicio) return true;
                const data = l.criadoEm?.toDate ? l.criadoEm.toDate() : new Date(l.criadoEm || 0);
                return data >= dataInicio;
            });

            atualizarResumoGeral();
            renderizarProducao();
            renderizarRamos();
            renderizarSeguradoras();
            renderizarFunil();
            renderizarEvolucao();
            renderizarMetricas();
        }

        // Atualizar resumo geral
        function atualizarResumoGeral() {
            const fechados = leadsFiltrados.filter(l => l.status === 'negocio_fechado');
            const perdidos = leadsFiltrados.filter(l => l.status === 'negocio_perdido').length;
            const receita = fechados.reduce((sum, l) => sum + (l.valorPremio || 0), 0);
            const conversao = (fechados.length + perdidos) > 0 
                ? ((fechados.length / (fechados.length + perdidos)) * 100).toFixed(1)
                : '0.0';

            document.getElementById('statLeadsTotal').textContent = leadsFiltrados.length;
            document.getElementById('statFechados').textContent = fechados.length;
            document.getElementById('statConversao').textContent = conversao + '%';
            document.getElementById('statReceita').textContent = `R$ ${receita.toLocaleString('pt-BR', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}`;
        }

        // Renderizar produção por funcionário
        function renderizarProducao() {
            const producao = {};
            
            // Incluir "Não atribuído"
            producao['nao_atribuido'] = {
                nome: 'Não atribuído',
                leads: 0,
                cotacoes: 0,
                fechados: 0,
                perdidos: 0,
                receita: 0,
                comissao: 0
            };

            // Inicializar funcionários
            funcionarios.forEach(f => {
                producao[f.id] = {
                    nome: f.nome || f.email,
                    leads: 0,
                    cotacoes: 0,
                    fechados: 0,
                    perdidos: 0,
                    receita: 0,
                    comissao: 0
                };
            });

            // Calcular métricas
            leadsFiltrados.forEach(l => {
                const key = l.responsavelId || 'nao_atribuido';
                if (!producao[key]) {
                    producao[key] = {
                        nome: l.responsavelNome || 'Desconhecido',
                        leads: 0,
                        cotacoes: 0,
                        fechados: 0,
                        perdidos: 0,
                        receita: 0,
                        comissao: 0
                    };
                }

                producao[key].leads++;

                if (['cotacao_enviada', 'negocio_fechado', 'negocio_perdido', 'recusada_seguradora'].includes(l.status)) {
                    producao[key].cotacoes++;
                }

                if (l.status === 'negocio_fechado') {
                    producao[key].fechados++;
                    producao[key].receita += l.valorPremio || 0;
                    producao[key].comissao += (l.valorPremio || 0) * (l.comissao || 0) / 100;
                }

                if (l.status === 'negocio_perdido') {
                    producao[key].perdidos++;
                }
            });

            // Ordenar por fechados
            const ordenado = Object.values(producao)
                .filter(p => p.leads > 0)
                .sort((a, b) => b.fechados - a.fechados || b.receita - a.receita);

            const tbody = document.getElementById('tabelaProducao');
            
            if (ordenado.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="text-center">Nenhum dado no período</td></tr>';
                document.getElementById('tabelaProducaoTotal').innerHTML = '';
                return;
            }

            // Totais
            const totais = ordenado.reduce((acc, p) => {
                acc.leads += p.leads;
                acc.cotacoes += p.cotacoes;
                acc.fechados += p.fechados;
                acc.perdidos += p.perdidos;
                acc.receita += p.receita;
                acc.comissao += p.comissao;
                return acc;
            }, { leads: 0, cotacoes: 0, fechados: 0, perdidos: 0, receita: 0, comissao: 0 });

            tbody.innerHTML = ordenado.map(p => {
                const conversao = (p.fechados + p.perdidos) > 0 
                    ? ((p.fechados / (p.fechados + p.perdidos)) * 100).toFixed(1)
                    : '0.0';

                return `
                    <tr>
                        <td><strong>${p.nome}</strong></td>
                        <td>${p.leads}</td>
                        <td>${p.cotacoes}</td>
                        <td class="text-success">${p.fechados}</td>
                        <td class="text-danger">${p.perdidos}</td>
                        <td>${conversao}%</td>
                        <td>R$ ${p.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                        <td>R$ ${p.comissao.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                    </tr>
                `;
            }).join('');

            const conversaoTotal = (totais.fechados + totais.perdidos) > 0 
                ? ((totais.fechados / (totais.fechados + totais.perdidos)) * 100).toFixed(1)
                : '0.0';

            document.getElementById('tabelaProducaoTotal').innerHTML = `
                <tr style="font-weight: bold; background: rgba(0,136,170,0.1);">
                    <td>TOTAL</td>
                    <td>${totais.leads}</td>
                    <td>${totais.cotacoes}</td>
                    <td class="text-success">${totais.fechados}</td>
                    <td class="text-danger">${totais.perdidos}</td>
                    <td>${conversaoTotal}%</td>
                    <td>R$ ${totais.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                    <td>R$ ${totais.comissao.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                </tr>
            `;
        }

        // Renderizar por ramos
        function renderizarRamos() {
            const ramos = {};
            const ramosNomes = {
                'auto': 'Auto',
                'residencial': 'Residencial',
                'vida': 'Vida',
                'empresarial': 'Empresarial',
                'saude': 'Saúde',
                'outros': 'Outros'
            };

            leadsFiltrados.forEach(l => {
                const ramo = l.ramo || 'outros';
                if (!ramos[ramo]) {
                    ramos[ramo] = { leads: 0, fechados: 0, receita: 0 };
                }
                ramos[ramo].leads++;
                if (l.status === 'negocio_fechado') {
                    ramos[ramo].fechados++;
                    ramos[ramo].receita += l.valorPremio || 0;
                }
            });

            const ordenado = Object.entries(ramos)
                .sort((a, b) => b[1].receita - a[1].receita);

            const tbody = document.getElementById('tabelaRamos');
            
            if (ordenado.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">Nenhum dado</td></tr>';
                return;
            }

            tbody.innerHTML = ordenado.map(([ramo, dados]) => `
                <tr>
                    <td><strong>${ramosNomes[ramo] || ramo}</strong></td>
                    <td>${dados.leads}</td>
                    <td>${dados.fechados}</td>
                    <td>R$ ${dados.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                </tr>
            `).join('');
        }

        // Renderizar por seguradoras
        function renderizarSeguradoras() {
            const seguradoras = {};
            let totalReceita = 0;

            const fechados = leadsFiltrados.filter(l => l.status === 'negocio_fechado');
            
            fechados.forEach(l => {
                const seg = l.seguradora || 'Não informada';
                if (!seguradoras[seg]) {
                    seguradoras[seg] = { apolices: 0, receita: 0 };
                }
                seguradoras[seg].apolices++;
                seguradoras[seg].receita += l.valorPremio || 0;
                totalReceita += l.valorPremio || 0;
            });

            const ordenado = Object.entries(seguradoras)
                .sort((a, b) => b[1].receita - a[1].receita);

            const tbody = document.getElementById('tabelaSeguradoras');
            
            if (ordenado.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center">Nenhum dado</td></tr>';
                return;
            }

            tbody.innerHTML = ordenado.map(([seg, dados]) => {
                const percentual = totalReceita > 0 ? ((dados.receita / totalReceita) * 100).toFixed(1) : 0;
                return `
                    <tr>
                        <td><strong>${seg}</strong></td>
                        <td>${dados.apolices}</td>
                        <td>R$ ${dados.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                        <td>${percentual}%</td>
                    </tr>
                `;
            }).join('');
        }

        // Renderizar funil
        function renderizarFunil() {
            const contagem = {};
            statusOrdem.forEach(s => contagem[s.key] = 0);

            leadsFiltrados.forEach(l => {
                if (contagem[l.status] !== undefined) {
                    contagem[l.status]++;
                }
            });

            const total = leadsFiltrados.length || 1;
            const container = document.getElementById('funnelContainer');

            container.innerHTML = statusOrdem.map((status, index) => {
                const qtd = contagem[status.key];
                const percentual = ((qtd / total) * 100).toFixed(1);
                const width = 100 - (index * 10);

                return `
                    <div class="funnel-step" style="width: ${width}%;">
                        <div class="funnel-bar" style="background: ${status.color};">
                            <span class="funnel-label">${status.label}</span>
                            <span class="funnel-value">${qtd} (${percentual}%)</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Renderizar evolução mensal
        function renderizarEvolucao() {
            const meses = [];
            const hoje = new Date();

            for (let i = 5; i >= 0; i--) {
                const data = new Date(hoje.getFullYear(), hoje.getMonth() - i, 1);
                meses.push({
                    inicio: data,
                    fim: new Date(data.getFullYear(), data.getMonth() + 1, 0, 23, 59, 59),
                    nome: data.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' })
                });
            }

            const evolucao = meses.map(mes => {
                const leadsMes = leads.filter(l => {
                    const data = l.criadoEm?.toDate ? l.criadoEm.toDate() : new Date(l.criadoEm || 0);
                    return data >= mes.inicio && data <= mes.fim;
                });

                const fechados = leadsMes.filter(l => l.status === 'negocio_fechado');
                const perdidos = leadsMes.filter(l => l.status === 'negocio_perdido').length;
                const receita = fechados.reduce((sum, l) => sum + (l.valorPremio || 0), 0);
                const conversao = (fechados.length + perdidos) > 0 
                    ? ((fechados.length / (fechados.length + perdidos)) * 100).toFixed(1)
                    : '-';

                return {
                    mes: mes.nome,
                    leads: leadsMes.length,
                    fechados: fechados.length,
                    perdidos,
                    conversao,
                    receita
                };
            });

            const tbody = document.getElementById('tabelaEvolucao');
            tbody.innerHTML = evolucao.map(e => `
                <tr>
                    <td><strong>${e.mes}</strong></td>
                    <td>${e.leads}</td>
                    <td class="text-success">${e.fechados}</td>
                    <td class="text-danger">${e.perdidos}</td>
                    <td>${e.conversao}%</td>
                    <td>R$ ${e.receita.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</td>
                </tr>
            `).join('');
        }

        // Renderizar métricas de tempo
        function renderizarMetricas() {
            // Calcular tempo médio em cada etapa (simplificado)
            const metricas = [
                { label: 'Tempo Médio até Primeiro Contato', value: '2.5 dias', icon: 'fa-phone' },
                { label: 'Tempo Médio até Cotação', value: '5.2 dias', icon: 'fa-file-invoice' },
                { label: 'Tempo Médio até Fechamento', value: '12.8 dias', icon: 'fa-handshake' },
                { label: 'Ticket Médio', value: calcularTicketMedio(), icon: 'fa-dollar-sign' }
            ];

            const container = document.getElementById('metricsGrid');
            container.innerHTML = metricas.map(m => `
                <div class="metric-card">
                    <i class="fas ${m.icon}"></i>
                    <div class="metric-info">
                        <span class="metric-value">${m.value}</span>
                        <span class="metric-label">${m.label}</span>
                    </div>
                </div>
            `).join('');
        }

        // Calcular ticket médio
        function calcularTicketMedio() {
            const fechados = leadsFiltrados.filter(l => l.status === 'negocio_fechado');
            if (fechados.length === 0) return 'R$ 0';
            const total = fechados.reduce((sum, l) => sum + (l.valorPremio || 0), 0);
            return `R$ ${(total / fechados.length).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}`;
        }

        // Mostrar toast
        function mostrarToast(mensagem, tipo = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = mensagem;
            toast.className = `toast ${tipo} show`;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Logout
        function fazerLogout() {
            auth.signOut().then(() => {
                window.location.href = 'login.html';
            });
        }

        // Mobile toggle
        document.getElementById('mobileToggle').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('active');
        });
    </script>

    <style>
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 1024px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        .text-success { color: var(--success); }
        .text-danger { color: var(--danger); }

        .funnel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 20px;
        }

        .funnel-step {
            transition: width 0.3s ease;
        }

        .funnel-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
        }

        .funnel-label {
            font-size: 0.9rem;
        }

        .funnel-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .metric-card {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: var(--dark-lighter);
            border-radius: 8px;
        }

        .metric-card i {
            font-size: 2rem;
            color: var(--primary);
        }

        .metric-info {
            display: flex;
            flex-direction: column;
        }

        .metric-value {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        tfoot tr {
            border-top: 2px solid var(--primary);
        }
    </style>
</body>
</html>
