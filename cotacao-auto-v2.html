<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cota√ß√£o Seguro Auto | Retorno Seguros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #0088aa;
            --primary-dark: #006680;
            --secondary: #00b8d4;
            --dark-blue: #004d66;
            --light-bg: #f0f9fb;
            --white: #ffffff;
            --text-dark: #1a2b3c;
            --text-light: #5a6b7c;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 4px 20px rgba(0, 136, 170, 0.15);
            --shadow-lg: 0 10px 40px rgba(0, 136, 170, 0.2);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #e6f4f7 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--white);
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-img {
            height: 40px;
            width: auto;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 1.2rem;
        }

        .logo-text-container {
            display: flex;
            flex-direction: column;
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--text-dark);
            letter-spacing: -0.5px;
        }

        .logo-sub {
            font-size: 0.7rem;
            color: var(--primary);
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        /* Progress Bar */
        .progress-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .progress-bar {
            height: 6px;
            background: rgba(0, 136, 170, 0.15);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 3px;
            transition: width 0.5s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Main Container */
        .main-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
        }

        /* Step Card */
        .step-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow);
            display: none;
            animation: slideIn 0.4s ease;
        }

        .step-card.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .step-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 1.8rem;
        }

        .step-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .step-subtitle {
            text-align: center;
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .greeting-name {
            color: var(--primary);
            font-weight: 600;
        }

        /* Input Styles */
        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-dark);
        }

        .text-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e5e9ec;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .text-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 136, 170, 0.1);
        }

        .text-input::placeholder {
            color: #a0aab4;
        }

        /* Option Buttons */
        .options-grid {
            display: grid;
            gap: 0.75rem;
        }

        .options-grid.two-cols {
            grid-template-columns: repeat(2, 1fr);
        }

        .option-btn {
            padding: 1.25rem;
            border: 2px solid #e5e9ec;
            border-radius: 14px;
            background: var(--white);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .option-btn:hover {
            border-color: var(--primary);
            background: var(--light-bg);
        }

        .option-btn.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(0, 136, 170, 0.08), rgba(0, 184, 212, 0.08));
            box-shadow: 0 0 0 4px rgba(0, 136, 170, 0.1);
        }

        .option-icon {
            font-size: 1.8rem;
        }

        .option-text {
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .option-desc {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        /* Checkbox Options */
        .checkbox-grid {
            display: grid;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            padding: 1rem 1.25rem;
            border: 2px solid #e5e9ec;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            border-color: var(--primary);
        }

        .checkbox-item.selected {
            border-color: var(--primary);
            background: rgba(0, 136, 170, 0.05);
        }

        .checkbox-box {
            width: 24px;
            height: 24px;
            border: 2px solid #d0d5dd;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .checkbox-item.selected .checkbox-box {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-box::after {
            content: '‚úì';
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .checkbox-item.selected .checkbox-box::after {
            opacity: 1;
        }

        .checkbox-content h4 {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .checkbox-content p {
            font-size: 0.85rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        /* Vehicle Select */
        .select-group {
            margin-bottom: 1rem;
        }

        .select-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e5e9ec;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            background: var(--white);
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%235a6b7c' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            transition: all 0.3s ease;
        }

        .select-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 136, 170, 0.1);
        }

        .select-input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Buttons */
        .btn-container {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
        }

        .btn {
            flex: 1;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(0, 136, 170, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 136, 170, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--white);
            color: var(--text-dark);
            border: 2px solid #e5e9ec;
        }

        .btn-secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary);
        }

        /* Result Card */
        .result-card {
            background: linear-gradient(135deg, var(--primary), var(--dark-blue));
            border-radius: 20px;
            padding: 2rem;
            color: white;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .result-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .result-installment {
            font-size: 1rem;
            opacity: 0.9;
        }

        .result-note {
            font-size: 0.8rem;
            opacity: 0.7;
            margin-top: 1rem;
            line-height: 1.4;
        }

        /* Commitment Section */
        .commitment-box {
            background: var(--light-bg);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .commitment-box h3 {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .commitment-box p {
            color: var(--text-light);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* WhatsApp Button */
        .btn-whatsapp {
            background: #25D366;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1.25rem;
            width: 100%;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(37, 211, 102, 0.4);
        }

        .btn-whatsapp svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        /* Info Tooltip */
        .info-tooltip {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 136, 170, 0.1);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.85rem;
            color: var(--primary);
        }

        .info-tooltip::before {
            content: '‚ÑπÔ∏è';
        }

        /* Vehicle Info Display */
        .vehicle-display {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            border: 2px solid rgba(0, 136, 170, 0.2);
        }

        .vehicle-name {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .vehicle-price {
            color: var(--primary);
            font-weight: 600;
        }

        /* Franquia Options */
        .franquia-card {
            border: 2px solid #e5e9ec;
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .franquia-card:hover {
            border-color: var(--primary);
        }

        .franquia-card.selected {
            border-color: var(--primary);
            background: rgba(0, 136, 170, 0.05);
        }

        .franquia-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .franquia-name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .franquia-value {
            font-weight: 700;
            color: var(--primary);
        }

        .franquia-desc {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        /* Loading State */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            display: none;
        }

        .loading-overlay.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(0, 136, 170, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 1rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* Select Loading */
        .select-input.loading {
            background-image: none;
            position: relative;
        }

        .select-loading-indicator {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 136, 170, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Error message */
        .error-message {
            background: #fef2f2;
            border: 1px solid #fecaca;
            color: var(--error);
            padding: 0.75rem 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Responsive */
        @media (max-width: 480px) {
            .step-card {
                padding: 1.5rem 1.25rem;
            }

            .step-title {
                font-size: 1.3rem;
            }

            .result-value {
                font-size: 2rem;
            }

            .options-grid.two-cols {
                grid-template-columns: 1fr;
            }
        }

        /* Summary List */
        .summary-list {
            background: var(--light-bg);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .summary-label {
            color: var(--text-light);
        }

        .summary-value {
            font-weight: 600;
            color: var(--text-dark);
        }

        /* Thinking Button */
        .btn-thinking {
            position: relative;
        }

        .btn-thinking::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">Carregando...</div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <!-- Substitua pelo logo real da Retorno -->
                <img src="logoretorno.png" alt="Retorno" class="logo-img" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                <div class="logo-icon" style="display: none;">R</div>
                <div class="logo-text-container">
                    <span class="logo-text">RETORNO</span>
                    <span class="logo-sub">Seguros e Benef√≠cios</span>
                </div>
            </a>
        </div>
    </header>

    <!-- Progress -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Passo 1 de 10</div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Step 1: Nome -->
        <div class="step-card active" id="step1">
            <div class="step-icon">üëã</div>
            <h2 class="step-title">Vamos encontrar o melhor seguro pra voc√™!</h2>
            <p class="step-subtitle">Primeiro, como posso te chamar?</p>
            
            <div class="input-group">
                <input type="text" class="text-input" id="userName" placeholder="Seu nome" autocomplete="off">
            </div>

            <div class="btn-container">
                <button class="btn btn-primary" onclick="nextStep(1)" id="btnStep1">Continuar</button>
            </div>
        </div>

        <!-- Step 2: Tipo de Seguro -->
        <div class="step-card" id="step2">
            <div class="step-icon">üìã</div>
            <h2 class="step-title">Legal, <span class="greeting-name" id="greetingName"></span>!</h2>
            <p class="step-subtitle">Voc√™ j√° tem seguro ou √© a primeira vez?</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'tipoSeguro', 'renovacao')">
                    <span class="option-icon">üîÑ</span>
                    <span class="option-text">Tenho seguro ativo</span>
                    <span class="option-desc">Quero renovar ou trocar</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'tipoSeguro', 'novo')">
                    <span class="option-icon">üÜï</span>
                    <span class="option-text">Primeiro seguro</span>
                    <span class="option-desc">Nunca tive seguro</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(2)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(2)" disabled id="btnStep2">Continuar</button>
            </div>
        </div>

        <!-- Step 3: Ve√≠culo (API FIPE) -->
        <div class="step-card" id="step3">
            <div class="step-icon">üöó</div>
            <h2 class="step-title">Me conta sobre seu carro</h2>
            <p class="step-subtitle">Selecione as informa√ß√µes do ve√≠culo</p>
            
            <div class="select-group">
                <label class="input-label">Marca</label>
                <select class="select-input" id="marca" onchange="loadModelos()">
                    <option value="">Carregando marcas...</option>
                </select>
            </div>

            <div class="select-group">
                <label class="input-label">Modelo</label>
                <select class="select-input" id="modelo" onchange="loadAnos()" disabled>
                    <option value="">Selecione a marca primeiro</option>
                </select>
            </div>

            <div class="select-group">
                <label class="input-label">Ano</label>
                <select class="select-input" id="ano" onchange="loadFipe()" disabled>
                    <option value="">Selecione o modelo primeiro</option>
                </select>
            </div>

            <div class="vehicle-display" id="vehicleDisplay" style="display: none;">
                <div class="vehicle-name" id="vehicleName"></div>
                <div class="vehicle-price">Valor FIPE: <strong id="vehiclePrice"></strong></div>
            </div>

            <div class="error-message" id="fipeError">
                N√£o foi poss√≠vel carregar os dados. Por favor, tente novamente.
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(3)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(3)" disabled id="btnStep3">Continuar</button>
            </div>
        </div>

        <!-- Step 4: Condutor -->
        <div class="step-card" id="step4">
            <div class="step-icon">üë§</div>
            <h2 class="step-title">Quem usa o carro?</h2>
            <p class="step-subtitle">Principal condutor do ve√≠culo</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'condutor', 'eu')">
                    <span class="option-icon">üôã</span>
                    <span class="option-text">Eu mesmo</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'condutor', 'outro')">
                    <span class="option-icon">üë•</span>
                    <span class="option-text">Outra pessoa</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(4)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(4)" disabled id="btnStep4">Continuar</button>
            </div>
        </div>

        <!-- Step 5: Idade -->
        <div class="step-card" id="step5">
            <div class="step-icon">üéÇ</div>
            <h2 class="step-title">Qual sua faixa de idade?</h2>
            <p class="step-subtitle">Do principal condutor</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'idade', '18-25')">
                    <span class="option-text">18 a 25 anos</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'idade', '26-35')">
                    <span class="option-text">26 a 35 anos</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'idade', '36-45')">
                    <span class="option-text">36 a 45 anos</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'idade', '46-60')">
                    <span class="option-text">46 a 60 anos</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'idade', '60+')">
                    <span class="option-text">Acima de 60</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(5)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(5)" disabled id="btnStep5">Continuar</button>
            </div>
        </div>

        <!-- Step 6: Garagem -->
        <div class="step-card" id="step6">
            <div class="step-icon">üè†</div>
            <h2 class="step-title">Onde o carro dorme?</h2>
            <p class="step-subtitle">Local habitual de pernoite</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'garagem', 'fechada')">
                    <span class="option-icon">üè†</span>
                    <span class="option-text">Garagem fechada</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'garagem', 'aberto')">
                    <span class="option-icon">üÖøÔ∏è</span>
                    <span class="option-text">Estacionamento aberto</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'garagem', 'rua')">
                    <span class="option-icon">üõ£Ô∏è</span>
                    <span class="option-text">Na rua</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(6)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(6)" disabled id="btnStep6">Continuar</button>
            </div>
        </div>

        <!-- Step 6b: B√¥nus (s√≥ para renova√ß√£o) -->
        <div class="step-card" id="step6b">
            <div class="step-icon">‚≠ê</div>
            <h2 class="step-title">Qual sua classe de b√¥nus?</h2>
            <p class="step-subtitle">O b√¥nus √© o desconto que voc√™ acumula a cada ano sem sinistro</p>
            
            <div class="select-group">
                <select class="select-input" id="bonus" onchange="checkBonus()">
                    <option value="">Selecione</option>
                    <option value="0">B√¥nus 0 (sem desconto)</option>
                    <option value="1">B√¥nus 1 (10% desconto)</option>
                    <option value="2">B√¥nus 2 (15% desconto)</option>
                    <option value="3">B√¥nus 3 (20% desconto)</option>
                    <option value="4">B√¥nus 4 (25% desconto)</option>
                    <option value="5">B√¥nus 5 (30% desconto)</option>
                    <option value="6">B√¥nus 6 (30% desconto)</option>
                    <option value="7">B√¥nus 7 (30% desconto)</option>
                    <option value="8">B√¥nus 8 (35% desconto)</option>
                    <option value="9">B√¥nus 9 (35% desconto)</option>
                    <option value="10">B√¥nus 10 (35% desconto)</option>
                    <option value="naosei">N√£o sei / N√£o lembro</option>
                </select>
            </div>

            <div class="info-tooltip">
                A classe de b√¥nus est√° na sua ap√≥lice atual
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep('6b')">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep('6b')" disabled id="btnStep6b">Continuar</button>
            </div>
        </div>

        <!-- Step 6c: Sinistro (s√≥ para renova√ß√£o) -->
        <div class="step-card" id="step6c">
            <div class="step-icon">üîß</div>
            <h2 class="step-title">Acionou o seguro recentemente?</h2>
            <p class="step-subtitle">Teve algum sinistro na √∫ltima vig√™ncia?</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'sinistro', 'sim')">
                    <span class="option-icon">‚ö†Ô∏è</span>
                    <span class="option-text">Sim, tive sinistro</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'sinistro', 'nao')">
                    <span class="option-icon">‚úÖ</span>
                    <span class="option-text">N√£o, tudo tranquilo</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep('6c')">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep('6c')" disabled id="btnStep6c">Continuar</button>
            </div>
        </div>

        <!-- Step 7: Reboque -->
        <div class="step-card" id="step7">
            <div class="step-icon">üöõ</div>
            <h2 class="step-title">Dist√¢ncia de reboque</h2>
            <p class="step-subtitle">Se precisar de reboque, qual dist√¢ncia te atenderia?</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'reboque', '200')">
                    <span class="option-icon">üìç</span>
                    <span class="option-text">At√© 200 km</span>
                    <span class="option-desc">Uso urbano</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reboque', '400')">
                    <span class="option-icon">üõ£Ô∏è</span>
                    <span class="option-text">At√© 400 km</span>
                    <span class="option-desc">Viajo √†s vezes</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reboque', '600')">
                    <span class="option-icon">‚úàÔ∏è</span>
                    <span class="option-text">At√© 600 km</span>
                    <span class="option-desc">Viajo bastante</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reboque', 'ilimitado')">
                    <span class="option-icon">üåé</span>
                    <span class="option-text">Km ilimitado</span>
                    <span class="option-desc">Total tranquilidade</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(7)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(7)" disabled id="btnStep7">Continuar</button>
            </div>
        </div>

        <!-- Step 8: Terceiros -->
        <div class="step-card" id="step8">
            <div class="step-icon">üöô</div>
            <h2 class="step-title">Prote√ß√£o contra terceiros</h2>
            <p class="step-subtitle">Se voc√™ bater em outro carro, qual prote√ß√£o faz sentido?</p>
            
            <div class="options-grid">
                <div class="option-btn" onclick="selectOption(this, 'terceiros', '50')">
                    <span class="option-text">R$ 50 mil</span>
                    <span class="option-desc">Carros populares</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'terceiros', '100')">
                    <span class="option-text">R$ 100 mil</span>
                    <span class="option-desc">Carros m√©dios</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'terceiros', '200')">
                    <span class="option-text">R$ 200 mil</span>
                    <span class="option-desc">Recomendado ‚≠ê</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'terceiros', '300')">
                    <span class="option-text">R$ 300 mil</span>
                    <span class="option-desc">M√°xima prote√ß√£o</span>
                </div>
            </div>

            <div class="info-tooltip">
                Cobre danos que voc√™ causar em outros ve√≠culos e pessoas
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(8)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(8)" disabled id="btnStep8">Continuar</button>
            </div>
        </div>

        <!-- Step 9: Carro Reserva -->
        <div class="step-card" id="step9">
            <div class="step-icon">üöï</div>
            <h2 class="step-title">Carro reserva</h2>
            <p class="step-subtitle">Se o carro ficar na oficina, quantos dias seriam ideais?</p>
            
            <div class="options-grid two-cols">
                <div class="option-btn" onclick="selectOption(this, 'reserva', '0')">
                    <span class="option-text">N√£o preciso</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reserva', '7')">
                    <span class="option-text">7 dias</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reserva', '15')">
                    <span class="option-text">15 dias</span>
                </div>
                <div class="option-btn" onclick="selectOption(this, 'reserva', '30')">
                    <span class="option-text">30 dias</span>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(9)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(9)" disabled id="btnStep9">Continuar</button>
            </div>
        </div>

        <!-- Step 10: Servi√ßos Extras -->
        <div class="step-card" id="step10">
            <div class="step-icon">üîß</div>
            <h2 class="step-title">Servi√ßos extras</h2>
            <p class="step-subtitle">Quais fazem sentido pra voc√™? (pode marcar v√°rios)</p>
            
            <div class="checkbox-grid">
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'vidros')">
                    <div class="checkbox-box"></div>
                    <div class="checkbox-content">
                        <h4>ü™ü Vidros</h4>
                        <p>Troca de para-brisa, vidros laterais e retrovisores</p>
                    </div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'martelinho')">
                    <div class="checkbox-box"></div>
                    <div class="checkbox-content">
                        <h4>üî® Martelinho de Ouro</h4>
                        <p>Remove amassados pequenos sem repintura</p>
                    </div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'parachoque')">
                    <div class="checkbox-box"></div>
                    <div class="checkbox-content">
                        <h4>üõ°Ô∏è Para-choque</h4>
                        <p>Reparo ou troca em caso de danos</p>
                    </div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'pintura')">
                    <div class="checkbox-box"></div>
                    <div class="checkbox-content">
                        <h4>üé® Pintura e Lataria</h4>
                        <p>Conserto de arranh√µes e pequenos amassados</p>
                    </div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'pneu')">
                    <div class="checkbox-box"></div>
                    <div class="checkbox-content">
                        <h4>üõû Pneu, Roda e Suspens√£o</h4>
                        <p>Danos causados por buracos</p>
                    </div>
                </div>
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(10)">Voltar</button>
                <button class="btn btn-primary" onclick="nextStep(10)">Continuar</button>
            </div>
        </div>

        <!-- Step 11: Franquia -->
        <div class="step-card" id="step11">
            <div class="step-icon">üí∞</div>
            <h2 class="step-title">Tipo de franquia</h2>
            <p class="step-subtitle">Valor que voc√™ paga em caso de reparo</p>
            
            <div id="franquiaOptions">
                <div class="franquia-card" onclick="selectFranquia(this, 'basica')">
                    <div class="franquia-header">
                        <span class="franquia-name">Franquia B√°sica</span>
                        <span class="franquia-value" id="franquiaBasica">~R$ 5.500</span>
                    </div>
                    <div class="franquia-desc">Pago menos no seguro, mais se usar</div>
                </div>
                <div class="franquia-card" onclick="selectFranquia(this, 'reduzida')">
                    <div class="franquia-header">
                        <span class="franquia-name">Franquia Reduzida (50%)</span>
                        <span class="franquia-value" id="franquiaReduzida">~R$ 2.750</span>
                    </div>
                    <div class="franquia-desc">Equil√≠brio custo-benef√≠cio</div>
                </div>
                <div class="franquia-card" onclick="selectFranquia(this, 'super')">
                    <div class="franquia-header">
                        <span class="franquia-name">Super Reduzida (25%)</span>
                        <span class="franquia-value" id="franquiaSuper">~R$ 1.375</span>
                    </div>
                    <div class="franquia-desc">Pago mais no seguro, menos se usar</div>
                </div>
            </div>

            <div class="info-tooltip">
                A franquia √© o valor que voc√™ paga quando aciona o seguro para reparos
            </div>

            <div class="btn-container">
                <button class="btn btn-secondary" onclick="prevStep(11)">Voltar</button>
                <button class="btn btn-primary" onclick="calcularResultado()" disabled id="btnStep11">Ver resultado</button>
            </div>
        </div>

        <!-- Step 12: Resultado -->
        <div class="step-card" id="step12">
            <div class="step-icon">üéØ</div>
            <h2 class="step-title"><span id="resultName"></span>, baseado no que voc√™ me contou...</h2>
            <p class="step-subtitle">Vamos brigar para chegar em:</p>
            
            <div class="result-card">
                <div class="result-label">Valor estimado</div>
                <div class="result-value" id="resultValue">R$ 2.850 - R$ 3.400</div>
                <div class="result-installment" id="resultInstallment">ou 12x de R$ 237 a R$ 283</div>
                <div class="result-note">*Valores aproximados. O valor final depende da an√°lise das seguradoras.</div>
            </div>

            <div class="summary-list" id="summaryList">
                <!-- Preenchido via JS -->
            </div>

            <div class="commitment-box">
                <h3>ü§ù Estamos juntos nessa?</h3>
                <p>Se a gente conseguir esse valor ou melhor, voc√™ fecha com a Retorno?</p>
            </div>

            <a href="#" class="btn-whatsapp" id="whatsappBtn" target="_blank">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                </svg>
                Estou dentro! Vamos nessa! üí™
            </a>

            <div style="margin-top: 1rem;">
                <button class="btn btn-secondary" style="width: 100%;" onclick="prevStep(12)">Quero ajustar algo</button>
            </div>
        </div>

    </div>

    <script>
        // ============================================================
        // FIREBASE CONFIG - SUBSTITUIR PELAS SUAS CREDENCIAIS
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDlbEZfA_uAR1aoPZIr8T9B6KNcrwfMxm0",
            authDomain: "retorno-seguros.firebaseapp.com",
            projectId: "retorno-seguros",
            storageBucket: "retorno-seguros.appspot.com",
            messagingSenderId: "495712392972",
            appId: "1:495712392972:web:e1e78aedc48bdeea48db29",
            measurementId: "G-C6E44WXLPW"
        };

        // Inicializa Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // ============================================================
        // DATA & STATE
        // ============================================================
        let currentStep = 1;
        
        const formData = {
            nome: '',
            tipoSeguro: '',
            marcaCodigo: '',
            marcaNome: '',
            modeloCodigo: '',
            modeloNome: '',
            anoCodigo: '',
            anoNome: '',
            valorFipe: 0,
            condutor: '',
            idade: '',
            garagem: '',
            bonus: '',
            sinistro: '',
            reboque: '',
            terceiros: '',
            reserva: '',
            extras: [],
            franquia: '',
            valorEstimadoMin: 0,
            valorEstimadoMax: 0
        };

        // Cache da API FIPE
        const fipeCache = {
            marcas: null,
            modelos: {},
            anos: {}
        };

        // ============================================================
        // API FIPE FUNCTIONS
        // ============================================================
        const FIPE_API = 'https://parallelum.com.br/fipe/api/v1';

        async function loadMarcas() {
            const marcaSelect = document.getElementById('marca');
            
            try {
                // Verifica cache
                if (fipeCache.marcas) {
                    populateMarcas(fipeCache.marcas);
                    return;
                }

                marcaSelect.innerHTML = '<option value="">Carregando marcas...</option>';
                
                const response = await fetch(`${FIPE_API}/carros/marcas`);
                if (!response.ok) throw new Error('Erro na API');
                
                const marcas = await response.json();
                fipeCache.marcas = marcas;
                populateMarcas(marcas);
                
            } catch (error) {
                console.error('Erro ao carregar marcas:', error);
                marcaSelect.innerHTML = '<option value="">Erro ao carregar - tente novamente</option>';
                document.getElementById('fipeError').classList.add('show');
            }
        }

        function populateMarcas(marcas) {
            const marcaSelect = document.getElementById('marca');
            marcaSelect.innerHTML = '<option value="">Selecione a marca</option>';
            
            // Ordenar alfabeticamente
            marcas.sort((a, b) => a.nome.localeCompare(b.nome));
            
            marcas.forEach(marca => {
                const option = document.createElement('option');
                option.value = marca.codigo;
                option.textContent = marca.nome;
                option.dataset.nome = marca.nome;
                marcaSelect.appendChild(option);
            });
        }

        async function loadModelos() {
            const marcaCodigo = document.getElementById('marca').value;
            const marcaSelect = document.getElementById('marca');
            const modeloSelect = document.getElementById('modelo');
            const anoSelect = document.getElementById('ano');
            
            // Reset
            modeloSelect.innerHTML = '<option value="">Selecione o modelo</option>';
            modeloSelect.disabled = true;
            anoSelect.innerHTML = '<option value="">Selecione o modelo primeiro</option>';
            anoSelect.disabled = true;
            document.getElementById('vehicleDisplay').style.display = 'none';
            document.getElementById('btnStep3').disabled = true;
            document.getElementById('fipeError').classList.remove('show');
            
            if (!marcaCodigo) return;
            
            // Salva marca selecionada
            formData.marcaCodigo = marcaCodigo;
            formData.marcaNome = marcaSelect.options[marcaSelect.selectedIndex].dataset.nome;
            
            try {
                // Verifica cache
                if (fipeCache.modelos[marcaCodigo]) {
                    populateModelos(fipeCache.modelos[marcaCodigo]);
                    return;
                }

                modeloSelect.innerHTML = '<option value="">Carregando modelos...</option>';
                
                const response = await fetch(`${FIPE_API}/carros/marcas/${marcaCodigo}/modelos`);
                if (!response.ok) throw new Error('Erro na API');
                
                const data = await response.json();
                fipeCache.modelos[marcaCodigo] = data.modelos;
                populateModelos(data.modelos);
                
            } catch (error) {
                console.error('Erro ao carregar modelos:', error);
                modeloSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                document.getElementById('fipeError').classList.add('show');
            }
        }

        function populateModelos(modelos) {
            const modeloSelect = document.getElementById('modelo');
            modeloSelect.innerHTML = '<option value="">Selecione o modelo</option>';
            modeloSelect.disabled = false;
            
            modelos.forEach(modelo => {
                const option = document.createElement('option');
                option.value = modelo.codigo;
                option.textContent = modelo.nome;
                option.dataset.nome = modelo.nome;
                modeloSelect.appendChild(option);
            });
        }

        async function loadAnos() {
            const marcaCodigo = formData.marcaCodigo;
            const modeloCodigo = document.getElementById('modelo').value;
            const modeloSelect = document.getElementById('modelo');
            const anoSelect = document.getElementById('ano');
            
            // Reset
            anoSelect.innerHTML = '<option value="">Selecione o ano</option>';
            anoSelect.disabled = true;
            document.getElementById('vehicleDisplay').style.display = 'none';
            document.getElementById('btnStep3').disabled = true;
            document.getElementById('fipeError').classList.remove('show');
            
            if (!modeloCodigo) return;
            
            // Salva modelo selecionado
            formData.modeloCodigo = modeloCodigo;
            formData.modeloNome = modeloSelect.options[modeloSelect.selectedIndex].dataset.nome;
            
            const cacheKey = `${marcaCodigo}-${modeloCodigo}`;
            
            try {
                // Verifica cache
                if (fipeCache.anos[cacheKey]) {
                    populateAnos(fipeCache.anos[cacheKey]);
                    return;
                }

                anoSelect.innerHTML = '<option value="">Carregando anos...</option>';
                
                const response = await fetch(`${FIPE_API}/carros/marcas/${marcaCodigo}/modelos/${modeloCodigo}/anos`);
                if (!response.ok) throw new Error('Erro na API');
                
                const anos = await response.json();
                fipeCache.anos[cacheKey] = anos;
                populateAnos(anos);
                
            } catch (error) {
                console.error('Erro ao carregar anos:', error);
                anoSelect.innerHTML = '<option value="">Erro ao carregar</option>';
                document.getElementById('fipeError').classList.add('show');
            }
        }

        function populateAnos(anos) {
            const anoSelect = document.getElementById('ano');
            anoSelect.innerHTML = '<option value="">Selecione o ano</option>';
            anoSelect.disabled = false;
            
            // Filtra apenas anos (remove "32000-1" que √© zero km gen√©rico √†s vezes)
            anos.forEach(ano => {
                const option = document.createElement('option');
                option.value = ano.codigo;
                option.textContent = ano.nome;
                option.dataset.nome = ano.nome;
                anoSelect.appendChild(option);
            });
        }

        async function loadFipe() {
            const marcaCodigo = formData.marcaCodigo;
            const modeloCodigo = formData.modeloCodigo;
            const anoCodigo = document.getElementById('ano').value;
            const anoSelect = document.getElementById('ano');
            
            document.getElementById('vehicleDisplay').style.display = 'none';
            document.getElementById('btnStep3').disabled = true;
            document.getElementById('fipeError').classList.remove('show');
            
            if (!anoCodigo) return;
            
            // Salva ano selecionado
            formData.anoCodigo = anoCodigo;
            formData.anoNome = anoSelect.options[anoSelect.selectedIndex].dataset.nome;
            
            try {
                showLoading('Consultando tabela FIPE...');
                
                const response = await fetch(`${FIPE_API}/carros/marcas/${marcaCodigo}/modelos/${modeloCodigo}/anos/${anoCodigo}`);
                if (!response.ok) throw new Error('Erro na API');
                
                const dados = await response.json();
                
                // Extrai valor num√©rico
                const valorString = dados.Valor.replace('R$ ', '').replace('.', '').replace(',', '.');
                const valorFipe = parseFloat(valorString);
                
                formData.valorFipe = valorFipe;
                
                // Exibe
                document.getElementById('vehicleName').textContent = `${formData.marcaNome} ${dados.Modelo}`;
                document.getElementById('vehiclePrice').textContent = dados.Valor;
                document.getElementById('vehicleDisplay').style.display = 'block';
                document.getElementById('btnStep3').disabled = false;
                
                // Atualiza franquias
                updateFranquiaValues(valorFipe);
                
                hideLoading();
                
            } catch (error) {
                console.error('Erro ao carregar FIPE:', error);
                document.getElementById('fipeError').classList.add('show');
                hideLoading();
            }
        }

        function updateFranquiaValues(fipe) {
            const basica = Math.round(fipe * 0.08);
            const reduzida = Math.round(fipe * 0.04);
            const superRed = Math.round(fipe * 0.02);
            
            document.getElementById('franquiaBasica').textContent = `~R$ ${basica.toLocaleString('pt-BR')}`;
            document.getElementById('franquiaReduzida').textContent = `~R$ ${reduzida.toLocaleString('pt-BR')}`;
            document.getElementById('franquiaSuper').textContent = `~R$ ${superRed.toLocaleString('pt-BR')}`;
        }

        // ============================================================
        // LOADING HELPERS
        // ============================================================
        function showLoading(text = 'Carregando...') {
            document.getElementById('loadingText').textContent = text;
            document.getElementById('loadingOverlay').classList.add('active');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }

        // ============================================================
        // NAVIGATION
        // ============================================================
        function updateProgress() {
            const stepOrder = getStepOrder();
            const currentIndex = stepOrder.indexOf(currentStep.toString()) + 1;
            const total = stepOrder.length;
            const progress = (currentIndex / total) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Passo ${currentIndex} de ${total}`;
        }

        function getStepOrder() {
            const base = ['1', '2', '3', '4', '5', '6'];
            
            if (formData.tipoSeguro === 'renovacao') {
                base.push('6b', '6c');
            }
            
            base.push('7', '8', '9', '10', '11', '12');
            return base;
        }

        function showStep(step) {
            document.querySelectorAll('.step-card').forEach(card => {
                card.classList.remove('active');
            });
            
            const stepId = typeof step === 'number' ? `step${step}` : `step${step}`;
            document.getElementById(stepId).classList.add('active');
            
            currentStep = step;
            updateProgress();
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep(step) {
            const stepOrder = getStepOrder();
            const currentIndex = stepOrder.indexOf(step.toString());
            
            if (step === 1) {
                formData.nome = document.getElementById('userName').value.trim();
                if (!formData.nome) {
                    document.getElementById('userName').focus();
                    return;
                }
                document.getElementById('greetingName').textContent = formData.nome.split(' ')[0];
            }
            
            if (currentIndex < stepOrder.length - 1) {
                showStep(stepOrder[currentIndex + 1]);
            }
        }

        function prevStep(step) {
            const stepOrder = getStepOrder();
            const currentIndex = stepOrder.indexOf(step.toString());
            
            if (currentIndex > 0) {
                showStep(stepOrder[currentIndex - 1]);
            }
        }

        // ============================================================
        // OPTION SELECTION
        // ============================================================
        function selectOption(element, field, value) {
            element.parentElement.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            element.classList.add('selected');
            formData[field] = value;
            
            const stepNum = element.closest('.step-card').id.replace('step', '');
            const nextBtn = document.getElementById(`btnStep${stepNum}`);
            if (nextBtn) {
                nextBtn.disabled = false;
            }
        }

        function toggleCheckbox(element, value) {
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!formData.extras.includes(value)) {
                    formData.extras.push(value);
                }
            } else {
                formData.extras = formData.extras.filter(v => v !== value);
            }
        }

        function selectFranquia(element, value) {
            document.querySelectorAll('.franquia-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            element.classList.add('selected');
            formData.franquia = value;
            document.getElementById('btnStep11').disabled = false;
        }

        function checkBonus() {
            const bonus = document.getElementById('bonus').value;
            formData.bonus = bonus;
            document.getElementById('btnStep6b').disabled = !bonus;
        }

        // ============================================================
        // CALCULATOR - TAXAS AJUSTADAS
        // ============================================================
        function calcularResultado() {
            const fipe = formData.valorFipe;
            
            // ============================================================
            // TAXA BASE AGRESSIVA: 3.5% para b√¥nus 0
            // Descontos de b√¥nus aplicados sobre a taxa
            // ============================================================
            let taxaBase = 0.035; // 3.5% base
            
            // Fator de desconto por b√¥nus
            const descontosBonus = {
                '0': 1.00,      // Sem desconto
                '1': 0.90,      // 10% desconto
                '2': 0.85,      // 15% desconto
                '3': 0.80,      // 20% desconto
                '4': 0.75,      // 25% desconto
                '5': 0.70,      // 30% desconto
                '6': 0.70,      // 30% desconto
                '7': 0.70,      // 30% desconto
                '8': 0.65,      // 35% desconto
                '9': 0.65,      // 35% desconto
                '10': 0.65,     // 35% desconto
                'naosei': 0.85  // Conservador
            };
            
            // Se for seguro novo, usa taxa um pouco maior e sem desconto de b√¥nus
            if (formData.tipoSeguro === 'novo') {
                taxaBase = 0.045; // 4.5% para quem n√£o tem seguro
            } else {
                // Aplica desconto de b√¥nus
                const fatorBonus = descontosBonus[formData.bonus] || 1.00;
                taxaBase = taxaBase * fatorBonus;
            }
            
            // Valor base do casco
            let valorCasco = fipe * taxaBase;
            
            // ============================================================
            // MODIFICADORES DE PERFIL
            // ============================================================
            
            // Idade do condutor
            switch (formData.idade) {
                case '18-25': valorCasco *= 1.35; break;
                case '26-35': valorCasco *= 1.08; break;
                case '36-45': break; // base
                case '46-60': break; // base
                case '60+': valorCasco *= 1.03; break;
            }
            
            // Local de pernoite
            switch (formData.garagem) {
                case 'fechada': valorCasco *= 0.92; break;
                case 'aberto': break; // base
                case 'rua': valorCasco *= 1.12; break;
            }
            
            // Sinistro na vig√™ncia anterior
            if (formData.sinistro === 'sim') {
                valorCasco *= 1.15;
            }
            
            // Tipo de franquia
            switch (formData.franquia) {
                case 'basica': break;
                case 'reduzida': valorCasco *= 1.20; break;
                case 'super': valorCasco *= 1.40; break;
            }
            
            // ============================================================
            // ADICIONAIS (valores fixos de mercado)
            // ============================================================
            let adicionais = 0;
            
            // Assist√™ncia 24h b√°sica (sempre inclusa)
            adicionais += 80;
            
            // RCF - Responsabilidade Civil Facultativa
            switch (formData.terceiros) {
                case '50': adicionais += 250; break;
                case '100': adicionais += 450; break;
                case '200': adicionais += 1100; break;
                case '300': adicionais += 1500; break;
            }
            
            // Carro reserva
            switch (formData.reserva) {
                case '7': adicionais += 70; break;
                case '15': adicionais += 130; break;
                case '30': adicionais += 220; break;
            }
            
            // Servi√ßos extras
            if (formData.extras.includes('vidros')) adicionais += 90;
            if (formData.extras.includes('martelinho')) adicionais += 70;
            if (formData.extras.includes('parachoque')) adicionais += 85;
            if (formData.extras.includes('pintura')) adicionais += 70;
            if (formData.extras.includes('pneu')) adicionais += 100;
            
            // Reboque adicional
            switch (formData.reboque) {
                case '200': break; // padr√£o
                case '400': adicionais += 25; break;
                case '600': adicionais += 50; break;
                case 'ilimitado': adicionais += 100; break;
            }
            
            // ============================================================
            // C√ÅLCULO FINAL
            // ============================================================
            const total = valorCasco + adicionais;
            
            // Margem de 8% para cima e para baixo (mais apertada)
            const min = Math.round(total * 0.92);
            const max = Math.round(total * 1.08);
            
            formData.valorEstimadoMin = min;
            formData.valorEstimadoMax = max;
            
            const parcelaMin = Math.round(min / 12);
            const parcelaMax = Math.round(max / 12);
            
            // Atualiza resultado
            document.getElementById('resultName').textContent = formData.nome.split(' ')[0];
            document.getElementById('resultValue').textContent = 
                `R$ ${min.toLocaleString('pt-BR')} - R$ ${max.toLocaleString('pt-BR')}`;
            document.getElementById('resultInstallment').textContent = 
                `ou 12x de R$ ${parcelaMin.toLocaleString('pt-BR')} a R$ ${parcelaMax.toLocaleString('pt-BR')}`;
            
            // Resumo
            const summaryHTML = `
                <div class="summary-item">
                    <span class="summary-label">Ve√≠culo</span>
                    <span class="summary-value">${formData.marcaNome} ${formData.modeloNome}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Valor FIPE</span>
                    <span class="summary-value">R$ ${fipe.toLocaleString('pt-BR')}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Franquia</span>
                    <span class="summary-value">${formData.franquia === 'basica' ? 'B√°sica' : formData.franquia === 'reduzida' ? 'Reduzida 50%' : 'Super Reduzida 25%'}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Terceiros (RCF)</span>
                    <span class="summary-value">R$ ${parseInt(formData.terceiros).toLocaleString('pt-BR')} mil</span>
                </div>
                ${formData.reserva !== '0' ? `
                <div class="summary-item">
                    <span class="summary-label">Carro reserva</span>
                    <span class="summary-value">${formData.reserva} dias</span>
                </div>
                ` : ''}
            `;
            document.getElementById('summaryList').innerHTML = summaryHTML;
            
            // Monta mensagem WhatsApp
            const primeiroNome = formData.nome.split(' ')[0];
            const valorEstimado = `R$ ${min.toLocaleString('pt-BR')} a R$ ${max.toLocaleString('pt-BR')}`;
            
            let mensagem;
            if (formData.tipoSeguro === 'renovacao') {
                mensagem = `Ol√° Retorno! Eu sou o(a) ${primeiroNome} üëã\n\n` +
                    `Tenho seguro ativo e quero renovar/trocar.\n` +
                    `Ve√≠culo: ${formData.marcaNome} ${formData.modeloNome} ${formData.anoNome}\n` +
                    `Voc√™s disseram que v√£o brigar para chegar em ${valorEstimado}.\n\n` +
                    `Vou enviar minha ap√≥lice atual!`;
            } else {
                mensagem = `Ol√° Retorno! Eu sou o(a) ${primeiroNome} üëã\n\n` +
                    `Quero fazer meu primeiro seguro auto.\n` +
                    `Ve√≠culo: ${formData.marcaNome} ${formData.modeloNome} ${formData.anoNome}\n` +
                    `Voc√™s disseram que v√£o brigar para chegar em ${valorEstimado}.\n\n` +
                    `Vou enviar minha CNH e documento do ve√≠culo!`;
            }
            
            const whatsappUrl = `https://wa.me/5554996454300?text=${encodeURIComponent(mensagem)}`;
            document.getElementById('whatsappBtn').href = whatsappUrl;
            
            // Salva lead no Firebase
            salvarLead();
            
            showStep(12);
        }

        // ============================================================
        // FIREBASE - SALVAR LEAD
        // ============================================================
        async function salvarLead() {
            try {
                // Dados originais para cole√ß√£o espec√≠fica
                const dadosOriginais = {
                    nome: formData.nome,
                    tipoSeguro: formData.tipoSeguro,
                    veiculo: {
                        marca: formData.marcaNome,
                        modelo: formData.modeloNome,
                        ano: formData.anoNome,
                        valorFipe: formData.valorFipe
                    },
                    perfil: {
                        condutor: formData.condutor,
                        idade: formData.idade,
                        garagem: formData.garagem,
                        bonus: formData.bonus,
                        sinistro: formData.sinistro
                    },
                    coberturas: {
                        reboque: formData.reboque,
                        terceiros: formData.terceiros,
                        reserva: formData.reserva,
                        extras: formData.extras,
                        franquia: formData.franquia
                    },
                    valorEstimado: {
                        min: formData.valorEstimadoMin,
                        max: formData.valorEstimadoMax
                    },
                    status: 'novo',
                    dataCriacao: firebase.firestore.FieldValue.serverTimestamp(),
                    origem: 'site_cotacao_auto'
                };

                // Salva na cole√ß√£o original
                await db.collection('leads_cotacao_auto').add(dadosOriginais);
                console.log('Lead salvo em leads_cotacao_auto');

                // ============================================================
                // TAMB√âM SALVA EM leads_crm PARA O CRM ADMINISTRATIVO
                // ============================================================
                const dadosCRM = {
                    nome: formData.nome,
                    email: '',
                    whatsapp: '',
                    cpf: '',
                    dataNascimento: '',
                    cep: '',
                    cidade: '',
                    estado: '',
                    ramo: 'auto',
                    responsavelId: null,
                    responsavelNome: null,
                    observacoes: `Ve√≠culo: ${formData.marcaNome} ${formData.modeloNome} ${formData.anoNome} | FIPE: R$ ${formData.valorFipe?.toLocaleString('pt-BR') || 'N/A'} | ${formData.tipoSeguro === 'renovacao' ? 'Renova√ß√£o' : 'Seguro Novo'}`,
                    status: 'pre_cadastro',
                    origem: 'site',
                    dadosSite: dadosOriginais,
                    valorCotacao: formData.valorEstimadoMin || null,
                    seguradora: null,
                    valorPremio: null,
                    comissao: null,
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp(),
                    atualizadoEm: firebase.firestore.FieldValue.serverTimestamp(),
                    criadoPor: 'site_cotacao_auto'
                };

                await db.collection('leads_crm').add(dadosCRM);
                console.log('Lead salvo em leads_crm');

            } catch (error) {
                console.error('Erro ao salvar lead:', error);
            }
        }

        // ============================================================
        // INITIALIZATION
        // ============================================================
        document.addEventListener('DOMContentLoaded', function() {
            // Carrega marcas da API FIPE
            loadMarcas();
            
            // Enable step 1 button when name is entered
            const nameInput = document.getElementById('userName');
            nameInput.addEventListener('input', function() {
                document.getElementById('btnStep1').disabled = this.value.trim().length === 0;
            });
            document.getElementById('btnStep1').disabled = true;
            
            nameInput.focus();
            updateProgress();
        });
    </script>
</body>
</html>
