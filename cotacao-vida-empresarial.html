<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cota√ß√£o Seguro de Vida Empresarial | Retorno Seguros</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <!-- SheetJS para ler Excel -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9;
            --secondary: #a855f7;
            --accent: #c084fc;
            --gold: #f59e0b;
            --dark-bg: #1a1a2e;
            --light-bg: #f5f3ff;
            --white: #ffffff;
            --text-dark: #1a2b3c;
            --text-light: #5a6b7c;
            --success: #10b981;
            --warning: #f59e0b;
            --info: #3b82f6;
            --error: #ef4444;
            --shadow: 0 4px 20px rgba(124, 58, 237, 0.15);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: linear-gradient(135deg, var(--light-bg) 0%, #ede9fe 100%);
            min-height: 100vh;
            color: var(--text-dark);
            overflow-x: hidden;
        }

        .header {
            background: var(--white);
            padding: 1rem 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 700px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.3rem;
        }

        .logo-text-container {
            display: flex;
            flex-direction: column;
        }

        .logo-text {
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--text-dark);
        }

        .logo-sub {
            font-size: 0.7rem;
            color: var(--primary);
            font-weight: 600;
            text-transform: uppercase;
        }

        .progress-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .progress-bar-wrapper {
            background: rgba(124, 58, 237, 0.15);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .progress-bar-fill {
            background: linear-gradient(90deg, var(--primary), var(--accent));
            height: 100%;
            border-radius: 10px;
            transition: width 0.4s ease;
        }

        .progress-text {
            text-align: center;
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .main-container {
            max-width: 700px;
            margin: 0 auto;
            padding: 0 1.5rem 3rem;
        }

        .step-card {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem 1.5rem;
            box-shadow: var(--shadow);
            display: none;
            animation: slideIn 0.4s ease;
        }

        .step-card.active {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(168, 85, 247, 0.1));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .step-title {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .step-subtitle {
            text-align: center;
            font-size: 0.95rem;
            color: var(--text-light);
            margin-bottom: 2rem;
            line-height: 1.5;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
        }

        .btn {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(124, 58, 237, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-light);
            border: 2px solid #e2e8f0;
            margin-top: 0.75rem;
        }

        .btn-secondary:hover {
            background: var(--light-bg);
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Options Grid */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .options-grid.single {
            grid-template-columns: 1fr;
        }

        .option-card {
            background: var(--light-bg);
            border: 2px solid transparent;
            border-radius: 14px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            position: relative;
        }

        .option-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .option-card.selected {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.1);
        }

        .option-card .icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .option-card .title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-dark);
            margin-bottom: 0.25rem;
        }

        .option-card .subtitle {
            font-size: 0.8rem;
            color: var(--text-light);
            line-height: 1.4;
        }

        .option-card .badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--gold);
            color: white;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        /* Info Box */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05));
            border: 2px solid var(--info);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .info-box.warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(245, 158, 11, 0.05));
            border-color: var(--warning);
        }

        .info-box.success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border-color: var(--success);
        }

        .info-box .info-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            background: transparent;
            padding: 0;
            box-shadow: none;
            position: static;
        }

        .info-box .info-header span {
            font-weight: 700;
            color: var(--info);
        }

        .info-box.warning .info-header span {
            color: var(--warning);
        }

        .info-box.success .info-header span {
            color: var(--success);
        }

        .info-box p {
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* Formato Cards - Capital Global vs Movimenta√ß√£o */
        .formato-card {
            background: var(--white);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .formato-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .formato-card.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.05), rgba(168, 85, 247, 0.05));
        }

        .formato-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .formato-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .formato-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-dark);
        }

        .formato-subtitle {
            font-size: 0.8rem;
            color: var(--primary);
            font-weight: 600;
        }

        .formato-desc {
            font-size: 0.85rem;
            color: var(--text-light);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .formato-pros {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .formato-pros span {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            font-size: 0.75rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
        }

        /* Quantity Inputs */
        .quantity-group {
            background: var(--light-bg);
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .quantity-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .quantity-label .icon {
            font-size: 1.5rem;
        }

        .quantity-label .text {
            font-weight: 600;
            color: var(--text-dark);
        }

        .quantity-input-wrapper {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .quantity-btn {
            width: 44px;
            height: 44px;
            border: 2px solid var(--primary);
            background: var(--white);
            border-radius: 10px;
            font-size: 1.5rem;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background: var(--primary);
            color: var(--white);
        }

        .quantity-input {
            flex: 1;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            padding: 0.75rem;
            font-family: inherit;
        }

        .quantity-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed #cbd5e1;
            border-radius: 14px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1rem;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.02);
        }

        .upload-area.dragover {
            border-color: var(--primary);
            background: rgba(124, 58, 237, 0.05);
        }

        .upload-area .icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .upload-area .text {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.5rem;
        }

        .upload-area .subtext {
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .upload-area input {
            display: none;
        }

        /* Faixas Et√°rias */
        .faixas-container {
            margin-bottom: 1.5rem;
        }

        .faixas-section {
            background: var(--light-bg);
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .faixas-section-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
        }

        .faixas-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .faixa-item {
            text-align: center;
        }

        .faixa-label {
            font-size: 0.65rem;
            color: var(--text-light);
            margin-bottom: 0.25rem;
            font-weight: 600;
        }

        .faixa-input {
            width: 100%;
            padding: 0.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            font-family: inherit;
        }

        .faixa-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .total-vidas {
            text-align: center;
            padding: 1rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 12px;
            color: white;
        }

        .total-vidas .label {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .total-vidas .value {
            font-size: 2rem;
            font-weight: 800;
        }

        /* Coberturas */
        .coberturas-container {
            margin-bottom: 1.5rem;
        }

        .cobertura-card {
            background: var(--white);
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            margin-bottom: 0.75rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .cobertura-card.obrigatoria {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.03), rgba(168, 85, 247, 0.03));
        }

        .cobertura-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.03), rgba(16, 185, 129, 0.03));
        }

        .cobertura-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            cursor: pointer;
        }

        .cobertura-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .cobertura-card.selected .cobertura-checkbox,
        .cobertura-card.obrigatoria .cobertura-checkbox {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .cobertura-card.obrigatoria .cobertura-checkbox {
            background: var(--primary);
            border-color: var(--primary);
        }

        .cobertura-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .cobertura-info {
            flex: 1;
        }

        .cobertura-title {
            font-weight: 700;
            font-size: 0.95rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cobertura-title .badge {
            font-size: 0.65rem;
            background: var(--primary);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .cobertura-desc-short {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        .cobertura-expand {
            color: var(--text-light);
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .cobertura-card.expanded .cobertura-expand {
            transform: rotate(180deg);
        }

        .cobertura-details {
            display: none;
            padding: 0 1.25rem 1.25rem;
            border-top: 1px solid #e2e8f0;
        }

        .cobertura-card.expanded .cobertura-details {
            display: block;
        }

        .cobertura-full-desc {
            font-size: 0.85rem;
            color: var(--text-dark);
            line-height: 1.6;
            padding: 1rem 0;
        }

        .cobertura-capital-section {
            background: var(--light-bg);
            border-radius: 10px;
            padding: 1rem;
        }

        .capital-title {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
        }

        .capital-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .capital-option {
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--white);
        }

        .capital-option:hover {
            border-color: var(--primary);
        }

        .capital-option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .capital-input-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .capital-input-wrapper span {
            font-weight: 600;
            color: var(--text-dark);
        }

        .capital-custom-input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            font-family: inherit;
        }

        .capital-custom-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Separar por cargo */
        .separar-cargo-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--light-bg);
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .toggle-label {
            font-size: 0.85rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: 0.4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .toggle-switch input:checked + .toggle-slider {
            background: var(--primary);
        }

        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .cargo-capitals {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        .cargo-capitals.show {
            display: block;
        }

        .cargo-capital-row {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }

        .cargo-capital-row .cargo-label {
            width: 120px;
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-dark);
        }

        .cargo-capital-row .cargo-input {
            flex: 1;
            padding: 0.5rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            font-family: inherit;
        }

        /* Tabela de Vidas (Movimenta√ß√£o) */
        .vidas-table-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .vidas-table {
            width: 100%;
            border-collapse: collapse;
        }

        .vidas-table th {
            background: var(--light-bg);
            padding: 0.75rem;
            text-align: left;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-dark);
            position: sticky;
            top: 0;
        }

        .vidas-table td {
            padding: 0.75rem;
            border-top: 1px solid #e2e8f0;
            font-size: 0.85rem;
        }

        .badge-socio {
            background: linear-gradient(135deg, var(--gold), #d97706);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .badge-funcionario {
            background: linear-gradient(135deg, var(--info), #2563eb);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        /* Loading */
        .loading-container {
            text-align: center;
            padding: 3rem 0;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(124, 58, 237, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-dark);
            font-weight: 600;
        }

        .loading-subtext {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-top: 0.5rem;
        }

        .loading-steps {
            margin-top: 2rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .loading-step {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--light-bg);
            border-radius: 10px;
            opacity: 0.5;
            transition: all 0.3s ease;
        }

        .loading-step.active {
            opacity: 1;
            background: rgba(124, 58, 237, 0.1);
        }

        .loading-step.done {
            opacity: 1;
        }

        .loading-step .step-icon {
            width: 30px;
            height: 30px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.9rem;
            margin: 0;
        }

        .loading-step.done .step-icon {
            background: var(--success);
        }

        .loading-step .step-text {
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        /* Summary */
        .summary-card {
            background: linear-gradient(135deg, var(--primary), #5b21b6);
            border-radius: 20px;
            padding: 2rem;
            color: white;
            margin-bottom: 1.5rem;
        }

        .summary-title {
            font-size: 1rem;
            opacity: 0.9;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .summary-empresa {
            font-size: 1.5rem;
            font-weight: 800;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .summary-item {
            background: rgba(255,255,255,0.15);
            border-radius: 10px;
            padding: 0.75rem;
            text-align: center;
        }

        .summary-item.full {
            grid-column: span 2;
        }

        .summary-item .label {
            font-size: 0.75rem;
            opacity: 0.85;
            margin-bottom: 0.25rem;
        }

        .summary-item .value {
            font-weight: 700;
            font-size: 0.95rem;
        }

        /* Coberturas Resumo */
        .coberturas-resumo {
            background: var(--white);
            border-radius: 14px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
        }

        .coberturas-resumo-title {
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .cobertura-resumo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .cobertura-resumo-item:last-child {
            border-bottom: none;
        }

        .cobertura-resumo-nome {
            font-size: 0.9rem;
            color: var(--text-dark);
        }

        .cobertura-resumo-capital {
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
        }

        /* WhatsApp Button */
        .whatsapp-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 1.25rem;
            background: #25D366;
            color: white;
            text-decoration: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
        }

        .whatsapp-btn:hover {
            background: #20bd5a;
            transform: translateY(-2px);
        }

        .whatsapp-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1.5rem 0;
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e2e8f0;
        }

        /* File Info */
        .file-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid var(--success);
            border-radius: 12px;
            margin-bottom: 1rem;
        }

        .file-info .icon {
            font-size: 2rem;
        }

        .file-info .details {
            flex: 1;
        }

        .file-info .name {
            font-weight: 600;
            color: var(--text-dark);
        }

        .file-info .meta {
            font-size: 0.8rem;
            color: var(--success);
        }

        .file-info .remove {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Footer */
        .footer-note {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-light);
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .faixas-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }

            .summary-item.full {
                grid-column: span 1;
            }

            .capital-options {
                flex-direction: column;
            }

            .cargo-capital-row {
                flex-direction: column;
                align-items: stretch;
            }

            .cargo-capital-row .cargo-label {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="logo">
                <div class="logo-icon">üõ°Ô∏è</div>
                <div class="logo-text-container">
                    <span class="logo-text">Retorno</span>
                    <span class="logo-sub">Seguro de Vida Empresarial</span>
                </div>
            </a>
        </div>
    </header>

    <div class="progress-container">
        <div class="progress-bar-wrapper">
            <div class="progress-bar-fill" id="progressBar" style="width: 10%"></div>
        </div>
        <p class="progress-text" id="progressText">Etapa 1 de 8</p>
    </div>

    <div class="main-container">
        <!-- Step 1: Nome da Empresa -->
        <div class="step-card active" id="step1">
            <div class="step-icon">üè¢</div>
            <h2 class="step-title">Vamos come√ßar!</h2>
            <p class="step-subtitle">Proteja seus colaboradores com o melhor Seguro de Vida Empresarial do mercado.</p>
            
            <div class="info-box success">
                <div class="info-header">
                    <span>üí°</span>
                    <span>Por que ter Seguro de Vida Empresarial?</span>
                </div>
                <p>Al√©m de proteger os colaboradores e suas fam√≠lias, √© um diferencial competitivo para atrair talentos e demonstra que sua empresa valoriza as pessoas.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Qual o nome da sua empresa?</label>
                <input type="text" class="form-input" id="nomeEmpresa" placeholder="Ex: Empresa XYZ Ltda">
            </div>

            <button class="btn btn-primary" onclick="nextStep(1)">
                Come√ßar Cota√ß√£o ‚Üí
            </button>
        </div>

        <!-- Step 2: Tipo de Benefici√°rios -->
        <div class="step-card" id="step2">
            <div class="step-icon">üë•</div>
            <h2 class="step-title">Quem ser√° protegido?</h2>
            <p class="step-subtitle">Selecione os grupos que ter√£o cobertura no seguro.</p>

            <div class="options-grid">
                <div class="option-card" onclick="selectTipoBeneficiario('funcionarios')">
                    <div class="icon">üë∑</div>
                    <div class="title">Apenas Funcion√°rios</div>
                    <div class="subtitle">Cobertura para colaboradores CLT da empresa</div>
                </div>
                <div class="option-card" onclick="selectTipoBeneficiario('ambos')">
                    <span class="badge">MAIS COMUM</span>
                    <div class="icon">üë•</div>
                    <div class="title">Funcion√°rios + S√≥cios</div>
                    <div class="subtitle">Prote√ß√£o completa para toda a equipe</div>
                </div>
            </div>

            <div class="info-box">
                <div class="info-header">
                    <span>‚ÑπÔ∏è</span>
                    <span>Dica importante</span>
                </div>
                <p>Incluir s√≥cios permite capitais diferenciados e coberturas especiais para posi√ß√µes estrat√©gicas da empresa.</p>
            </div>

            <button class="btn btn-primary" id="btnStep2" onclick="nextStep(2)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(2)">‚Üê Voltar</button>
        </div>

        <!-- Step 3: Formato do Seguro -->
        <div class="step-card" id="step3">
            <div class="step-icon">üìã</div>
            <h2 class="step-title">Escolha o formato</h2>
            <p class="step-subtitle">Como voc√™ prefere administrar o seguro?</p>

            <div class="formato-card" onclick="selectFormato('global')">
                <div class="formato-header">
                    <div class="formato-icon">üåê</div>
                    <div>
                        <div class="formato-title">Capital Global</div>
                        <div class="formato-subtitle">Gest√£o simplificada</div>
                    </div>
                </div>
                <p class="formato-desc">
                    <strong>Como funciona:</strong> O capital total √© calculado pelo n√∫mero de funcion√°rios na GFIP no momento do sinistro. 
                    <br><br>
                    <em>Exemplo: Se contratou R$ 30 mil para 100 funcion√°rios (capital global de R$ 3 milh√µes), e na data do sinistro a empresa tiver 120 funcion√°rios, cada benefici√°rio receber√° R$ 25 mil.</em>
                </p>
                <div class="formato-pros">
                    <span>‚úì Sem movimenta√ß√£o mensal</span>
                    <span>‚úì Pre√ßo fixo</span>
                    <span>‚úì Gest√£o simples</span>
                </div>
            </div>

            <div class="formato-card" onclick="selectFormato('movimentacao')">
                <div class="formato-header">
                    <div class="formato-icon">üìä</div>
                    <div>
                        <div class="formato-title">Movimenta√ß√£o</div>
                        <div class="formato-subtitle">Capital individualizado</div>
                    </div>
                </div>
                <p class="formato-desc">
                    <strong>Como funciona:</strong> Cada colaborador tem seu capital individual garantido. Mensalmente voc√™ informa entradas e sa√≠das, e o pr√™mio √© ajustado conforme a quantidade de vidas.
                    <br><br>
                    <em>Exemplo: Se contratou R$ 30 mil por pessoa, o benefici√°rio sempre receber√° exatamente R$ 30 mil, independente do n√∫mero de funcion√°rios.</em>
                </p>
                <div class="formato-pros">
                    <span>‚úì Capital garantido por pessoa</span>
                    <span>‚úì Controle individualizado</span>
                    <span>‚úì Pre√ßo por faixa et√°ria</span>
                </div>
            </div>

            <button class="btn btn-primary" id="btnStep3" onclick="nextStep(3)" disabled>Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(3)">‚Üê Voltar</button>
        </div>

        <!-- Step 4A: Quantidade (Capital Global) -->
        <div class="step-card" id="step4a">
            <div class="step-icon">üî¢</div>
            <h2 class="step-title">Quantas pessoas?</h2>
            <p class="step-subtitle">Informe a quantidade atual de colaboradores na empresa.</p>

            <div id="quantidadeSocios" style="display: none;">
                <div class="quantity-group">
                    <div class="quantity-label">
                        <span class="icon">üëî</span>
                        <span class="text">S√≥cios / Diretores</span>
                    </div>
                    <div class="quantity-input-wrapper">
                        <button class="quantity-btn" onclick="adjustQuantity('socios', -1)">‚àí</button>
                        <input type="number" class="quantity-input" id="qtdSocios" value="2" min="1" onchange="updateTotalGlobal()">
                        <button class="quantity-btn" onclick="adjustQuantity('socios', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="quantity-group">
                <div class="quantity-label">
                    <span class="icon">üë∑</span>
                    <span class="text">Funcion√°rios</span>
                </div>
                <div class="quantity-input-wrapper">
                    <button class="quantity-btn" onclick="adjustQuantity('funcionarios', -1)">‚àí</button>
                    <input type="number" class="quantity-input" id="qtdFuncionarios" value="10" min="1" onchange="updateTotalGlobal()">
                    <button class="quantity-btn" onclick="adjustQuantity('funcionarios', 1)">+</button>
                </div>
            </div>

            <div class="total-vidas" id="totalGlobal">
                <div class="label">Total de vidas</div>
                <div class="value">10</div>
            </div>

            <button class="btn btn-primary" onclick="nextStep('4a')" style="margin-top: 1.5rem;">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep('4a')">‚Üê Voltar</button>
        </div>

        <!-- Step 4B: Faixas Et√°rias (Movimenta√ß√£o) -->
        <div class="step-card" id="step4b">
            <div class="step-icon">üìä</div>
            <h2 class="step-title">Dados dos colaboradores</h2>
            <p class="step-subtitle">Informe as idades ou envie uma planilha para c√°lculo preciso.</p>

            <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="icon">üìÅ</div>
                <p class="text">Arraste uma planilha ou clique para enviar</p>
                <p class="subtext">Aceita Excel (.xlsx, .xls) ou CSV com colunas: Nome, Data Nascimento, Cargo</p>
                <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" onchange="handleFileUpload(event)">
            </div>

            <div id="fileInfoContainer" style="display: none;"></div>

            <div class="divider">ou preencha manualmente</div>

            <!-- S√≥cios -->
            <div class="faixas-section" id="faixasSocios" style="display: none;">
                <div class="faixas-section-title">
                    <span>üëî</span> S√≥cios / Diretores por faixa et√°ria
                </div>
                <div class="faixas-grid">
                    <div class="faixa-item">
                        <div class="faixa-label">18-29</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="socio" data-faixa="18-29" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">30-39</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="socio" data-faixa="30-39" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">40-49</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="socio" data-faixa="40-49" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">50-59</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="socio" data-faixa="50-59" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">60-65</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="socio" data-faixa="60-65" onchange="updateTotalMovimentacao()">
                    </div>
                </div>
            </div>

            <!-- Funcion√°rios -->
            <div class="faixas-section">
                <div class="faixas-section-title">
                    <span>üë∑</span> Funcion√°rios por faixa et√°ria
                </div>
                <div class="faixas-grid">
                    <div class="faixa-item">
                        <div class="faixa-label">18-29</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="funcionario" data-faixa="18-29" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">30-39</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="funcionario" data-faixa="30-39" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">40-49</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="funcionario" data-faixa="40-49" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">50-59</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="funcionario" data-faixa="50-59" onchange="updateTotalMovimentacao()">
                    </div>
                    <div class="faixa-item">
                        <div class="faixa-label">60-65</div>
                        <input type="number" class="faixa-input" value="0" min="0" data-tipo="funcionario" data-faixa="60-65" onchange="updateTotalMovimentacao()">
                    </div>
                </div>
            </div>

            <div class="total-vidas" id="totalMovimentacao">
                <div class="label">Total de vidas</div>
                <div class="value">0</div>
            </div>

            <!-- Tabela de vidas importadas -->
            <div id="vidasImportadas" style="display: none; margin-top: 1rem;">
                <div class="vidas-table-container">
                    <table class="vidas-table">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Idade</th>
                                <th>Faixa</th>
                                <th>Cargo</th>
                            </tr>
                        </thead>
                        <tbody id="vidasTableBody"></tbody>
                    </table>
                </div>
            </div>

            <button class="btn btn-primary" onclick="nextStep('4b')" style="margin-top: 1.5rem;">Continuar ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep('4b')">‚Üê Voltar</button>
        </div>

        <!-- Step 5: Coberturas -->
        <div class="step-card" id="step5">
            <div class="step-icon">üõ°Ô∏è</div>
            <h2 class="step-title">Escolha as coberturas</h2>
            <p class="step-subtitle">Monte o plano ideal para sua empresa. Clique para ver detalhes e selecionar.</p>

            <div class="coberturas-container" id="coberturasContainer">
                <!-- Morte (Obrigat√≥ria) -->
                <div class="cobertura-card obrigatoria expanded" data-cobertura="morte">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox">‚úì</div>
                        <div class="cobertura-icon">‚ö±Ô∏è</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">
                                Morte
                                <span class="badge">OBRIGAT√ìRIA</span>
                            </div>
                            <div class="cobertura-desc-short">Indeniza√ß√£o aos benefici√°rios em caso de falecimento</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Garante o pagamento de indeniza√ß√£o aos benefici√°rios indicados pelo segurado em caso de morte por qualquer causa (natural ou acidental). O valor √© pago integralmente de uma s√≥ vez, proporcionando seguran√ßa financeira √† fam√≠lia em um momento dif√≠cil.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Capital segurado por pessoa:</div>
                            <div class="capital-options" data-cobertura="morte">
                                <div class="capital-option" onclick="selectCapital('morte', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('morte', 20000)">R$ 20 mil</div>
                                <div class="capital-option selected" onclick="selectCapital('morte', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('morte', 50000)">R$ 50 mil</div>
                                <div class="capital-option" onclick="selectCapital('morte', 100000)">R$ 100 mil</div>
                            </div>
                            <div class="capital-input-wrapper">
                                <span>Outro valor: R$</span>
                                <input type="text" class="capital-custom-input" placeholder="Ex: 75.000" onchange="setCustomCapital('morte', this.value)">
                            </div>

                            <div class="separar-cargo-toggle" id="separarMorte" style="display: none;">
                                <span class="toggle-label">Diferenciar capital por cargo?</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" onchange="toggleSepararCargo('morte', this.checked)">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="cargo-capitals" id="cargoCapitalsMorte">
                                <div class="cargo-capital-row">
                                    <span class="cargo-label">üëî S√≥cios:</span>
                                    <input type="text" class="cargo-input" placeholder="R$ 200.000" data-cargo="socio" data-cobertura="morte">
                                </div>
                                <div class="cargo-capital-row">
                                    <span class="cargo-label">üë∑ Funcion√°rios:</span>
                                    <input type="text" class="cargo-input" placeholder="R$ 30.000" data-cargo="funcionario" data-cobertura="morte">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Morte Acidental -->
                <div class="cobertura-card" data-cobertura="morteAcidental">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">‚ö°</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Morte Acidental</div>
                            <div class="cobertura-desc-short">Indeniza√ß√£o adicional em caso de morte por acidente</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Garante indeniza√ß√£o <strong>adicional</strong> √† cobertura de Morte quando o falecimento ocorrer exclusivamente por acidente. Os benefici√°rios recebem o valor da cobertura de Morte + o valor desta cobertura. Ideal para profiss√µes com maior exposi√ß√£o a riscos.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Capital adicional por pessoa:</div>
                            <div class="capital-options" data-cobertura="morteAcidental">
                                <div class="capital-option" onclick="selectCapital('morteAcidental', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('morteAcidental', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('morteAcidental', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('morteAcidental', 50000)">R$ 50 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invalidez por Acidente (IPA) -->
                <div class="cobertura-card" data-cobertura="ipa">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">ü¶Ω</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Invalidez por Acidente (IPA)</div>
                            <div class="cobertura-desc-short">Invalidez permanente total ou parcial por acidente</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Garante indeniza√ß√£o ao pr√≥prio segurado em caso de invalidez permanente (total ou parcial) causada exclusivamente por acidente. O valor pago √© proporcional ao grau de invalidez definido em tabela da SUSEP. Cobre perda ou redu√ß√£o funcional de membros e √≥rg√£os.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Capital m√°ximo por pessoa:</div>
                            <div class="capital-options" data-cobertura="ipa">
                                <div class="capital-option" onclick="selectCapital('ipa', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('ipa', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('ipa', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('ipa', 50000)">R$ 50 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Invalidez Funcional por Doen√ßa (IFPD) -->
                <div class="cobertura-card" data-cobertura="ifpd">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üè•</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Invalidez Funcional por Doen√ßa (IFPD)</div>
                            <div class="cobertura-desc-short">Invalidez total e permanente causada por doen√ßa</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Garante indeniza√ß√£o ao segurado que ficar inv√°lido de forma total e permanente para exercer sua profiss√£o, quando causada por doen√ßa. Diferente da IPA, esta cobertura protege contra doen√ßas incapacitantes como AVC, doen√ßas degenerativas, entre outras.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Capital por pessoa:</div>
                            <div class="capital-options" data-cobertura="ifpd">
                                <div class="capital-option" onclick="selectCapital('ifpd', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('ifpd', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('ifpd', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('ifpd', 50000)">R$ 50 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Doen√ßas Graves -->
                <div class="cobertura-card" data-cobertura="doencasGraves">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">ü´Ä</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Doen√ßas Graves</div>
                            <div class="cobertura-desc-short">Antecipa√ß√£o de capital em caso de doen√ßas graves</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Antecipa√ß√£o de parte do capital segurado de Morte caso o segurado seja diagnosticado com doen√ßas graves como: c√¢ncer, infarto, AVC, transplante de √≥rg√£os, insufici√™ncia renal, entre outras previstas na ap√≥lice. O segurado recebe em vida para custear tratamentos.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Capital antecip√°vel:</div>
                            <div class="capital-options" data-cobertura="doencasGraves">
                                <div class="capital-option" onclick="selectCapital('doencasGraves', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('doencasGraves', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('doencasGraves', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('doencasGraves', 50000)">R$ 50 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DMHO -->
                <div class="cobertura-card" data-cobertura="dmho">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üè®</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Despesas M√©dicas e Hospitalares (DMHO)</div>
                            <div class="cobertura-desc-short">Reembolso de despesas m√©dicas por acidente</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Reembolso de despesas m√©dicas, hospitalares e odontol√≥gicas decorrentes exclusivamente de acidente. Inclui interna√ß√µes, cirurgias, medicamentos, fisioterapia, pr√≥teses e tratamentos dent√°rios causados pelo acidente. Ideal para complementar planos de sa√∫de.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Limite de reembolso:</div>
                            <div class="capital-options" data-cobertura="dmho">
                                <div class="capital-option" onclick="selectCapital('dmho', 5000)">R$ 5 mil</div>
                                <div class="capital-option" onclick="selectCapital('dmho', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('dmho', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('dmho', 30000)">R$ 30 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Rescis√£o por Morte -->
                <div class="cobertura-card" data-cobertura="rescisao">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üìÑ</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Rescis√£o Trabalhista por Morte</div>
                            <div class="cobertura-desc-short">Reembolso das verbas rescis√≥rias √† empresa</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Reembolsa a empresa pelas despesas com verbas rescis√≥rias pagas aos dependentes do funcion√°rio falecido. Inclui saldo de sal√°rio, f√©rias proporcionais, 13¬∫ proporcional, FGTS e demais direitos trabalhistas. Protege o fluxo de caixa da empresa.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Limite de reembolso:</div>
                            <div class="capital-options" data-cobertura="rescisao">
                                <div class="capital-option" onclick="selectCapital('rescisao', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('rescisao', 20000)">R$ 20 mil</div>
                                <div class="capital-option" onclick="selectCapital('rescisao', 30000)">R$ 30 mil</div>
                                <div class="capital-option" onclick="selectCapital('rescisao', 50000)">R$ 50 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assist√™ncia Funeral -->
                <div class="cobertura-card" data-cobertura="assistenciaFuneral">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üåπ</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Assist√™ncia Funeral Individual</div>
                            <div class="cobertura-desc-short">Servi√ßo completo de assist√™ncia funeral</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Servi√ßo completo de assist√™ncia funeral prestado diretamente pela seguradora. Inclui: remo√ß√£o do corpo, prepara√ß√£o, vel√≥rio, sepultamento ou crema√ß√£o, documenta√ß√£o e transporte de familiares. A fam√≠lia n√£o precisa se preocupar com nada no momento dif√≠cil.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Valor do servi√ßo:</div>
                            <div class="capital-options" data-cobertura="assistenciaFuneral">
                                <div class="capital-option" onclick="selectCapital('assistenciaFuneral', 5000)">R$ 5 mil</div>
                                <div class="capital-option" onclick="selectCapital('assistenciaFuneral', 7000)">R$ 7 mil</div>
                                <div class="capital-option" onclick="selectCapital('assistenciaFuneral', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('assistenciaFuneral', 12000)">R$ 12 mil</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Aux√≠lio Funeral -->
                <div class="cobertura-card" data-cobertura="auxilioFuneral">
                    <div class="cobertura-header" onclick="toggleCobertura(this)">
                        <div class="cobertura-checkbox"></div>
                        <div class="cobertura-icon">üíê</div>
                        <div class="cobertura-info">
                            <div class="cobertura-title">Aux√≠lio Funeral Individual</div>
                            <div class="cobertura-desc-short">Reembolso de despesas funer√°rias</div>
                        </div>
                        <div class="cobertura-expand">‚ñº</div>
                    </div>
                    <div class="cobertura-details">
                        <p class="cobertura-full-desc">
                            <strong>O que cobre:</strong> Reembolso das despesas funer√°rias comprovadas mediante apresenta√ß√£o de notas fiscais. Diferente da Assist√™ncia Funeral (que √© um servi√ßo), o Aux√≠lio √© uma indeniza√ß√£o em dinheiro. A fam√≠lia escolhe os servi√ßos e √© reembolsada at√© o limite contratado.
                        </p>
                        <div class="cobertura-capital-section">
                            <div class="capital-title">Valor do reembolso:</div>
                            <div class="capital-options" data-cobertura="auxilioFuneral">
                                <div class="capital-option" onclick="selectCapital('auxilioFuneral', 5000)">R$ 5 mil</div>
                                <div class="capital-option" onclick="selectCapital('auxilioFuneral', 7000)">R$ 7 mil</div>
                                <div class="capital-option" onclick="selectCapital('auxilioFuneral', 10000)">R$ 10 mil</div>
                                <div class="capital-option" onclick="selectCapital('auxilioFuneral', 12000)">R$ 12 mil</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-box warning">
                <div class="info-header">
                    <span>üí°</span>
                    <span>Dica de especialista</span>
                </div>
                <p>As coberturas mais contratadas s√£o: Morte + IPA + Assist√™ncia Funeral. Para empresas com atividades de risco, recomendamos incluir DMHO.</p>
            </div>

            <button class="btn btn-primary" onclick="nextStep(5)">Ver resumo da cota√ß√£o ‚Üí</button>
            <button class="btn btn-secondary" onclick="prevStep(5)">‚Üê Voltar</button>
        </div>

        <!-- Step 6: Loading -->
        <div class="step-card" id="step6">
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p class="loading-text">Preparando sua cota√ß√£o...</p>
                <p class="loading-subtext">Estamos analisando as melhores op√ß√µes para sua empresa</p>

                <div class="loading-steps">
                    <div class="loading-step" id="loadStep1">
                        <div class="step-icon">1</div>
                        <span class="step-text">Analisando perfil da empresa</span>
                    </div>
                    <div class="loading-step" id="loadStep2">
                        <div class="step-icon">2</div>
                        <span class="step-text">Calculando coberturas</span>
                    </div>
                    <div class="loading-step" id="loadStep3">
                        <div class="step-icon">3</div>
                        <span class="step-text">Consultando seguradoras parceiras</span>
                    </div>
                    <div class="loading-step" id="loadStep4">
                        <div class="step-icon">4</div>
                        <span class="step-text">Gerando proposta personalizada</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 7: Resumo -->
        <div class="step-card" id="step7">
            <div class="step-icon">‚úÖ</div>
            <h2 class="step-title">Cota√ß√£o Pronta!</h2>
            <p class="step-subtitle">Confira o resumo do seu Seguro de Vida Empresarial</p>

            <div class="summary-card">
                <div class="summary-title">Seguro de Vida Empresarial</div>
                <div class="summary-empresa" id="summaryEmpresa">Empresa XYZ</div>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="label">Total de Vidas</div>
                        <div class="value" id="summaryVidas">-</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">Formato</div>
                        <div class="value" id="summaryFormato">-</div>
                    </div>
                    <div class="summary-item" id="summarySociosItem" style="display: none;">
                        <div class="label">S√≥cios/Diretores</div>
                        <div class="value" id="summarySocios">-</div>
                    </div>
                    <div class="summary-item" id="summaryFuncionariosItem">
                        <div class="label">Funcion√°rios</div>
                        <div class="value" id="summaryFuncionarios">-</div>
                    </div>
                </div>
            </div>

            <div class="coberturas-resumo">
                <div class="coberturas-resumo-title">
                    <span>üõ°Ô∏è</span> Coberturas Selecionadas
                </div>
                <div id="coberturasResumoList"></div>
            </div>

            <div class="info-box success">
                <div class="info-header">
                    <span>üéâ</span>
                    <span>Pr√≥ximo passo</span>
                </div>
                <p>Para receber a proposta completa com valores, preencha seus dados de contato e fale diretamente com nosso especialista.</p>
            </div>

            <div class="form-group">
                <label class="form-label">Seu nome</label>
                <input type="text" class="form-input" id="nome" placeholder="Digite seu nome completo">
            </div>

            <div class="form-group">
                <label class="form-label">CNPJ da empresa</label>
                <input type="text" class="form-input" id="cnpj" placeholder="00.000.000/0000-00" oninput="formatCNPJ(this)">
            </div>

            <div class="form-group">
                <label class="form-label">WhatsApp para contato</label>
                <input type="tel" class="form-input" id="whatsapp" placeholder="(00) 00000-0000" oninput="formatPhone(this)">
            </div>

            <button class="btn btn-primary" id="btnEnviar" onclick="enviarCotacao()">
                Solicitar Proposta Completa
            </button>

            <a href="#" class="whatsapp-btn" id="whatsappLink" style="display: none;">
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
                Falar com Especialista
            </a>

            <button class="btn btn-secondary" onclick="prevStep(7)">‚Üê Voltar e ajustar</button>

            <p class="footer-note">
                üîí Suas informa√ß√µes est√£o seguras. Trabalhamos com as maiores seguradoras do Brasil.
            </p>
        </div>
    </div>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyD3YZVqRbKExEi5CN9CPwlnY-GSzd4lUMM",
            authDomain: "retorno-seguros.firebaseapp.com",
            projectId: "retorno-seguros",
            storageBucket: "retorno-seguros.firebasestorage.app",
            messagingSenderId: "631323599837",
            appId: "1:631323599837:web:77f20f7c65a12113621856"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // URL Params
        const urlParams = new URLSearchParams(window.location.search);
        const indicadorCodigo = urlParams.get('ref') || urlParams.get('indicador');
        let indicadorNome = null;
        const empresaParceiraCodigo = urlParams.get('empresa') || urlParams.get('parceiro');

        // Form Data
        let formData = {
            nomeEmpresa: '',
            tipoBeneficiario: '', // 'funcionarios' ou 'ambos'
            formato: '', // 'global' ou 'movimentacao'
            qtdSocios: 0,
            qtdFuncionarios: 0,
            faixasEtarias: {
                socios: {},
                funcionarios: {}
            },
            vidasImportadas: [],
            coberturas: {
                morte: { selecionada: true, capital: 30000, capitalSocio: 0, capitalFuncionario: 0 }
            },
            nome: '',
            cnpj: '',
            whatsapp: ''
        };

        let currentStep = 1;
        const totalSteps = 8;

        // Update Progress
        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressText').textContent = `Etapa ${currentStep} de ${totalSteps}`;
        }

        // Show Step
        function showStep(step) {
            document.querySelectorAll('.step-card').forEach(card => card.classList.remove('active'));
            
            let stepId = 'step' + step;
            document.getElementById(stepId).classList.add('active');
            
            // Update current step number for progress
            if (step === '4a') currentStep = 4;
            else if (step === '4b') currentStep = 4;
            else currentStep = parseInt(step);
            
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Next Step
        function nextStep(current) {
            if (current === 1) {
                const nomeEmpresa = document.getElementById('nomeEmpresa').value.trim();
                if (!nomeEmpresa) {
                    alert('Por favor, informe o nome da empresa.');
                    return;
                }
                formData.nomeEmpresa = nomeEmpresa;
                showStep(2);
            }
            else if (current === 2) {
                if (!formData.tipoBeneficiario) {
                    alert('Por favor, selecione quem ser√° protegido.');
                    return;
                }
                showStep(3);
            }
            else if (current === 3) {
                if (!formData.formato) {
                    alert('Por favor, selecione o formato do seguro.');
                    return;
                }
                if (formData.formato === 'global') {
                    // Mostrar/esconder campo de s√≥cios
                    if (formData.tipoBeneficiario === 'ambos') {
                        document.getElementById('quantidadeSocios').style.display = 'block';
                    }
                    updateTotalGlobal();
                    showStep('4a');
                } else {
                    // Mostrar/esconder faixas de s√≥cios
                    if (formData.tipoBeneficiario === 'ambos') {
                        document.getElementById('faixasSocios').style.display = 'block';
                    }
                    showStep('4b');
                }
            }
            else if (current === '4a' || current === '4b') {
                const total = getTotalVidas();
                if (total < 3) {
                    alert('√â necess√°rio no m√≠nimo 3 vidas para cota√ß√£o empresarial.');
                    return;
                }
                // Mostrar op√ß√£o de diferenciar por cargo se tiver s√≥cios
                if (formData.tipoBeneficiario === 'ambos') {
                    document.querySelectorAll('[id^="separar"]').forEach(el => el.style.display = 'flex');
                }
                showStep(5);
            }
            else if (current === 5) {
                // Ir para loading
                showStep(6);
                animateLoading();
            }
        }

        // Previous Step
        function prevStep(current) {
            if (current === 2) showStep(1);
            else if (current === 3) showStep(2);
            else if (current === '4a' || current === '4b') showStep(3);
            else if (current === 5) {
                if (formData.formato === 'global') showStep('4a');
                else showStep('4b');
            }
            else if (current === 7) showStep(5);
        }

        // Select Tipo Benefici√°rio
        function selectTipoBeneficiario(tipo) {
            formData.tipoBeneficiario = tipo;
            document.querySelectorAll('#step2 .option-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.option-card').classList.add('selected');
            document.getElementById('btnStep2').disabled = false;
        }

        // Select Formato
        function selectFormato(formato) {
            formData.formato = formato;
            document.querySelectorAll('.formato-card').forEach(card => card.classList.remove('selected'));
            event.target.closest('.formato-card').classList.add('selected');
            document.getElementById('btnStep3').disabled = false;
        }

        // Adjust Quantity
        function adjustQuantity(tipo, delta) {
            const input = document.getElementById(tipo === 'socios' ? 'qtdSocios' : 'qtdFuncionarios');
            let value = parseInt(input.value) + delta;
            if (value < 1) value = 1;
            input.value = value;
            updateTotalGlobal();
        }

        // Update Total Global
        function updateTotalGlobal() {
            const socios = formData.tipoBeneficiario === 'ambos' ? parseInt(document.getElementById('qtdSocios').value) || 0 : 0;
            const funcionarios = parseInt(document.getElementById('qtdFuncionarios').value) || 0;
            
            formData.qtdSocios = socios;
            formData.qtdFuncionarios = funcionarios;
            
            const total = socios + funcionarios;
            document.querySelector('#totalGlobal .value').textContent = total;
        }

        // Update Total Movimenta√ß√£o
        function updateTotalMovimentacao() {
            let totalSocios = 0;
            let totalFuncionarios = 0;

            document.querySelectorAll('.faixa-input[data-tipo="socio"]').forEach(input => {
                const faixa = input.dataset.faixa;
                const value = parseInt(input.value) || 0;
                formData.faixasEtarias.socios[faixa] = value;
                totalSocios += value;
            });

            document.querySelectorAll('.faixa-input[data-tipo="funcionario"]').forEach(input => {
                const faixa = input.dataset.faixa;
                const value = parseInt(input.value) || 0;
                formData.faixasEtarias.funcionarios[faixa] = value;
                totalFuncionarios += value;
            });

            formData.qtdSocios = totalSocios;
            formData.qtdFuncionarios = totalFuncionarios;

            const total = totalSocios + totalFuncionarios;
            document.querySelector('#totalMovimentacao .value').textContent = total;
        }

        // Get Total Vidas
        function getTotalVidas() {
            return formData.qtdSocios + formData.qtdFuncionarios;
        }

        // Handle File Upload
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                    processImportedData(jsonData);
                    showFileInfo(file.name, jsonData.length);
                } catch (error) {
                    alert('Erro ao ler o arquivo. Verifique se √© um arquivo Excel v√°lido.');
                    console.error(error);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Process Imported Data
        function processImportedData(data) {
            formData.vidasImportadas = [];
            const faixas = { socios: {}, funcionarios: {} };
            
            data.forEach(row => {
                const nome = row.Nome || row.nome || row.NOME || '';
                let dataNasc = row['Data Nascimento'] || row['data_nascimento'] || row['DataNascimento'] || row.Nascimento || '';
                const cargo = (row.Cargo || row.cargo || row.CARGO || 'funcionario').toLowerCase();
                
                // Calcular idade
                let idade = 0;
                if (dataNasc) {
                    if (typeof dataNasc === 'number') {
                        // Excel date serial
                        const date = new Date((dataNasc - 25569) * 86400 * 1000);
                        idade = new Date().getFullYear() - date.getFullYear();
                    } else {
                        const date = new Date(dataNasc);
                        idade = new Date().getFullYear() - date.getFullYear();
                    }
                }

                // Determinar faixa
                let faixa = '18-29';
                if (idade >= 60) faixa = '60-65';
                else if (idade >= 50) faixa = '50-59';
                else if (idade >= 40) faixa = '40-49';
                else if (idade >= 30) faixa = '30-39';

                // Determinar tipo
                const tipoVida = cargo.includes('socio') || cargo.includes('s√≥cio') || cargo.includes('diretor') ? 'socio' : 'funcionario';

                // Adicionar √† lista
                formData.vidasImportadas.push({ nome, idade, faixa, cargo: tipoVida });

                // Contar nas faixas
                if (!faixas[tipoVida === 'socio' ? 'socios' : 'funcionarios'][faixa]) {
                    faixas[tipoVida === 'socio' ? 'socios' : 'funcionarios'][faixa] = 0;
                }
                faixas[tipoVida === 'socio' ? 'socios' : 'funcionarios'][faixa]++;
            });

            // Atualizar formData
            formData.faixasEtarias = faixas;

            // Calcular totais
            let totalSocios = 0;
            let totalFuncionarios = 0;
            Object.values(faixas.socios).forEach(v => totalSocios += v);
            Object.values(faixas.funcionarios).forEach(v => totalFuncionarios += v);
            formData.qtdSocios = totalSocios;
            formData.qtdFuncionarios = totalFuncionarios;

            // Atualizar UI
            document.querySelector('#totalMovimentacao .value').textContent = totalSocios + totalFuncionarios;

            // Mostrar tabela
            showVidasTable();
        }

        // Show File Info
        function showFileInfo(fileName, count) {
            document.getElementById('fileInfoContainer').style.display = 'block';
            document.getElementById('fileInfoContainer').innerHTML = `
                <div class="file-info">
                    <div class="icon">üìä</div>
                    <div class="details">
                        <div class="name">${fileName}</div>
                        <div class="meta">${count} pessoas importadas</div>
                    </div>
                    <button class="remove" onclick="removeFile()">‚úï</button>
                </div>
            `;
        }

        // Show Vidas Table
        function showVidasTable() {
            const container = document.getElementById('vidasImportadas');
            const tbody = document.getElementById('vidasTableBody');
            
            tbody.innerHTML = formData.vidasImportadas.map(v => `
                <tr>
                    <td>${v.nome}</td>
                    <td>${v.idade} anos</td>
                    <td>${v.faixa}</td>
                    <td><span class="${v.cargo === 'socio' ? 'badge-socio' : 'badge-funcionario'}">${v.cargo === 'socio' ? 'S√≥cio' : 'Funcion√°rio'}</span></td>
                </tr>
            `).join('');

            container.style.display = 'block';
        }

        // Remove File
        function removeFile() {
            document.getElementById('fileInput').value = '';
            document.getElementById('fileInfoContainer').style.display = 'none';
            document.getElementById('vidasImportadas').style.display = 'none';
            formData.vidasImportadas = [];
            formData.qtdSocios = 0;
            formData.qtdFuncionarios = 0;
            document.querySelector('#totalMovimentacao .value').textContent = '0';
        }

        // Toggle Cobertura
        function toggleCobertura(header) {
            const card = header.closest('.cobertura-card');
            const cobertura = card.dataset.cobertura;
            
            // Toggle expanded
            card.classList.toggle('expanded');
            
            // Toggle selected (exceto obrigat√≥ria)
            if (!card.classList.contains('obrigatoria')) {
                card.classList.toggle('selected');
                
                if (card.classList.contains('selected')) {
                    formData.coberturas[cobertura] = { selecionada: true, capital: 0 };
                } else {
                    delete formData.coberturas[cobertura];
                }
            }
        }

        // Select Capital
        function selectCapital(cobertura, valor) {
            // Remover sele√ß√£o anterior
            document.querySelectorAll(`.capital-options[data-cobertura="${cobertura}"] .capital-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Adicionar sele√ß√£o
            event.target.classList.add('selected');
            
            // Atualizar formData
            if (!formData.coberturas[cobertura]) {
                formData.coberturas[cobertura] = { selecionada: true };
            }
            formData.coberturas[cobertura].capital = valor;

            // Marcar card como selecionado
            const card = document.querySelector(`.cobertura-card[data-cobertura="${cobertura}"]`);
            if (!card.classList.contains('obrigatoria')) {
                card.classList.add('selected');
            }
        }

        // Set Custom Capital
        function setCustomCapital(cobertura, valor) {
            const numValue = parseInt(valor.replace(/\D/g, '')) || 0;
            
            document.querySelectorAll(`.capital-options[data-cobertura="${cobertura}"] .capital-option`).forEach(opt => {
                opt.classList.remove('selected');
            });
            
            if (!formData.coberturas[cobertura]) {
                formData.coberturas[cobertura] = { selecionada: true };
            }
            formData.coberturas[cobertura].capital = numValue;
        }

        // Toggle Separar Cargo
        function toggleSepararCargo(cobertura, checked) {
            const container = document.getElementById(`cargoCapitals${cobertura.charAt(0).toUpperCase() + cobertura.slice(1)}`);
            if (checked) {
                container.classList.add('show');
            } else {
                container.classList.remove('show');
            }
        }

        // Animate Loading
        function animateLoading() {
            const steps = ['loadStep1', 'loadStep2', 'loadStep3', 'loadStep4'];
            let i = 0;

            const interval = setInterval(() => {
                if (i > 0) {
                    document.getElementById(steps[i - 1]).classList.remove('active');
                    document.getElementById(steps[i - 1]).classList.add('done');
                    document.getElementById(steps[i - 1]).querySelector('.step-icon').textContent = '‚úì';
                }
                
                if (i < steps.length) {
                    document.getElementById(steps[i]).classList.add('active');
                    i++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        generateSummary();
                        showStep(7);
                    }, 500);
                }
            }, 1500);
        }

        // Generate Summary
        function generateSummary() {
            document.getElementById('summaryEmpresa').textContent = formData.nomeEmpresa;
            document.getElementById('summaryVidas').textContent = getTotalVidas();
            document.getElementById('summaryFormato').textContent = formData.formato === 'global' ? 'Capital Global' : 'Movimenta√ß√£o';
            
            if (formData.tipoBeneficiario === 'ambos') {
                document.getElementById('summarySociosItem').style.display = 'block';
                document.getElementById('summarySocios').textContent = formData.qtdSocios;
            }
            document.getElementById('summaryFuncionarios').textContent = formData.qtdFuncionarios;

            // Coberturas
            const coberturasList = document.getElementById('coberturasResumoList');
            coberturasList.innerHTML = '';

            const nomesCoberturas = {
                morte: 'Morte',
                morteAcidental: 'Morte Acidental',
                ipa: 'Invalidez por Acidente (IPA)',
                ifpd: 'Invalidez por Doen√ßa (IFPD)',
                doencasGraves: 'Doen√ßas Graves',
                dmho: 'Despesas M√©dicas (DMHO)',
                rescisao: 'Rescis√£o Trabalhista',
                assistenciaFuneral: 'Assist√™ncia Funeral',
                auxilioFuneral: 'Aux√≠lio Funeral'
            };

            Object.keys(formData.coberturas).forEach(key => {
                const cob = formData.coberturas[key];
                if (cob.selecionada && cob.capital > 0) {
                    coberturasList.innerHTML += `
                        <div class="cobertura-resumo-item">
                            <span class="cobertura-resumo-nome">${nomesCoberturas[key]}</span>
                            <span class="cobertura-resumo-capital">R$ ${cob.capital.toLocaleString('pt-BR')}</span>
                        </div>
                    `;
                }
            });
        }

        // Format CNPJ
        function formatCNPJ(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 14) value = value.slice(0, 14);
            
            if (value.length > 12) {
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
            } else if (value.length > 8) {
                value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{0,4})/, '$1.$2.$3/$4');
            } else if (value.length > 5) {
                value = value.replace(/(\d{2})(\d{3})(\d{0,3})/, '$1.$2.$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,3})/, '$1.$2');
            }
            
            input.value = value;
        }

        // Format Phone
        function formatPhone(input) {
            let value = input.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);
            
            if (value.length > 6) {
                value = value.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            } else if (value.length > 2) {
                value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
            }
            
            input.value = value;
        }

        // Enviar Cota√ß√£o
        async function enviarCotacao() {
            const nome = document.getElementById('nome').value.trim();
            const cnpj = document.getElementById('cnpj').value.trim();
            const whatsapp = document.getElementById('whatsapp').value.trim();
            
            if (!nome) {
                alert('Por favor, informe seu nome.');
                return;
            }
            
            if (!cnpj || cnpj.length < 18) {
                alert('Por favor, informe o CNPJ completo.');
                return;
            }
            
            if (!whatsapp || whatsapp.length < 14) {
                alert('Por favor, informe um WhatsApp v√°lido.');
                return;
            }
            
            formData.nome = nome;
            formData.cnpj = cnpj;
            formData.whatsapp = whatsapp;
            
            const btn = document.getElementById('btnEnviar');
            btn.disabled = true;
            btn.textContent = 'Enviando...';
            
            try {
                // Preparar coberturas para salvar
                const coberturasArray = [];
                Object.keys(formData.coberturas).forEach(key => {
                    if (formData.coberturas[key].selecionada && formData.coberturas[key].capital > 0) {
                        coberturasArray.push({
                            nome: key,
                            capital: formData.coberturas[key].capital
                        });
                    }
                });

                // Save to Firebase
                await db.collection('leads_crm').add({
                    nome: formData.nome,
                    whatsapp: formData.whatsapp.replace(/\D/g, ''),
                    nomeEmpresa: formData.nomeEmpresa,
                    cnpj: formData.cnpj,
                    
                    tipoBeneficiario: formData.tipoBeneficiario,
                    formato: formData.formato,
                    qtdSocios: formData.qtdSocios,
                    qtdFuncionarios: formData.qtdFuncionarios,
                    totalVidas: getTotalVidas(),
                    faixasEtarias: formData.faixasEtarias,
                    
                    coberturas: coberturasArray,
                    
                    ramo: 'vida',
                    tipo: 'empresarial',
                    status: 'pre_cadastro',
                    origem: 'site',
                    
                    indicadoPorCodigo: indicadorCodigo || null,
                    indicadoPorNome: indicadorNome || null,
                    empresaParceiraCodigo: empresaParceiraCodigo || null,
                    
                    criadoEm: firebase.firestore.FieldValue.serverTimestamp(),
                    dataCadastro: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Show WhatsApp button
                btn.style.display = 'none';
                const whatsappLink = document.getElementById('whatsappLink');
                whatsappLink.style.display = 'flex';
                
                // Create WhatsApp message
                const whatsNum = '5554997015000';
                
                let coberturasMsg = '';
                Object.keys(formData.coberturas).forEach(key => {
                    const cob = formData.coberturas[key];
                    if (cob.selecionada && cob.capital > 0) {
                        const nomes = {
                            morte: 'Morte',
                            morteAcidental: 'Morte Acidental',
                            ipa: 'IPA',
                            ifpd: 'IFPD',
                            doencasGraves: 'Doen√ßas Graves',
                            dmho: 'DMHO',
                            rescisao: 'Rescis√£o',
                            assistenciaFuneral: 'Assist. Funeral',
                            auxilioFuneral: 'Aux√≠lio Funeral'
                        };
                        coberturasMsg += `   ‚Ä¢ ${nomes[key]}: R$ ${cob.capital.toLocaleString('pt-BR')}%0A`;
                    }
                });

                const msg = `Ol√°! Sou *${formData.nome}* da empresa *${formData.nomeEmpresa}* e acabei de fazer uma cota√ß√£o de Seguro de Vida Empresarial no site.%0A%0A` +
                    `üìä *Dados da cota√ß√£o:*%0A` +
                    `‚Ä¢ Empresa: ${formData.nomeEmpresa}%0A` +
                    `‚Ä¢ CNPJ: ${formData.cnpj}%0A` +
                    `‚Ä¢ Total de vidas: ${getTotalVidas()}%0A` +
                    `‚Ä¢ Formato: ${formData.formato === 'global' ? 'Capital Global' : 'Movimenta√ß√£o'}%0A` +
                    (formData.tipoBeneficiario === 'ambos' ? `‚Ä¢ S√≥cios: ${formData.qtdSocios}%0A` : '') +
                    `‚Ä¢ Funcion√°rios: ${formData.qtdFuncionarios}%0A%0A` +
                    `üõ°Ô∏è *Coberturas selecionadas:*%0A${coberturasMsg}%0A` +
                    `Gostaria de receber a proposta completa!`;
                
                whatsappLink.href = `https://wa.me/${whatsNum}?text=${msg}`;
                
                alert('‚úÖ Cota√ß√£o enviada com sucesso! Clique no bot√£o do WhatsApp para falar com um especialista.');
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                btn.disabled = false;
                btn.textContent = 'Solicitar Proposta Completa';
                alert('Erro ao enviar cota√ß√£o. Tente novamente.');
            }
        }

        // Drag and Drop
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length) {
                document.getElementById('fileInput').files = files;
                handleFileUpload({ target: { files: files } });
            }
        });

        // Initialize
        updateProgress();
    </script>
</body>
</html>
